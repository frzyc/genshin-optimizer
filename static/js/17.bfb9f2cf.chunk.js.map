{"version":3,"sources":["Build/Build.ts","Util/TimeUtil.ts","../node_modules/react-bootstrap/esm/ProgressBar.js","Build/BuildWorker.ts","Build/BuildDisplay.tsx"],"names":["calculateTotalBuildNumber","artifactsBySlot","setFilters","setKeys","Set","map","i","key","filteredArtifactsBySlot","slotKeys","Object","keys","slotKey","artifactsBySet","artifact","has","setKey","push","freeze","setCount","accu","result","slotPerm","index","length","num","artifactSetPermutations","reduce","entries","artifacts","getTalentStatKey","skillKey","stats","overwriteElement","hitMode","infusionAura","infusionSelf","reactionMode","characterEle","weaponType","ElementalData","includes","startsWith","eleKey","getTalentStatKeyVariant","msToUnits","ms","milliseconds","seconds","Math","floor","minutes","hours","timeString","timeText","strPadLeft","timeStringMs","_excluded","_excluded2","_excluded3","getPercentage","now","min","max","percentage","round","renderProgressBar","_ref","ref","_classNames","label","srOnly","striped","animated","className","style","variant","bsPrefix","props","_objectWithoutPropertiesLoose","React","createElement","_extends","role","classNames","width","ProgressBar","forwardRef","_ref2","isChild","useBootstrapPrefix","children","wrapperProps","child","cloneElement","displayName","defaultProps","Worker_fn","Worker","InfoDisplay","lazy","CharacterDisplayCard","warningBuildNumber","maxBuildsToShowList","artifactsSlotsToSelectMainStats","BuildDisplay","propCharacterKey","location","characterKey","useState","setcharacterKey","builds","setbuilds","maxBuildsToShow","setmaxBuildsToShow","modalBuild","setmodalBuild","showArtCondModal","setshowArtCondModal","showCharacterModal","setshowCharacterModal","generatingBuilds","setgeneratingBuilds","generationProgress","setgenerationProgress","generationDuration","setgenerationDuration","generationSkipped","setgenerationSkipped","useForceUpdate","charDirty","setCharDirty","artifactSheets","usePromise","ArtifactSheet","getAll","artsDirty","setArtsDirty","isMounted","useRef","worker","character","characterSheet","weaponSheet","initialStats","statsDisplayKeys","setCharacterData","buildSettings","statFilters","mainStatKeys","optimizationTarget","mainStatAssumptionLevel","useLockedArts","useEquippedArts","ascending","buildSettingsDispatch","useCallback","action","state","type","mainStatKey","buildSettingsReducer","database","updateChar","useEffect","ReactGA","pageview","a","_getChar","CharacterSheet","get","WeaponSheet","weapon","Character","createInitialStats","getDisplayStatKeys","followAnyArt","followChar","undefined","current","terminate","selectCharacter","cKey","localStorage","loadFromLocalStorage","saveToLocalStorage","Array","isArray","sectionKey","section","JSON","stringify","useMemo","split","fromEntries","allSlotKeys","totBuildNumber","artifactDatabase","_getArts","filter","art","lock","Artifact","splitArtifactsBySlot","forEach","generateBuilds","turbo","artifactSetEffects","setEffectsObjs","splitArtifacts","deepClone","values","artArr","mainStatVal","mainStatValue","numStars","level","minFilters","maxFilters","data","onmessage","e","progress","timing","skipped","category","variable","value","toString","obj","calculateBuildwithArtifact","postMessage","dropdownitemsForStar","star","setsWithMaxRarity","setobj","some","setsNumArr","setEffects","artsAccountedOther","cur","ind","every","parseInt","Dropdown","Item","onClick","name","characterName","characterDropDown","DropdownButton","title","disabled","Divider","CharacterSelection","onSelect","formula","Formula","sortByText","Stat","getStatVariant","getStatNamePretty","talentKey","field","getTalentFieldValue","text","getTalentOfKey","artsAccounted","artifactCondCount","count","crawlObject","conditionalValues","v","characterDispatch","val","hasMinFilters","hasMaxFilters","disabledTurbo","Container","InfoComponent","pageKey","modalTitle","BuildModal","build","ArtConditionalModal","Row","Col","Card","bg","Header","Body","xs","lg","CharacterCard","header","cardClassName","onEdit","HitModeCard","Boolean","StatFilterCard","statKeys","basicKeys","setStatFilters","sFs","Button","Badge","setNum","ButtonGroup","as","ItemText","setNKey","setNkey","setNumKey","SetEffectDisplay","newBuild","equippedBuild","editable","icon","faCheckSquare","faSquare","AssumeFullLevelToggle","setmainStatAssumptionLevel","size","getStatNameWithPercent","slotMainStats","BuildAlert","OverlayTrigger","overlay","Tooltip","id","drop","Toggle","Menu","align","minWidth","fields","getDisplayHeading","md","overflow","textOverflow","target","TargetSelectorDropdownItem","faSortAmountDownAlt","faSortAmountUp","ListGroup","ArtifactDisplayItem","talentField","closeModal","Modal","show","onHide","contentClassName","Suspense","fallback","tabName","setCharacterKey","onClose","footer","closeArtCondModal","artSetKeyList","namesByMaxRarities","flatMap","faUndo","faTimes","sheet","slotIcons","rarity","xl","Image","src","thumbnail","stars","Footer","StatFilterItem","statKey","close","setFilter","isFloat","getStatUnit","inputProps","allowEmpty","float","minInputProps","placeholder","onChange","s","maxInputProps","InputGroup","Prepend","sKey","CustomFormControl","Append","faTrash","setHitmode","setReactionMode","setInfusionAura","remainingKeys","k","sheets","equippedArtifacts","currentlyEquipped","setToSlots","sort","slotarr1","slotarr","artifactSlotIcon","StatDisplayComponent","cardbg","totalBuildNumberString","toLocaleString","totalUnskipped","generationProgressString","generationSkippedString","totalUnskippedString","generationSkippedText","progPercent","Alert","toFixed","levels","0","4","8","12","16","20"],"mappings":"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","file":"static/js/17.bfb9f2cf.chunk.js","sourcesContent":["import ElementalData from \"../Data/ElementalData\"\r\nimport { StatKey, StatDict, IArtifact, SubstatKey } from \"../Types/artifact\"\r\nimport { ArtifactSetEffects, PrunedArtifactSetEffects, ArtifactsBySlot, SetFilter } from \"../Types/Build\"\r\nimport { ArtifactSetKey, ElementKey } from \"../Types/consts\"\r\nimport ICalculatedStats from \"../Types/ICalculatedStats\"\r\n\r\n/**\r\n * Remove artifacts that can never be used in optimized builds\r\n * @param {artifact[]} artifacts - List of artifacts of the same slot\r\n * @param {Object.<setKey, Object.<number, Object.<statKey, statValue>>>} artifactSetEffects - The list of the set effects\r\n * @param {Set.<statKey>} significantStats - A set of stats that pruning needs to take into consideration\r\n * @param {bool} ascending - Whether the sorting is ascending or descending\r\n * @param {Set.<setKey>} alwaysAccepted - The list of artifact sets that are always included\r\n */\r\nexport function pruneArtifacts(artifacts: IArtifact[], artifactSetEffects: ArtifactSetEffects, significantStats: Set<StatKey>, ascending: boolean = false, alwaysAccepted: Set<ArtifactSetKey> = new Set()): IArtifact[] {\r\n  function shouldKeepFirst(first: StatDict, second: StatDict, preferFirst: boolean) {\r\n    let firstBetter = Object.entries(first).some(([k, v]) => v! > (second[k] ?? 0))\r\n    let secondBetter = Object.entries(second).some(([k, v]) => v! > (first[k] ?? 0))\r\n    if (ascending) [firstBetter, secondBetter] = [secondBetter, firstBetter]\r\n    // Keep if first is strictly better, uncomparable, or equal + prefer first\r\n    return firstBetter || (!secondBetter && preferFirst)\r\n  }\r\n\r\n  // Prune unused set effects. Sets with no relevant effects are regrouped to \"other\"\r\n  const prunedSetEffects: PrunedArtifactSetEffects = { \"other\": {} }\r\n  for (const set in artifactSetEffects)\r\n    for (const num in artifactSetEffects[set]) {\r\n      const effects = Object.entries(artifactSetEffects[set]![num]).filter(([key]) => significantStats.has(key as StatKey))\r\n      if (effects.length > 0) {\r\n        prunedSetEffects[set] = prunedSetEffects[set] ?? {}\r\n        prunedSetEffects[set]![num] = Object.fromEntries(effects)\r\n      }\r\n    }\r\n\r\n  // array of artifacts, artifact stats, and set (may be \"other\")\r\n  let tmp: { artifact: IArtifact, stats: Dict<StatKey, number>, set: ArtifactSetKey | \"other\" }[] = artifacts.map(artifact => {\r\n    const stats: Dict<StatKey, number> = {}, set: ArtifactSetKey | \"other\" = (artifact.setKey in prunedSetEffects) ? artifact.setKey : \"other\"\r\n    if (significantStats.has(artifact.mainStatKey as any))\r\n      stats[artifact.mainStatKey] = artifact.mainStatVal!\r\n    for (const { key, value } of artifact.substats)\r\n      if (key && significantStats.has(key as SubstatKey))\r\n        stats[key] = (stats[key] ?? 0) + value\r\n    for (const key in stats)\r\n      if (key.endsWith(\"enemyRes_\"))\r\n        stats[key as StatKey] = -stats[key as StatKey]!\r\n    return { artifact, stats, set }\r\n  })\r\n\r\n  // Compare artifacts' base stats from the same set\r\n  tmp = tmp.filter(({ artifact: candidate, stats: candidateStats, set: candidateSet }) =>\r\n    tmp.every(({ artifact: other, stats: otherStats, set: otherSet }) =>\r\n      candidateSet !== otherSet || shouldKeepFirst(candidateStats, otherStats, candidate.id! <= other.id!)\r\n    ))\r\n\r\n  if (!ascending) {\r\n    // Cross-check with different sets\r\n    tmp = tmp.filter(({ artifact: candidate, stats: candidateStats, set: candidateSet }) => {\r\n      // Possible \"additional stats\" if a build equips `candidate` on an empty slot.\r\n      let possibleStats = [...Object.values(prunedSetEffects[candidateSet]!), {}].map(c => {\r\n        const current: Dict<string, number> = { ...candidateStats }\r\n        Object.entries(c).forEach(([key, value]: any) => current[key] = (current[key] ?? 0) + (value ?? 0))\r\n        return current\r\n      })\r\n      return tmp.every(({ artifact: other, stats: otherStats, set: otherSet }) => {\r\n        if (candidateSet === otherSet) return true // Already checked same-set\r\n\r\n        // Remove possibilities that shouldn't be kept\r\n        possibleStats = possibleStats.filter(current =>\r\n          shouldKeepFirst(current, otherStats, candidate.id! <= other.id!))\r\n        return possibleStats.length !== 0\r\n      })\r\n    })\r\n  }\r\n  // Reinstate `alwaysAccepted`\r\n  return [\r\n    ...artifacts.filter(artifact => alwaysAccepted.has(artifact.setKey)),\r\n    ...tmp.map(tmp => tmp.artifact).filter(artifact => !alwaysAccepted.has(artifact.setKey)),\r\n  ]\r\n}\r\n\r\n/**\r\n * Generate all set of artifacts-by-slots based on the filters\r\n * @param {Object.<slotKey, artifact[]>} artifactsBySlot - list of artifacts, separated by slots\r\n * @param {Object.<setKey, number>} setFilters - minimum number of artifacts in each set\r\n *\r\n */\r\nexport function artifactSetPermutations(artifactsBySlot: ArtifactsBySlot, setFilters: SetFilter) {\r\n  const setKeys = new Set(setFilters.map(i => i.key)), filteredArtifactsBySlot = {}\r\n  const slotKeys = Object.keys(artifactsBySlot)\r\n\r\n  for (const slotKey of slotKeys) {\r\n    let artifactsBySet: Dict<ArtifactSetKey, IArtifact[]> = {}\r\n    for (const artifact of (artifactsBySlot[slotKey] ?? [])) {\r\n      if (setKeys.has(artifact.setKey)) {\r\n        if (artifactsBySet[artifact.setKey]) artifactsBySet[artifact.setKey]!.push(artifact)\r\n        else artifactsBySet[artifact.setKey] = [artifact]\r\n      } else {\r\n        if (artifactsBySet['null']) artifactsBySet['null'].push(artifact)\r\n        else artifactsBySet['null'] = [artifact]\r\n      }\r\n    }\r\n    filteredArtifactsBySlot[slotKey] = Object.freeze(artifactsBySet)\r\n  }\r\n\r\n  const setCount = {}, accu: ArtifactsBySlot = {}, result: ArtifactsBySlot[] = []\r\n\r\n  function slotPerm(index) {\r\n    if (index >= slotKeys.length) {\r\n      for (const { key, num } of setFilters)\r\n        if ((setCount[key] ?? 0) < num)\r\n          return\r\n      result.push({ ...accu })\r\n      return\r\n    }\r\n\r\n    const slotKey = slotKeys[index]\r\n    let artifactsBySet = filteredArtifactsBySlot[slotKey]\r\n    for (const setKey in artifactsBySet) {\r\n      setCount[setKey] = (setCount[setKey] ?? 0) + 1\r\n      accu[slotKey] = artifactsBySet[setKey]\r\n      slotPerm(index + 1)\r\n      setCount[setKey] -= 1\r\n    }\r\n  }\r\n\r\n  slotPerm(0)\r\n  return result\r\n}\r\n\r\n/**\r\n * Compute number of all artifact permutations based on the filters\r\n * @param {Object.<slotKey, artifact[]>} artifactsBySlot - list of artifacts, separated by slots\r\n * @param {Object.<setKey, number>} setFilters - minimum number of artifacts in each set\r\n */\r\nexport function calculateTotalBuildNumber(artifactsBySlot: ArtifactsBySlot, setFilters: SetFilter) {\r\n  return artifactSetPermutations(artifactsBySlot, setFilters).reduce((accu, artifactsBySlot) =>\r\n    accu + Object.entries(artifactsBySlot).reduce((accu, artifacts) => accu * artifacts[1]!.length, 1)\r\n    , 0)\r\n}\r\n\r\n/**\r\n * @callback artifactCallback\r\n * @param {Object.<artifactKey, artifact>} artifacts - the list of artifacts\r\n * @param {stats} stats - the total stats for the artifacts\r\n */\r\n\r\n/**\r\n * Generate all artifact permutations and accumulate the stats\r\n * @param {stats} initialStats - initial stats before any artifact is added\r\n * @param {Object.<slotKey, artifact[]>} artifactsBySlot - list of artifacts, separated by slots\r\n * @param {Object.<setKey, Object.<number, Object.<statKey, statValue>>>} artifactSetEffects - the list of the set effects\r\n * @param {artifactCallback} callback - the functions called with each permutation\r\n */\r\nexport function artifactPermutations(initialStats, artifactsBySlot: ArtifactsBySlot, artifactSetEffects, callback) {\r\n  const slotKeys = Object.keys(artifactsBySlot), setCount = {}, accu = {}\r\n  function slotPerm(index, stats) {\r\n    if (index >= slotKeys.length) {\r\n      callback(accu, stats)\r\n      return\r\n    }\r\n\r\n    let slotKey = slotKeys[index]\r\n    for (const artifact of (artifactsBySlot[slotKey] as any)) {\r\n      let newStats = { ...stats }\r\n      accumulate(slotKey, artifact, setCount, accu, newStats, artifactSetEffects)\r\n      slotPerm(index + 1, newStats)\r\n      setCount[artifact.setKey] -= 1\r\n    }\r\n  }\r\n\r\n  slotPerm(0, initialStats)\r\n}\r\n\r\nfunction accumulate(slotKey, art: IArtifact, setCount, accu, stats, artifactSetEffects) {\r\n  let setKey = art.setKey\r\n  accu[slotKey] = art\r\n  setCount[setKey] = (setCount[setKey] ?? 0) + 1\r\n\r\n  // Add artifact stats\r\n  if (art.mainStatKey in stats) stats[art.mainStatKey] += art.mainStatVal!\r\n  art.substats.forEach((substat) => {\r\n    if (substat?.key in stats) stats[substat.key] += substat.value\r\n  })\r\n\r\n  // Add set effects\r\n  let setEffect = artifactSetEffects[setKey]?.[setCount[setKey]]\r\n  setEffect && Object.entries(setEffect).forEach(([statKey, val]: any) => {\r\n    if (statKey in stats) stats[statKey] += val\r\n  })\r\n}\r\n\r\n/**\r\n  * Create statKey in the form of ${ele}_elemental_${type} for elemental DMG, ${ele}_${src}_${type} for talent DMG.\r\n  * @param {string} skillKey - The DMG src. Can be \"norm\",\"skill\". Use an elemental to specify a elemental hit \"physical\" -> physical_elemental_{type}. Use \"elemental\" here to specify a elemental hit of character's element/reactionMode\r\n  * @param {*} stats - The calculated stats\r\n  * @param {*} overwriteElement - Override the hit to be the character's elemental, that is not part of infusion.\r\n  */\r\nexport function getTalentStatKey(skillKey: string, stats: ICalculatedStats, overwriteElement?: ElementKey | \"physical\") {\r\n  const { hitMode = \"\", infusionAura = \"\", infusionSelf = \"\", reactionMode = null, characterEle = \"anemo\", weaponType = \"sword\" } = stats\r\n  if ((Object.keys(ElementalData) as any).includes(skillKey)) return `${skillKey}_elemental_${hitMode}`//elemental DMG\r\n  if (!overwriteElement && weaponType === \"catalyst\") overwriteElement = characterEle\r\n\r\n  if (skillKey === \"elemental\" || skillKey === \"burst\" || skillKey === \"skill\" || overwriteElement) {\r\n    if (reactionMode && reactionMode.startsWith(overwriteElement || characterEle)) return `${reactionMode}_${skillKey}_${hitMode}`\r\n    return `${overwriteElement || characterEle}_${skillKey}_${hitMode}`\r\n  }\r\n  //auto attacks\r\n  let eleKey = \"physical\"\r\n  if (infusionSelf) eleKey = infusionSelf\r\n  else if (infusionAura) eleKey = infusionAura\r\n  if (reactionMode && reactionMode.startsWith(eleKey)) return `${reactionMode}_${skillKey}_${hitMode}`\r\n\r\n  return `${eleKey}_${skillKey}_${hitMode}`\r\n}\r\n\r\nexport function getTalentStatKeyVariant(skillKey: string, stats: ICalculatedStats, overwriteElement: ElementKey | \"physical\" | undefined | \"\" = \"\") {\r\n  if ((Object.keys(ElementalData) as any).includes(skillKey)) return skillKey//elemental DMG\r\n  const { infusionAura = \"\", infusionSelf = \"\", reactionMode = null, characterEle = \"anemo\", weaponType = \"sword\" } = stats\r\n  if (!overwriteElement && weaponType === \"catalyst\") overwriteElement = characterEle\r\n\r\n  if (skillKey === \"elemental\" || skillKey === \"burst\" || skillKey === \"skill\" || overwriteElement) {\r\n    if (reactionMode && reactionMode.startsWith(overwriteElement || characterEle)) {\r\n      if ([\"pyro_vaporize\", \"hydro_vaporize\"].includes(reactionMode)) return \"vaporize\"\r\n      else if ([\"pyro_melt\", \"cryo_melt\"].includes(reactionMode)) return \"melt\"\r\n    }\r\n    return overwriteElement || characterEle\r\n  }\r\n  //auto attacks\r\n  let eleKey = \"physical\"\r\n  if (infusionSelf) eleKey = infusionSelf\r\n  else if (infusionAura) eleKey = infusionAura\r\n  if (reactionMode && reactionMode.startsWith(eleKey)) {\r\n    if ([\"pyro_vaporize\", \"hydro_vaporize\"].includes(reactionMode)) return \"vaporize\"\r\n    else if ([\"pyro_melt\", \"cryo_melt\"].includes(reactionMode)) return \"melt\"\r\n  }\r\n  return eleKey\r\n}\r\n","import { strPadLeft } from \"./Util\"\r\n\r\nexport function msToUnits(ms: number) {\r\n  let milliseconds = ms % 1000\r\n  let seconds = Math.floor((ms / 1000) % 60)\r\n  let minutes = Math.floor((ms / (1000 * 60)) % 60)\r\n  let hours = Math.floor((ms / (1000 * 60 * 60)))\r\n  return { hours, minutes, seconds, milliseconds }\r\n}\r\nexport function timeString(ms: number) {\r\n  //shows only in terms of hours/minutes. there are better calculations for days using Date functions.\r\n  let { hours, minutes, seconds } = msToUnits(ms)\r\n  let timeText = \"Minutes\"\r\n  if (hours) timeText = \"Hours\"\r\n  return `${hours ? `${hours}:` : \"\"}${strPadLeft(minutes, '0', 2)}:${strPadLeft(seconds, '0', 2)} ${timeText}`;\r\n}\r\nexport function timeStringMs(ms: number) {\r\n  //shows only in terms of hours/minutes. there are better calculations for days using Date functions.\r\n  let { hours, minutes, seconds, milliseconds } = msToUnits(ms)\r\n  let timeText = \"Minutes\"\r\n  if (hours) timeText = \"Hours\"\r\n  return `${hours ? `${hours}:` : \"\"}${strPadLeft(minutes, '0', 2)}:${strPadLeft(seconds, '0', 2)}.${strPadLeft(milliseconds, '0', 3)} ${timeText}`;\r\n}\r\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"min\", \"now\", \"max\", \"label\", \"srOnly\", \"striped\", \"animated\", \"className\", \"style\", \"variant\", \"bsPrefix\"],\n    _excluded2 = [\"isChild\"],\n    _excluded3 = [\"min\", \"now\", \"max\", \"label\", \"srOnly\", \"striped\", \"animated\", \"bsPrefix\", \"variant\", \"className\", \"children\"];\nimport classNames from 'classnames';\nimport React, { cloneElement } from 'react';\nimport { useBootstrapPrefix } from './ThemeProvider';\nimport { map } from './ElementChildren';\nvar ROUND_PRECISION = 1000;\n/**\n * Validate that children, if any, are instances of `<ProgressBar>`.\n */\n\nfunction onlyProgressBar(props, propName, componentName) {\n  var children = props[propName];\n\n  if (!children) {\n    return null;\n  }\n\n  var error = null;\n  React.Children.forEach(children, function (child) {\n    if (error) {\n      return;\n    }\n    /**\n     * Compare types in a way that works with libraries that patch and proxy\n     * components like react-hot-loader.\n     *\n     * see https://github.com/gaearon/react-hot-loader#checking-element-types\n     */\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n\n\n    var element = /*#__PURE__*/React.createElement(ProgressBar, null);\n    if (child.type === element.type) return;\n    var childType = child.type;\n    var childIdentifier = /*#__PURE__*/React.isValidElement(child) ? childType.displayName || childType.name || childType : child;\n    error = new Error(\"Children of \" + componentName + \" can contain only ProgressBar \" + (\"components. Found \" + childIdentifier + \".\"));\n  });\n  return error;\n}\n\nvar defaultProps = {\n  min: 0,\n  max: 100,\n  animated: false,\n  isChild: false,\n  srOnly: false,\n  striped: false\n};\n\nfunction getPercentage(now, min, max) {\n  var percentage = (now - min) / (max - min) * 100;\n  return Math.round(percentage * ROUND_PRECISION) / ROUND_PRECISION;\n}\n\nfunction renderProgressBar(_ref, ref) {\n  var _classNames;\n\n  var min = _ref.min,\n      now = _ref.now,\n      max = _ref.max,\n      label = _ref.label,\n      srOnly = _ref.srOnly,\n      striped = _ref.striped,\n      animated = _ref.animated,\n      className = _ref.className,\n      style = _ref.style,\n      variant = _ref.variant,\n      bsPrefix = _ref.bsPrefix,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: ref\n  }, props, {\n    role: \"progressbar\",\n    className: classNames(className, bsPrefix + \"-bar\", (_classNames = {}, _classNames[\"bg-\" + variant] = variant, _classNames[bsPrefix + \"-bar-animated\"] = animated, _classNames[bsPrefix + \"-bar-striped\"] = animated || striped, _classNames)),\n    style: _extends({\n      width: getPercentage(now, min, max) + \"%\"\n    }, style),\n    \"aria-valuenow\": now,\n    \"aria-valuemin\": min,\n    \"aria-valuemax\": max\n  }), srOnly ? /*#__PURE__*/React.createElement(\"span\", {\n    className: \"sr-only\"\n  }, label) : label);\n}\n\nvar ProgressBar = /*#__PURE__*/React.forwardRef(function (_ref2, ref) {\n  var isChild = _ref2.isChild,\n      props = _objectWithoutPropertiesLoose(_ref2, _excluded2);\n\n  props.bsPrefix = useBootstrapPrefix(props.bsPrefix, 'progress');\n\n  if (isChild) {\n    return renderProgressBar(props, ref);\n  }\n\n  var min = props.min,\n      now = props.now,\n      max = props.max,\n      label = props.label,\n      srOnly = props.srOnly,\n      striped = props.striped,\n      animated = props.animated,\n      bsPrefix = props.bsPrefix,\n      variant = props.variant,\n      className = props.className,\n      children = props.children,\n      wrapperProps = _objectWithoutPropertiesLoose(props, _excluded3);\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: ref\n  }, wrapperProps, {\n    className: classNames(className, bsPrefix)\n  }), children ? map(children, function (child) {\n    return /*#__PURE__*/cloneElement(child, {\n      isChild: true\n    });\n  }) : renderProgressBar({\n    min: min,\n    now: now,\n    max: max,\n    label: label,\n    srOnly: srOnly,\n    striped: striped,\n    animated: animated,\n    bsPrefix: bsPrefix,\n    variant: variant\n  }, ref));\n});\nProgressBar.displayName = 'ProgressBar';\nProgressBar.defaultProps = defaultProps;\nexport default ProgressBar;","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/BuildWorker.ece0d023.worker.js\");\n}\n","import { faCheckSquare, faSortAmountDownAlt, faSortAmountUp, faSquare, faTimes, faTrash, faUndo } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React, { lazy, useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { Alert, Badge, Button, ButtonGroup, Card, Col, Container, Dropdown, DropdownButton, Image, InputGroup, ListGroup, Modal, OverlayTrigger, ProgressBar, Row, Tooltip } from 'react-bootstrap';\r\nimport ReactGA from 'react-ga';\r\n// eslint-disable-next-line\r\nimport Worker from \"worker-loader!./BuildWorker\";\r\nimport Artifact from '../Artifact/Artifact';\r\nimport { ArtifactSheet } from '../Artifact/ArtifactSheet';\r\nimport SetEffectDisplay from '../Artifact/Component/SetEffectDisplay';\r\nimport Character from '../Character/Character';\r\nimport CharacterCard from '../Character/CharacterCard';\r\nimport { HitModeToggle, InfusionAuraDropdown, ReactionToggle } from '../Character/CharacterDisplay/DamageOptionsAndCalculation';\r\nimport StatDisplayComponent from '../Character/CharacterDisplay/StatDisplayComponent';\r\nimport CharacterSheet from '../Character/CharacterSheet';\r\nimport { CharacterSelectionDropdownList } from '../Components/CharacterSelection';\r\nimport CustomFormControl from '../Components/CustomFormControl';\r\nimport { Stars } from '../Components/StarDisplay';\r\nimport Formula from '../Formula';\r\nimport InfoComponent from '../Components/InfoComponent';\r\nimport Stat from '../Stat';\r\nimport { ArtifactsBySlot, Build, BuildSetting } from '../Types/Build';\r\nimport { ICharacter } from '../Types/character';\r\nimport { allSlotKeys, ArtifactSetKey, CharacterKey, SetNum, SlotKey } from '../Types/consts';\r\nimport ICalculatedStats from '../Types/ICalculatedStats';\r\nimport { IFieldDisplay } from '../Types/IFieldDisplay';\r\nimport { useForceUpdate, usePromise } from '../Util/ReactUtil';\r\nimport { timeStringMs } from '../Util/TimeUtil';\r\nimport { crawlObject, deepClone, loadFromLocalStorage, saveToLocalStorage } from '../Util/Util';\r\nimport WeaponSheet from '../Weapon/WeaponSheet';\r\nimport { calculateTotalBuildNumber } from './Build';\r\nimport SlotNameWithIcon, { artifactSlotIcon } from '../Artifact/Component/SlotNameWIthIcon';\r\nimport { database } from '../Database/Database';\r\nimport { StatKey } from '../Types/artifact';\r\nconst InfoDisplay = React.lazy(() => import('./InfoDisplay'));\r\n\r\n//lazy load the character display\r\nconst CharacterDisplayCard = lazy(() => import('../Character/CharacterDisplayCard'))\r\n\r\nconst warningBuildNumber = 10000000\r\nconst maxBuildsToShowList = [50, 25, 10, 5]\r\nconst maxBuildsToShowDefault = 25\r\nconst autoBuildGenLimit = 100\r\nconst artifactsSlotsToSelectMainStats: SlotKey[] = [\"sands\", \"goblet\", \"circlet\"]\r\nconst initialBuildSettings = (): BuildSetting => ({\r\n  setFilters: [{ key: \"\", num: 0 }, { key: \"\", num: 0 }, { key: \"\", num: 0 }],\r\n  statFilters: {},\r\n  mainStatKeys: [\"\", \"\", \"\"],\r\n  optimizationTarget: \"finalATK\",\r\n  mainStatAssumptionLevel: 0,\r\n  useLockedArts: false,\r\n  useEquippedArts: false,\r\n  ascending: false,\r\n})\r\n\r\nfunction buildSettingsReducer(state: BuildSetting, action): BuildSetting {\r\n  switch (action.type) {\r\n    case 'mainStatKey': {\r\n      const { index, mainStatKey } = action\r\n      state.mainStatKeys[index] = mainStatKey\r\n      return { ...state, mainStatKeys: [...state.mainStatKeys] }//do this because this is a dependency, so needs to be a \"new\" array\r\n    }\r\n    case `setFilter`: {\r\n      const { index, key, num = 0 } = action\r\n      state.setFilters[index] = { key, num }\r\n      return { ...state, setFilters: [...state.setFilters] }//do this because this is a dependency, so needs to be a \"new\" array\r\n    }\r\n    default:\r\n      break;\r\n  }\r\n  return { ...state, ...action }\r\n}\r\n\r\nexport default function BuildDisplay({ location: { characterKey: propCharacterKey } }) {\r\n  const [characterKey, setcharacterKey] = useState(\"\" as CharacterKey | \"\")\r\n\r\n  const [builds, setbuilds] = useState([] as any[])\r\n  const [maxBuildsToShow, setmaxBuildsToShow] = useState(maxBuildsToShowDefault)\r\n\r\n  const [modalBuild, setmodalBuild] = useState(null) // the newBuild that is being displayed in the character modal\r\n  const [showArtCondModal, setshowArtCondModal] = useState(false)\r\n  const [showCharacterModal, setshowCharacterModal] = useState(false)\r\n\r\n  const [generatingBuilds, setgeneratingBuilds] = useState(false)\r\n  const [generationProgress, setgenerationProgress] = useState(0)\r\n  const [generationDuration, setgenerationDuration] = useState(0)//in ms\r\n  const [generationSkipped, setgenerationSkipped] = useState(0)\r\n\r\n  const [charDirty, setCharDirty] = useForceUpdate()\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n\r\n  const [artsDirty, setArtsDirty] = useForceUpdate()\r\n\r\n  const isMounted = useRef(false)\r\n\r\n  const worker = useRef(null as Worker | null)\r\n\r\n  type characterDataType = { character?: ICharacter, characterSheet?: CharacterSheet, weaponSheet?: WeaponSheet, initialStats?: ICalculatedStats, statsDisplayKeys?: { basicKeys: any, [key: string]: any } }\r\n  const [{ character, characterSheet, weaponSheet, initialStats, statsDisplayKeys }, setCharacterData] = useState({} as characterDataType)\r\n  const buildSettings = character?.buildSettings ?? initialBuildSettings()\r\n  const { setFilters, statFilters, mainStatKeys, optimizationTarget, mainStatAssumptionLevel, useLockedArts, useEquippedArts, ascending, } = buildSettings\r\n\r\n  const buildSettingsDispatch = useCallback((action) => {\r\n    if (!character) return\r\n    character.buildSettings = buildSettingsReducer(buildSettings as any, action)\r\n    database.updateChar(character)\r\n  }, [character, buildSettings])\r\n\r\n  useEffect(() => ReactGA.pageview('/build'), [])\r\n\r\n  //load the character data as a whole\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (!characterKey) return\r\n      const character = database._getChar(characterKey)\r\n      if (!character) return\r\n      const characterSheet = await CharacterSheet.get(characterKey)\r\n      const weaponSheet = await WeaponSheet.get(character.weapon.key)\r\n      if (!characterSheet || !weaponSheet) return\r\n      const initialStats = Character.createInitialStats(character, characterSheet, weaponSheet)\r\n      const statsDisplayKeys = Character.getDisplayStatKeys(initialStats, characterSheet)\r\n      setCharacterData({ character, characterSheet, weaponSheet, initialStats, statsDisplayKeys })\r\n    })()\r\n  }, [charDirty, characterKey])\r\n\r\n  //register changes in artifact database\r\n  useEffect(() =>\r\n    database.followAnyArt(setArtsDirty),\r\n    [setArtsDirty])\r\n\r\n  //register changes in character in db\r\n  useEffect(() =>\r\n    characterKey ? database.followChar(characterKey, setCharDirty) : undefined,\r\n    [characterKey, setCharDirty])\r\n\r\n  //terminate worker when component unmounts\r\n  useEffect(() => () => worker.current?.terminate(), [])\r\n\r\n  //select a new character Key\r\n  const selectCharacter = useCallback((cKey = \"\") => {\r\n    if (characterKey === cKey) return\r\n    setcharacterKey(cKey)\r\n    setbuilds([])\r\n    setCharDirty()\r\n    setCharacterData({})\r\n  }, [setCharDirty, setcharacterKey, characterKey])\r\n\r\n  //load saved stat from DB. will cause infinite loop if add 'selectCharacter' to dependency array\r\n  useEffect(() => {//startup load from localStorage\r\n    if (!(\"BuildsDisplay.state\" in localStorage)) return\r\n    const { characterKey = \"\", maxBuildsToShow = maxBuildsToShowDefault } = loadFromLocalStorage(\"BuildsDisplay.state\") ?? {}\r\n    if (characterKey && database._getChar(characterKey)) selectCharacter(characterKey)\r\n    setmaxBuildsToShow(maxBuildsToShow)\r\n  }, [])// eslint-disable-line react-hooks/exhaustive-deps\r\n  useEffect(() => propCharacterKey && selectCharacter(propCharacterKey), [propCharacterKey, selectCharacter])//update when props update\r\n\r\n  //save to BuildsDisplay.state on change\r\n  useEffect(() => {\r\n    if (isMounted.current) saveToLocalStorage(\"BuildsDisplay.state\", { characterKey, maxBuildsToShow })\r\n    else isMounted.current = true\r\n  }, [characterKey, maxBuildsToShow])\r\n\r\n  //validate optimizationTarget \r\n  useEffect(() => {\r\n    if (!statsDisplayKeys) return\r\n    if (!Array.isArray(optimizationTarget)) return\r\n    for (const sectionKey in statsDisplayKeys) {\r\n      const section = statsDisplayKeys[sectionKey]\r\n      for (const keys of section)\r\n        if (JSON.stringify(keys) === JSON.stringify(optimizationTarget)) return\r\n    }\r\n    buildSettingsDispatch({ optimizationTarget: initialBuildSettings().optimizationTarget })\r\n  }, [optimizationTarget, statsDisplayKeys, buildSettingsDispatch])\r\n\r\n  const { split, totBuildNumber } = useMemo(() => {\r\n    if (!characterKey) // Make sure we have all slotKeys\r\n      return { split: Object.fromEntries(allSlotKeys.map(slotKey => [slotKey, []])) as ArtifactsBySlot, totBuildNumber: 0 }\r\n    const artifactDatabase = database._getArts().filter(art => {\r\n      //if its equipped on the selected character, bypass the check\r\n      if (art.location === characterKey) return true\r\n\r\n      if (art.lock && !useLockedArts) return false\r\n      if (art.location && !useEquippedArts) return false\r\n      return true\r\n    })\r\n    const split = Artifact.splitArtifactsBySlot(artifactDatabase);\r\n    //filter the split slots on the mainstats selected.\r\n    artifactsSlotsToSelectMainStats.forEach((slotKey, index) =>\r\n      mainStatKeys[index] && (split[slotKey] = split[slotKey]?.filter((art) => art.mainStatKey === mainStatKeys[index])))\r\n    const totBuildNumber = calculateTotalBuildNumber(split, setFilters)\r\n    return artsDirty && { split, totBuildNumber }\r\n  }, [characterKey, useLockedArts, useEquippedArts, mainStatKeys, setFilters, artsDirty])\r\n\r\n  const generateBuilds = useCallback((turbo = false) => {\r\n    if (!initialStats || !artifactSheets) return\r\n    if (typeof turbo !== \"boolean\") turbo = false\r\n    setbuilds([])\r\n    setgeneratingBuilds(true)\r\n    setgenerationDuration(0)\r\n    setgenerationProgress(0)\r\n    setgenerationSkipped(0)\r\n    //get the formula for this target\r\n\r\n    initialStats.mainStatAssumptionLevel = mainStatAssumptionLevel\r\n    const artifactSetEffects = Artifact.setEffectsObjs(artifactSheets, initialStats)\r\n    const splitArtifacts = deepClone(split) as ArtifactsBySlot\r\n    //add mainStatVal to each artifact\r\n    Object.values(splitArtifacts).forEach(artArr => {\r\n      artArr!.forEach(art => {\r\n        art.mainStatVal = Artifact.mainStatValue(art.mainStatKey, art.numStars, Math.max(Math.min(mainStatAssumptionLevel, art.numStars * 4), art.level)) ?? 0;\r\n      })\r\n    })\r\n    //generate the key dependencies for the formula\r\n    const minFilters: Dict<StatKey, number> = Object.fromEntries(Object.entries(statFilters).map(([statKey, { min }]) => [statKey, min]).filter(([, min]) => typeof min === \"number\"))\r\n    const maxFilters: Dict<StatKey, number> = Object.fromEntries(Object.entries(statFilters).map(([statKey, { max }]) => [statKey, max]).filter(([, max]) => typeof max === \"number\"))\r\n    //create an obj with app the artifact set effects to pass to buildworker.\r\n    const data = {\r\n      splitArtifacts, initialStats, artifactSetEffects,\r\n      setFilters, minFilters, maxFilters, maxBuildsToShow, optimizationTarget, ascending, turbo\r\n    };\r\n    worker.current?.terminate()\r\n    worker.current = new Worker()\r\n    worker.current.onmessage = (e) => {\r\n      if (typeof e.data.progress === \"number\") {\r\n        const { progress, timing = 0, skipped = 0 } = e.data\r\n        setgenerationProgress(progress)\r\n        setgenerationDuration(timing)\r\n        setgenerationSkipped(skipped)\r\n        return\r\n      }\r\n      ReactGA.timing({\r\n        category: \"Build Generation\",\r\n        variable: \"timing\",\r\n        value: e.data.timing,\r\n        label: totBuildNumber.toString()\r\n      })\r\n      const builds = (e.data.builds as Build[]).map(obj =>\r\n        Character.calculateBuildwithArtifact(initialStats, obj.artifacts, artifactSheets))\r\n      setbuilds(builds)\r\n      setgeneratingBuilds(false)\r\n      worker.current?.terminate()\r\n      worker.current = null\r\n    };\r\n    worker.current.postMessage(data)\r\n  }, [artifactSheets, split, totBuildNumber, mainStatAssumptionLevel, ascending, initialStats, maxBuildsToShow, optimizationTarget, setFilters, statFilters])\r\n\r\n  //try to generate build when build numbers are low\r\n  useEffect(() => {\r\n    if (totBuildNumber && totBuildNumber <= autoBuildGenLimit) generateBuilds()\r\n    else setbuilds([])\r\n  }, [characterKey, split, totBuildNumber, buildSettings, generateBuilds])\r\n\r\n  const dropdownitemsForStar = useCallback((star, index) => artifactSheets && ArtifactSheet.setsWithMaxRarity(artifactSheets, star).map(([setKey, setobj]) => {\r\n    if (setFilters.some(filter => filter.key === setKey)) return false;\r\n    const setsNumArr = Object.keys(artifactSheets?.[setKey]?.setEffects ?? {})\r\n    const artsAccountedOther = setFilters.reduce((accu, cur, ind) => (cur.key && ind !== index) ? accu + cur.num : accu, 0)\r\n    if (setsNumArr.every((num: any) => parseInt(num) + artsAccountedOther > 5)) return false;\r\n    return (<Dropdown.Item key={setKey} onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: setKey, num: parseInt(setsNumArr[0] as any) ?? 0 })} >\r\n      {setobj.name}\r\n    </Dropdown.Item>)\r\n  }), [setFilters, buildSettingsDispatch, artifactSheets])\r\n\r\n  const characterName = characterSheet?.name ?? \"Character Name\"\r\n  const characterDropDown = useMemo(() => <DropdownButton title={characterName} disabled={generatingBuilds}>\r\n    <Dropdown.Item onClick={() => selectCharacter(\"\")}>Unselect Character</Dropdown.Item>\r\n    <Dropdown.Divider />\r\n    <CharacterSelectionDropdownList onSelect={cKey => selectCharacter(cKey)} />\r\n  </DropdownButton>, [characterName, generatingBuilds, selectCharacter])\r\n\r\n  const formula = usePromise(Array.isArray(optimizationTarget) ? Formula.get(optimizationTarget) : undefined, [optimizationTarget])\r\n  const sortByText = useMemo(() => {\r\n    if (Array.isArray(optimizationTarget)) {\r\n      if (!formula) return null\r\n      let [type, , talentKey] = (formula as any).keys as string[]\r\n      const field = (formula as any).field as IFieldDisplay\r\n      const variant = Character.getTalentFieldValue(field, \"variant\", initialStats)\r\n      const text = Character.getTalentFieldValue(field, \"text\", initialStats)\r\n      if (type === \"character\") {\r\n        if (talentKey === \"normal\" || talentKey === \"charged\" || talentKey === \"plunging\") talentKey = \"auto\"\r\n        return <b>{characterSheet?.getTalentOfKey(talentKey, initialStats?.characterEle)?.name}: <span className={`text-${variant}`}>{text}</span></b>\r\n      } else if (type === \"weapon\") {\r\n        return <b>{weaponSheet?.name}: <span className={`text-${variant}`}>{text}</span></b>\r\n      }\r\n    } else return <b>Basic Stat: <span className={`text-${Stat.getStatVariant(optimizationTarget)}`}>{Stat.getStatNamePretty(optimizationTarget)}</span></b>\r\n    // return <Badge variant=\"danger\">INVALID</Badge>\r\n  }, [optimizationTarget, formula, initialStats, characterSheet, weaponSheet])\r\n\r\n\r\n  const artsAccounted = setFilters.reduce((accu, cur) => cur.key ? accu + cur.num : accu, 0)\r\n  const artifactCondCount = useMemo(() => {\r\n    let count = 0;\r\n    crawlObject(initialStats?.conditionalValues?.artifact, [], v => Array.isArray(v), () => count++)\r\n    return count\r\n  }, [initialStats?.conditionalValues])\r\n  //rudimentary dispatcher, definitely not the same API as the real characterDispatch.\r\n  const characterDispatch = useCallback(val => database.updateChar({ ...character, ...val }), [character])\r\n\r\n  const hasMinFilters = Object.entries(statFilters).some(([statKey, { min }]) => typeof min === \"number\")\r\n  const hasMaxFilters = Object.entries(statFilters).some(([statKey, { max }]) => typeof max === \"number\")\r\n  const disabledTurbo = ascending ? hasMinFilters : hasMaxFilters\r\n\r\n  return <Container className=\"mt-2\">\r\n    <InfoComponent\r\n      pageKey=\"buildPage\"\r\n      modalTitle=\"Character Management Page Guide\"\r\n      text={[\"For self-infused attacks, like Noelle's Sweeping Time, enable the skill in the talent page.\",\r\n        \"You can compare the difference between equipped artifacts and generated builds.\",\r\n        \"TURBO mode can process millions of builds in seconds.\",\r\n        \"The more complex the formula, the longer the generation time.\",]}\r\n    ><InfoDisplay /></InfoComponent>\r\n    <BuildModal {...{ build: modalBuild, showCharacterModal, characterKey, selectCharacter, setmodalBuild, setshowCharacterModal }} />\r\n    {!!initialStats && <ArtConditionalModal {...{ showArtCondModal, setshowArtCondModal, initialStats, characterDispatch, artifactCondCount }} />}\r\n    <Row className=\"mt-2 mb-2\">\r\n      <Col>\r\n        {/* Build Generator Editor */}\r\n        <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n          <Card.Header>Build Generator</Card.Header>\r\n          <Card.Body>\r\n            <Row >\r\n              <Col xs={12} lg={6}>\r\n                {/* character selection */}\r\n                {characterKey ?\r\n                  <CharacterCard header={characterDropDown} characterKey={characterKey} bg={\"lightcontent\"} cardClassName=\"mb-2\" onEdit={!generatingBuilds ? () => setshowCharacterModal(true) : undefined} /> :\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n                    <Card.Header>\r\n                      {characterDropDown}\r\n                    </Card.Header>\r\n                  </Card>}\r\n                {/* Hit mode options */}\r\n                {characterSheet && character && initialStats && <HitModeCard build={initialStats} characterSheet={characterSheet} className=\"mb-2\" character={character} />}\r\n                {/* Final Stat Filter */}\r\n                {Boolean(statsDisplayKeys) && <StatFilterCard className=\"mb-2\" statFilters={statFilters} statKeys={statsDisplayKeys?.basicKeys as any} setStatFilters={sFs => buildSettingsDispatch({ statFilters: sFs })} />}\r\n              </Col>\r\n              <Col xs={12} lg={6}><Row>\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}><Card.Body>\r\n                    <Button className=\"w-100\" onClick={() => setshowArtCondModal(true)} disabled={generatingBuilds}>\r\n                      <span>Default Artifact Set Effects {Boolean(artifactCondCount) && <Badge variant=\"success\">{artifactCondCount} Selected</Badge>}</span>\r\n                    </Button>\r\n                  </Card.Body></Card>\r\n                </Col>\r\n                {/* Artifact set picker */}\r\n                {setFilters.map(({ key: setKey, num: setNum }, index) => <Col className=\"mb-2\" key={index} xs={12}>\r\n                  <Card className=\"h-100\" bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                    <Card.Header>\r\n                      <ButtonGroup>\r\n                        {/* Artifact set */}\r\n                        <DropdownButton as={ButtonGroup} title={artifactSheets?.[setKey]?.name ?? \"Artifact Set Filter\"} disabled={generatingBuilds}>\r\n                          <Dropdown.Item onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: \"\" })}>Unselect Artifact</Dropdown.Item>\r\n                          <Dropdown.ItemText>Max Rarity </Dropdown.ItemText>\r\n                          {dropdownitemsForStar(5, index)}\r\n                          <Dropdown.Divider />\r\n                          <Dropdown.ItemText>Max Rarity </Dropdown.ItemText>\r\n                          {dropdownitemsForStar(4, index)}\r\n                          <Dropdown.Divider />\r\n                          <Dropdown.ItemText>Max Rarity </Dropdown.ItemText>\r\n                          {dropdownitemsForStar(3, index)}\r\n                        </DropdownButton>\r\n                        {/* set number */}\r\n                        <DropdownButton as={ButtonGroup} title={`${setNum}-set`}\r\n                          disabled={generatingBuilds || !setKey || artsAccounted >= 5}\r\n                        >\r\n                          {!!initialStats && Object.keys(artifactSheets?.[setKey]?.setEffects ?? {}).map((num: any) => {\r\n                            let artsAccountedOther = setFilters.reduce((accu, cur) => (cur.key && cur.key !== setKey) ? accu + cur.num : accu, 0)\r\n                            return (parseInt(num) + artsAccountedOther <= 5) &&\r\n                              (<Dropdown.Item key={num} onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: setFilters[index].key, num: parseInt(num) })} >\r\n                                {`${num}-set`}\r\n                              </Dropdown.Item>)\r\n                          })}\r\n                        </DropdownButton>\r\n                      </ButtonGroup>\r\n                    </Card.Header>\r\n                    {setKey ? <Card.Body><Row className=\"mb-n2\">\r\n                      {!!initialStats && Object.keys(artifactSheets?.[setKey].setEffects ?? {}).map(setNKey => parseInt(setNKey) as SetNum).filter(setNkey => setNkey <= setNum).map(setNumKey =>\r\n                        <SetEffectDisplay newBuild={undefined} key={setKey + setNumKey} {...{ setKey, setNumKey, equippedBuild: initialStats, characterDispatch, editable: true }} />)}\r\n                    </Row></Card.Body> : null}\r\n                  </Card>\r\n                </Col>)}\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}><Card.Body className=\"mb-n2\">\r\n                    <Button className=\"w-100 mb-2\" onClick={() => buildSettingsDispatch({ useEquippedArts: !useEquippedArts })} disabled={generatingBuilds}>\r\n                      <span><FontAwesomeIcon icon={useEquippedArts ? faCheckSquare : faSquare} /> Use Equipped Artifacts</span>\r\n                    </Button>\r\n                    <Button className=\"w-100 mb-2\" onClick={() => buildSettingsDispatch({ useLockedArts: !useLockedArts })} disabled={generatingBuilds}>\r\n                      <span><FontAwesomeIcon icon={useLockedArts ? faCheckSquare : faSquare} /> Use Locked Artifacts</span>\r\n                    </Button>\r\n                  </Card.Body></Card>\r\n                </Col>\r\n                {/* main stat selector */}\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                    <Card.Header>\r\n                      <Row>\r\n                        <Col>Artifact Main Stat</Col>\r\n                        <Col xs=\"auto\"><AssumeFullLevelToggle mainStatAssumptionLevel={mainStatAssumptionLevel} setmainStatAssumptionLevel={v => buildSettingsDispatch({ mainStatAssumptionLevel: v })} /></Col>\r\n                      </Row>\r\n                    </Card.Header>\r\n                    <Card.Body className=\"mb-n2\">\r\n                      {artifactsSlotsToSelectMainStats.map((slotKey, index) =>\r\n                      (<div className=\"text-inline mb-1 d-flex justify-content-between\" key={slotKey}>\r\n                        <h6 className=\"d-inline mb-0\"><SlotNameWithIcon slotKey={slotKey} /></h6>\r\n                        <DropdownButton disabled={generatingBuilds} size=\"sm\"\r\n                          title={mainStatKeys[index] ? Stat.getStatNameWithPercent(mainStatKeys[index]) : \"Select a mainstat\"}\r\n                          className=\"d-inline\">\r\n                          <Dropdown.Item onClick={() => buildSettingsDispatch({ type: \"mainStatKey\", index, mainStatKey: \"\" })} >No MainStat</Dropdown.Item>\r\n                          {Artifact.slotMainStats(slotKey).map(mainStatKey =>\r\n                            <Dropdown.Item onClick={() => buildSettingsDispatch({ type: \"mainStatKey\", index, mainStatKey })} key={mainStatKey}>\r\n                              {Stat.getStatNameWithPercent(mainStatKey)}\r\n                            </Dropdown.Item>)}\r\n                        </DropdownButton>\r\n                      </div>))}\r\n                    </Card.Body>\r\n                  </Card>\r\n                </Col>\r\n              </Row></Col>\r\n            </Row>\r\n            <Row className=\"mb-2\">\r\n              <Col>{!!characterKey && <BuildAlert {...{ totBuildNumber, generatingBuilds, generationSkipped, generationProgress, generationDuration, characterName, maxBuildsToShow }} />}</Col>\r\n            </Row>\r\n            <Row className=\"d-flex justify-content-between\">\r\n              <Col xs=\"auto\" >\r\n                <ButtonGroup>\r\n                  <Button\r\n                    className=\"h-100\"\r\n                    disabled={!characterKey || generatingBuilds}\r\n                    variant={(characterKey && totBuildNumber <= warningBuildNumber) ? \"success\" : \"warning\"}\r\n                    onClick={generateBuilds}\r\n                  ><span>Generate Builds</span></Button>\r\n                  {totBuildNumber > warningBuildNumber && <OverlayTrigger\r\n                    overlay={<Tooltip id=\"turbo-tooltip\">\r\n                      <div>Dramatically speeds up build time.</div>\r\n                      <div>Yields only 1 build.</div>\r\n                      {Boolean(disabledTurbo) && <div className=\"mt-2\">Does not work with <b>{Boolean(ascending) ? 'min' : 'max'}imum</b> stat filter when sorting by <b>{Boolean(ascending) ? 'as' : 'des'}cending</b></div>}\r\n                    </Tooltip>}\r\n                  ><span >\r\n                      <Button variant=\"success\" disabled={disabledTurbo} className={`rounded-0 ${disabledTurbo ? \"cursor-pointer\" : \"\"}`} onClick={() => generateBuilds(true)}><strong>TURBO</strong></Button>\r\n                    </span></OverlayTrigger>}\r\n                  <Button\r\n                    className=\"h-100\"\r\n                    disabled={!generatingBuilds}\r\n                    variant=\"danger\"\r\n                    onClick={() => {\r\n                      if (!worker.current) return;\r\n                      worker.current.terminate();\r\n                      worker.current = null\r\n                      setgeneratingBuilds(false)\r\n                      setbuilds([])\r\n                      setgenerationDuration(0)\r\n                      setgenerationProgress(0)\r\n                      setgenerationSkipped(0)\r\n                    }}\r\n                  ><span>Cancel</span></Button>\r\n                </ButtonGroup>\r\n              </Col>\r\n              <Col xs=\"auto\">\r\n                {/* Dropdown to select sorting value */}\r\n                {<ButtonGroup>\r\n                  <Dropdown as={ButtonGroup} drop=\"up\">\r\n                    <Dropdown.Toggle disabled={generatingBuilds} variant=\"light\" >\r\n                      <span>Optimization Target: {sortByText}</span>\r\n                    </Dropdown.Toggle>\r\n                    <Dropdown.Menu align=\"right\" style={{ minWidth: \"40rem\" }} >\r\n                      <Row>\r\n                        {!!statsDisplayKeys && Object.entries(statsDisplayKeys).map(([sectionKey, fields]: [string, any]) => {\r\n                          const header = (characterSheet && weaponSheet) ? Character.getDisplayHeading(sectionKey, characterSheet, weaponSheet, initialStats?.characterEle) : sectionKey\r\n                          return <Col xs={12} md={6} key={sectionKey}>\r\n                            <Dropdown.Header style={{ overflow: \"hidden\", textOverflow: \"ellipsis\" }}><b>{header}</b></Dropdown.Header>\r\n                            {fields.map((target, i) => {\r\n                              if (Array.isArray(target))\r\n                                return <TargetSelectorDropdownItem key={i} {...{ target, buildSettingsDispatch, initialStats }} />\r\n                              else if (typeof target === \"string\")\r\n                                return <Dropdown.Item key={i} onClick={() => buildSettingsDispatch({ optimizationTarget: target })}>{Stat.getStatNamePretty(target)}</Dropdown.Item>\r\n                              return null\r\n                            })}\r\n                          </Col>\r\n                        })}\r\n                      </Row>\r\n                    </Dropdown.Menu>\r\n                  </Dropdown>\r\n                  <Button onClick={() => buildSettingsDispatch({ ascending: !buildSettings.ascending })} disabled={generatingBuilds} variant={ascending ? \"danger\" : \"primary\"}>\r\n                    <FontAwesomeIcon icon={ascending ? faSortAmountDownAlt : faSortAmountUp} className=\"fa-fw\" />\r\n                    <span>{ascending ? \"Ascending\" : \"Descending\"}</span>\r\n                  </Button>\r\n                </ButtonGroup >}\r\n              </Col>\r\n            </Row>\r\n          </Card.Body>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n    <Row className=\"mb-2\">\r\n      <Col>\r\n        <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n          <Card.Header>\r\n            <Row>\r\n              <Col>{characterKey ? <span>Showing <b>{builds.length}</b> Builds generated for {characterName}</span> : <span>Select a character to generate builds.</span>}</Col>\r\n              <Col xs=\"auto\">\r\n                <DropdownButton title={<span>Max builds to show: <b>{maxBuildsToShow}</b></span>} size=\"sm\">\r\n                  {maxBuildsToShowList.map(v => <Dropdown.Item key={v} onClick={() => setmaxBuildsToShow(v)}>{v}</Dropdown.Item>)}\r\n                </DropdownButton>\r\n              </Col>\r\n            </Row>\r\n          </Card.Header>\r\n          {/* Build List */}\r\n          <ListGroup>\r\n            {builds.map((build, index) =>\r\n              index < maxBuildsToShow && characterSheet && weaponSheet && <ArtifactDisplayItem characterSheet={characterSheet} weaponSheet={weaponSheet} build={build} characterKey={characterKey as CharacterKey} index={index} key={index} statsDisplayKeys={statsDisplayKeys} onClick={() => setmodalBuild(build as any)} />\r\n            )}\r\n          </ListGroup>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n  </Container >\r\n}\r\n\r\nfunction TargetSelectorDropdownItem({ target, buildSettingsDispatch, initialStats }) {\r\n  const formula = usePromise(Formula.get(target), [target])\r\n  if (!formula) return null\r\n  const talentField = (formula as any).field as IFieldDisplay\r\n  return <Dropdown.Item onClick={() => buildSettingsDispatch({ optimizationTarget: target })} style={{ overflow: \"hidden\", textOverflow: \"ellipsis\" }}>\r\n    <span className={`text-${Character.getTalentFieldValue(talentField, \"variant\", initialStats)}`}>{Character.getTalentFieldValue(talentField, \"text\", initialStats)}</span>\r\n  </Dropdown.Item>\r\n}\r\n\r\nfunction BuildModal({ build, showCharacterModal, characterKey, selectCharacter, setmodalBuild, setshowCharacterModal }) {\r\n  const closeModal = useCallback(() => {\r\n    setmodalBuild(null)\r\n    setshowCharacterModal(false)\r\n  }, [setmodalBuild, setshowCharacterModal])\r\n  return <Modal show={Boolean(showCharacterModal || build)} onHide={closeModal} size=\"xl\" contentClassName=\"bg-transparent\">\r\n    <React.Suspense fallback={<span>Loading...</span>}>\r\n      <CharacterDisplayCard\r\n        character={undefined}\r\n        tabName={undefined}\r\n        characterKey={characterKey}\r\n        setCharacterKey={cKey => selectCharacter(cKey)}\r\n        newBuild={build}\r\n        onClose={closeModal}\r\n        editable={showCharacterModal}\r\n        footer={<Button variant=\"danger\" onClick={closeModal}>Close</Button>} />\r\n    </React.Suspense>\r\n  </Modal>\r\n}\r\n\r\nfunction ArtConditionalModal({ showArtCondModal, setshowArtCondModal, initialStats, characterDispatch, artifactCondCount }) {\r\n  const closeArtCondModal = useCallback(() => setshowArtCondModal(false), [setshowArtCondModal])\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n  if (!artifactSheets) return null\r\n  const artSetKeyList = ArtifactSheet.namesByMaxRarities(artifactSheets).flatMap(([, items]) => items.map(([key]) => [key, artifactSheets[key]] as const))\r\n  return <Modal show={showArtCondModal} onHide={closeArtCondModal} size=\"xl\" contentClassName=\"bg-transparent\">\r\n    <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n      <Card.Header>\r\n        <Row>\r\n          <Col>\r\n            <h5>Default Artifact Set Effects  {Boolean(artifactCondCount) && <Badge variant=\"success\">{artifactCondCount} Selected</Badge>}</h5>\r\n          </Col>\r\n          <Col xs=\"auto\" >\r\n            <Button onClick={() => {\r\n              if (initialStats.conditionalValues.artifact) initialStats.conditionalValues.artifact = {}\r\n              characterDispatch({ conditionalValues: initialStats.conditionalValues })\r\n            }}><span><FontAwesomeIcon icon={faUndo} /> Reset All</span></Button>\r\n          </Col>\r\n          <Col xs=\"auto\" >\r\n            <Button variant=\"danger\" onClick={closeArtCondModal}>\r\n              <FontAwesomeIcon icon={faTimes} /></Button>\r\n          </Col>\r\n        </Row>\r\n      </Card.Header>\r\n      <Card.Body>\r\n        <Row>\r\n          {artSetKeyList.map(([setKey, sheet]) => {\r\n            let icon = Object.values(sheet.slotIcons)[0]\r\n            let numStars = [...sheet.rarity][0]\r\n            return <Col className=\"mb-2\" key={setKey} xs={12} lg={6} xl={4}>\r\n              <Card className=\"h-100\" bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                <Card.Header >\r\n                  <Row>\r\n                    <Col xs=\"auto\" className=\"ml-n3 my-n2\">\r\n                      <Image src={icon} className={`thumb-mid grad-${numStars}star m-1`} thumbnail />\r\n                    </Col>\r\n                    <Col >\r\n                      <h6><b>{artifactSheets?.[setKey].name ?? \"\"}</b></h6>\r\n                      <span><Stars stars={numStars} /></span>\r\n                    </Col>\r\n                  </Row>\r\n                </Card.Header>\r\n                <Card.Body><Row className=\"mb-n2\">\r\n                  {Boolean(setKey) && Object.keys(sheet.setEffects).map(key => parseInt(key) as SetNum).map(setNumKey =>\r\n                    <SetEffectDisplay newBuild={undefined} key={setKey + setNumKey} {...{ setKey, setNumKey, equippedBuild: initialStats, editable: true, characterDispatch, }} />)}\r\n                </Row></Card.Body>\r\n              </Card>\r\n            </Col>\r\n          })}\r\n        </Row>\r\n      </Card.Body>\r\n      <Card.Footer>\r\n        <Button variant=\"danger\" onClick={closeArtCondModal}>\r\n          <FontAwesomeIcon icon={faTimes} /> CLOSE</Button>\r\n      </Card.Footer>\r\n    </Card>\r\n  </Modal>\r\n}\r\n\r\nfunction StatFilterItem({ statKey, statKeys = [], min, max, close, setFilter }: {\r\n  statKey?, statKeys, min, max, close, setFilter\r\n}) {\r\n  const isFloat = Stat.getStatUnit(statKey) === \"%\"\r\n  const inputProps = {\r\n    disabled: !statKey,\r\n    allowEmpty: true,\r\n    float: isFloat,\r\n  }\r\n  const minInputProps = {\r\n    ...inputProps,\r\n    placeholder: \"MIN\",\r\n    value: min,\r\n    onChange: (s) => setFilter(statKey, s, max)\r\n  }\r\n  const maxInputProps = {\r\n    ...inputProps,\r\n    placeholder: \"MAX\",\r\n    value: max,\r\n    onChange: (s) => setFilter(statKey, min, s)\r\n  }\r\n  return <InputGroup className=\"mb-2\">\r\n    <DropdownButton\r\n      as={InputGroup.Prepend}\r\n      title={Stat.getStatNamePretty(statKey, \"New Stat\")}\r\n      id=\"input-group-dropdown-1\"\r\n    >\r\n      {statKeys.map(sKey => <Dropdown.Item key={sKey} onClick={() => { close?.(); setFilter(sKey, min, max) }}>{Stat.getStatNamePretty(sKey)}</Dropdown.Item>)}\r\n    </DropdownButton>\r\n    <CustomFormControl {...minInputProps} />\r\n    <CustomFormControl {...maxInputProps} />\r\n    {Boolean(close) && <InputGroup.Append>\r\n      <Button variant=\"danger\" onClick={close}><FontAwesomeIcon icon={faTrash} /></Button>\r\n    </InputGroup.Append>}\r\n  </InputGroup>\r\n}\r\n\r\nfunction HitModeCard({ characterSheet, character, build, className }: { characterSheet: CharacterSheet, character: ICharacter, build: ICalculatedStats, className: string }) {\r\n  const setHitmode = useCallback(({ hitMode }) => database.updateChar({ ...character, hitMode }), [character])\r\n  const setReactionMode = useCallback(({ reactionMode }) => database.updateChar({ ...character, reactionMode }), [character])\r\n  const setInfusionAura = useCallback(({ infusionAura }) => database.updateChar({ ...character, infusionAura }), [character])\r\n  if (!character) return null\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className={className}>\r\n    <Card.Header>\r\n      <Row>\r\n        <Col>Hit Mode Options</Col>\r\n        <Col xs=\"auto\"><InfusionAuraDropdown characterSheet={characterSheet} character={character} characterDispatch={setInfusionAura} /></Col>\r\n      </Row>\r\n    </Card.Header>\r\n    <Card.Body className=\"mb-n2\">\r\n      <HitModeToggle hitMode={character.hitMode} characterDispatch={setHitmode} className=\"w-100 mb-2\" />\r\n      <ReactionToggle build={build} character={character} characterDispatch={setReactionMode} className=\"w-100 mb-2\" />\r\n    </Card.Body>\r\n  </Card >\r\n}\r\n\r\nfunction StatFilterCard({ statKeys = [], statFilters = {}, setStatFilters, className }) {\r\n  const remainingKeys = statKeys.filter(key => !(Object.keys(statFilters) as any).some(k => k === key))\r\n  const setFilter = (sKey, min, max) => setStatFilters({ ...statFilters, [sKey]: { min, max } })\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className={className}>\r\n    <Card.Header>Final Stat Filter</Card.Header>\r\n    <Card.Body>\r\n      <Row className=\"mb-n2\">\r\n        {(Object.entries(statFilters) as [string, { min, max }][]).map(([statKey, { min, max }]) => {\r\n          return <Col xs={12} key={statKey} ><StatFilterItem statKey={statKey} statKeys={remainingKeys} setFilter={setFilter} min={min} max={max} close={() => {\r\n            delete statFilters[statKey]\r\n            setStatFilters({ ...statFilters })\r\n          }} /></Col>\r\n        })}\r\n        <Col xs={12}>\r\n          <StatFilterItem min={undefined} max={undefined} close={undefined} statKeys={remainingKeys} setFilter={setFilter} />\r\n        </Col>\r\n      </Row>\r\n    </Card.Body>\r\n  </Card>\r\n}\r\n\r\ntype ArtifactDisplayItemProps = { characterSheet: CharacterSheet, weaponSheet: WeaponSheet, index: number, characterKey: CharacterKey, build: ICalculatedStats, statsDisplayKeys: any, onClick: () => void }\r\n//for displaying each artifact build\r\nfunction ArtifactDisplayItem({ characterSheet, weaponSheet, index, characterKey, build, statsDisplayKeys, onClick }: ArtifactDisplayItemProps) {\r\n  const sheets = usePromise(ArtifactSheet.getAll(), [])\r\n  const character = database._getChar(characterKey)\r\n  if (!character) return null\r\n  const { equippedArtifacts } = character\r\n  const currentlyEquipped = allSlotKeys.every(slotKey => equippedArtifacts[slotKey] === build.equippedArtifacts?.[slotKey])\r\n  return (<div>\r\n    <ListGroup.Item\r\n      variant={index % 2 ? \"customdark\" : \"customdarker\"} className=\"text-white\" action\r\n      onClick={onClick}\r\n    >\r\n      <h5 className=\"mb-2\"><Row>\r\n        <Col xs=\"auto\">\r\n          <Badge variant=\"info\"><strong>{index + 1}{currentlyEquipped ? \" (Equipped)\" : \"\"}</strong></Badge>\r\n        </Col>\r\n        <Col xs=\"auto\">{(Object.entries(build.setToSlots) as [ArtifactSetKey, SlotKey[]][]).sort(([key1, slotarr1], [key2, slotarr2]) => slotarr2.length - slotarr1.length).map(([key, slotarr]) =>\r\n          <Badge key={key} variant={currentlyEquipped ? \"success\" : \"primary\"} className=\"mr-2\">\r\n            {slotarr.map(slotKey => artifactSlotIcon(slotKey))} {sheets?.[key].name ?? \"\"}\r\n          </Badge>\r\n        )}</Col>\r\n      </Row></h5>\r\n      <StatDisplayComponent editable={false} {...{ characterSheet, weaponSheet, character, newBuild: build, statsDisplayKeys, cardbg: (index % 2 ? \"lightcontent\" : \"darkcontent\") }} />\r\n    </ListGroup.Item>\r\n  </div>)\r\n}\r\n\r\nfunction BuildAlert({ totBuildNumber, generatingBuilds, generationSkipped, generationProgress, generationDuration, characterName, maxBuildsToShow }) {\r\n  const totalBuildNumberString = totBuildNumber?.toLocaleString() ?? totBuildNumber\r\n  const totalUnskipped = totBuildNumber - generationSkipped\r\n  const generationProgressString = generationProgress?.toLocaleString() ?? generationProgress\r\n  const generationSkippedString = generationSkipped?.toLocaleString() ?? generationSkipped\r\n  const totalUnskippedString = totalUnskipped?.toLocaleString() ?? totalUnskipped\r\n  const generationSkippedText = Boolean(generationSkipped) && <span>(<b>{generationSkippedString}</b> skipped)</span>\r\n  if (generatingBuilds) {\r\n    let progPercent = generationProgress * 100 / (totalUnskipped)\r\n    return <Alert variant=\"success\">\r\n      <span>Generating and testing <b className=\"text-monospace\">{generationProgressString}/{totalUnskippedString}</b> build configurations against the criteria for <b>{characterName}</b>. {generationSkippedText}</span><br />\r\n      <h6>Time elapsed: <strong className=\"text-monospace\">{timeStringMs(generationDuration)}</strong></h6>\r\n      <ProgressBar now={progPercent} label={`${progPercent.toFixed(1)}%`} />\r\n    </Alert>\r\n  } else if (!generatingBuilds && generationProgress) {//done\r\n    return <Alert variant=\"success\">\r\n      <span>Generated and tested <b className=\"text-monospace\">{totalUnskippedString}</b> Build configurations against the criteria for <b>{characterName}</b>. {generationSkippedText}</span>\r\n      <h6>Total duration: <strong className=\"text-monospace\">{timeStringMs(generationDuration)}</strong></h6>\r\n      <ProgressBar now={100} variant=\"success\" label=\"100%\" />\r\n    </Alert>\r\n  } else {\r\n    return totBuildNumber === 0 ?\r\n      <Alert variant=\"warning\" className=\"mb-0\"><span>Current configuration will not generate any builds for <b>{characterName}</b>. Please change your Artifact configurations, or add/unlock more Artifacts.</span></Alert>\r\n      : (totBuildNumber > warningBuildNumber ?\r\n        <Alert variant=\"warning\" className=\"mb-0\"><span>Current configuration will generate <b>{totalBuildNumberString}</b> builds for <b>{characterName}</b>. This might take quite a while to generate...</span></Alert> :\r\n        <Alert variant=\"success\" className=\"mb-0\"><span>Current configuration {totBuildNumber <= maxBuildsToShow ? \"generated\" : \"will generate\"} <b>{totalBuildNumberString}</b> builds for <b>{characterName}</b>.</span></Alert>)\r\n  }\r\n}\r\n\r\nconst levels = {\r\n  0: <span>No level assumption</span>,\r\n  4: <span>Assume at least level 4</span>,\r\n  8: <span>Assume at least level 8</span>,\r\n  12: <span>Assume at least level 12</span>,\r\n  16: <span>Assume at least level 16</span>,\r\n  20: <span>Assume at least level 20</span>\r\n}\r\nfunction AssumeFullLevelToggle({ mainStatAssumptionLevel = 0, setmainStatAssumptionLevel }) {\r\n  return <OverlayTrigger overlay={<Tooltip id=\"assume-level-tooltip\">Change Main Stat value to be at least a specific level. Does not change substats.</Tooltip>}  >\r\n    <Dropdown>\r\n      <Dropdown.Toggle variant={mainStatAssumptionLevel ? \"orange\" : \"primary\"}>{levels[mainStatAssumptionLevel]}</Dropdown.Toggle>\r\n      <Dropdown.Menu>\r\n        {Object.entries(levels).map(([key, text]) => <Dropdown.Item key={key} onClick={() => setmainStatAssumptionLevel(parseInt(key))}>{text}</Dropdown.Item>)}\r\n      </Dropdown.Menu>\r\n    </Dropdown>\r\n  </OverlayTrigger>\r\n}\r\n"],"sourceRoot":""}