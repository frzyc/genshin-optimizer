{"version":3,"sources":["Build/Build.ts","../node_modules/react-bootstrap/esm/AccordionContext.js","../node_modules/react-bootstrap/esm/AccordionToggle.js","../node_modules/react-bootstrap/esm/Tooltip.js","../node_modules/react-bootstrap/esm/InputGroup.js","../node_modules/react-bootstrap/esm/DropdownButton.js","Util/TimeUtil.ts","../node_modules/react-bootstrap/esm/TabContainer.js","../node_modules/react-bootstrap/esm/TabContent.js","../node_modules/react-bootstrap/esm/TabPane.js","../node_modules/react-bootstrap/esm/Tab.js","../node_modules/react-bootstrap/esm/ListGroupItem.js","../node_modules/react-bootstrap/esm/ListGroup.js","../node_modules/react-bootstrap/esm/AccordionCollapse.js","../node_modules/react-bootstrap/esm/Accordion.js","../node_modules/react-bootstrap/esm/ProgressBar.js","Build/BuildWorker.ts","Build/BuildDisplay.tsx"],"names":["calculateTotalBuildNumber","artifactsBySlot","setFilters","setKeys","Set","map","i","key","filteredArtifactsBySlot","slotKeys","Object","keys","slotKey","artifactsBySet","artifact","has","setKey","push","freeze","setCount","accu","result","slotPerm","index","length","num","artifactSetPermutations","reduce","entries","artifacts","getTalentStatKey","skillKey","stats","overwriteElement","hitMode","infusionAura","infusionSelf","reactionMode","characterEle","weaponType","ElementalData","includes","startsWith","eleKey","getTalentStatKeyVariant","context","React","createContext","displayName","_excluded","useAccordionToggle","eventKey","onClick","contextEventKey","useContext","AccordionContext","onSelect","SelectableContext","e","AccordionToggle","forwardRef","_ref","ref","_ref$as","as","Component","children","props","_objectWithoutPropertiesLoose","accordionOnClick","type","createElement","_extends","Tooltip","bsPrefix","placement","className","style","arrowProps","popper","show","useBootstrapPrefix","primaryPlacement","split","role","classNames","defaultProps","InputGroupAppend","createWithBsPrefix","InputGroupPrepend","InputGroupText","InputGroup","size","hasValidation","InputGroupWithExtras","Text","Radio","Checkbox","Append","Prepend","propTypes","id","PropTypes","any","href","string","func","title","node","isRequired","disabled","bool","menuAlign","alignPropType","menuRole","renderMenuOnMount","rootCloseEvent","variant","DropdownButton","Dropdown","DropdownToggle","childBsPrefix","DropdownMenu","align","renderOnMount","msToUnits","ms","milliseconds","seconds","Math","floor","minutes","hours","timeString","timeText","strPadLeft","timeStringMs","TabContainer","_useUncontrolled","useUncontrolled","activeKey","generateCustomChildId","generateChildId","transition","mountOnEnter","unmountOnExit","useMemo","tabContext","getControlledId","getControllerId","TabContext","Provider","value","TabContent","decoratedBsPrefix","_excluded2","TabPane","_useTabContext","rest","shouldTransition","makeEventKey","active","Fade","useTabContext","onEnter","onEntering","onEntered","onExit","onExiting","onExited","Transition","_useTabContext$as","prefix","pane","in","Tab","_React$Component","apply","this","arguments","_inheritsLoose","prototype","render","Error","Container","Content","Pane","undefined","ListGroupItem","action","handleClick","useCallback","event","preventDefault","stopPropagation","tabIndex","AbstractNavItem","horizontal","ListGroup","horizontalVariant","initialBsPrefix","_useUncontrolled$as","controlledProps","AbstractNav","Item","AccordionCollapse","Collapse","Children","only","Accordion","finalClassName","Toggle","_excluded3","getPercentage","now","min","max","percentage","round","renderProgressBar","_classNames","label","srOnly","striped","animated","width","ProgressBar","_ref2","isChild","wrapperProps","child","cloneElement","Worker_fn","Worker","InfoDisplay","lazy","CharacterDisplayCard","warningBuildNumber","maxBuildsToShowList","artifactsSlotsToSelectMainStats","BuildDisplay","propCharacterKey","location","characterKey","useState","dbStorage","get","setcharacterKey","builds","setbuilds","maxBuildsToShow","setmaxBuildsToShow","modalBuild","setmodalBuild","showArtCondModal","setshowArtCondModal","showCharacterModal","setshowCharacterModal","generatingBuilds","setgeneratingBuilds","generationProgress","setgenerationProgress","generationDuration","setgenerationDuration","generationSkipped","setgenerationSkipped","useForceUpdate","charDirty","setCharDirty","artifactSheets","usePromise","ArtifactSheet","getAll","artsDirty","setArtsDirty","isMounted","useRef","worker","character","characterSheet","weaponSheet","initialStats","statsDisplayKeys","setCharacterData","buildSettings","initialBuildSettings","statFilters","mainStatKeys","optimizationTarget","mainStatAssumptionLevel","useLockedArts","useEquippedArts","ascending","buildSettingsDispatch","state","mainStatKey","filter","k","buildSettingsReducer","database","updateChar","useEffect","ReactGA","pageview","selectCharacter","cKey","a","_getChar","CharacterSheet","WeaponSheet","weapon","Character","createInitialStats","getDisplayStatKeys","followAnyArt","followChar","current","terminate","set","Array","isArray","sectionKey","section","JSON","stringify","fromEntries","allSlotKeys","totBuildNumber","artifactDatabase","_getArts","art","lock","Artifact","splitArtifactsBySlot","forEach","generateBuilds","artifactSetEffects","setEffectsObjs","splitArtifacts","deepClone","values","artArr","mainStatVal","mainStatValue","numStars","level","minFilters","maxFilters","data","onmessage","progress","timing","skipped","category","variable","toString","obj","calculateBuildwithArtifact","postMessage","dropdownitemsForStar","star","setsWithMaxRarity","setobj","some","setsNumArr","setEffects","artsAccountedOther","cur","ind","every","parseInt","nameWithIcon","characterName","name","characterDropDown","Divider","CharacterSelection","formula","Formula","sortByText","Stat","getStatVariant","getStatNameWithPercent","talentKey","field","getTalentFieldValue","text","getTalentOfKey","artsAccounted","artifactCondCount","count","crawlObject","conditionalValues","v","characterDispatch","val","InfoComponent","pageKey","modalTitle","BuildModal","build","ArtConditionalModal","Row","Col","Card","bg","Header","Body","xs","lg","CharacterCard","header","cardClassName","onEdit","HitModeCard","Boolean","StatFilterCard","statKeys","basicKeys","setStatFilters","sFs","Button","Badge","setNum","ButtonGroup","ItemText","setNKey","setNkey","setNumKey","SetEffectDisplay","newBuild","equippedBuild","editable","icon","faCheckSquare","faSquare","AssumeFullLevelToggle","setmainStatAssumptionLevel","numSel","slotMainStats","selected","StatIcon","OverlayTrigger","overlay","Menu","drop","minWidth","fields","getFormulaTargetsDisplayHeading","md","overflow","textOverflow","target","TargetSelectorDropdownItem","faSortAmountDownAlt","faSortAmountUp","BuildAlert","ArtifactDisplayItem","sheets","talentField","closeModal","Modal","onHide","contentClassName","Suspense","fallback","tabName","setCharacterKey","onClose","footer","closeArtCondModal","artSetKeyList","setKeysByRarities","reverse","flatMap","faUndo","faTimes","sheet","slotIcons","rarity","xl","Image","src","thumbnail","ns","stars","Footer","StatFilterItem","statKey","close","setFilter","isFloat","getStatUnit","inputProps","allowEmpty","float","minInputProps","placeholder","onChange","s","maxInputProps","sKey","CustomFormControl","faTrash","setHitmode","setReactionMode","setInfusionAura","remainingKeys","equippedArtifacts","currentlyEquipped","setToSlots","sort","slotarr1","slotarr","artifactSlotIcon","StatDisplayComponent","cardbg","totalBuildNumberString","toLocaleString","totalUnskipped","generationProgressString","generationSkippedString","totalUnskippedString","generationSkippedText","progPercent","Alert","toFixed","levels","0","4","8","12","16","20"],"mappings":"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","file":"static/js/13.d8bd7010.chunk.js","sourcesContent":["import ElementalData from \"../Data/ElementalData\"\r\nimport { StatKey, IArtifact, SubstatKey } from \"../Types/artifact\"\r\nimport { ArtifactSetEffects, ArtifactsBySlot, SetFilter } from \"../Types/Build\"\r\nimport { ArtifactSetKey, ElementKey, SetNum, SlotKey } from \"../Types/consts\"\r\nimport { BasicStats, BonusStats, ICalculatedStats } from \"../Types/stats\"\r\nimport { mergeStats } from \"../Util/StatUtil\"\r\nimport { deepClone } from \"../Util/Util\"\r\n\r\n/**\r\n * Remove artifacts that can never be used in optimized builds when trying to optimize for top `maxBuildsToShow` builds\r\n * @param {artifact[]} artifacts - List of artifacts of the same slot\r\n * @param {Object.<setKey, Object.<number, Object.<statKey, statValue>>>} artifactSetEffects - The list of the set effects\r\n * @param {Set.<statKey>} significantStats - A set of stats that pruning needs to take into consideration\r\n * @param {bool} ascending - Whether the sorting is ascending or descending\r\n * @param {Set.<setKey>} alwaysAccepted - The list of artifact sets that are always included\r\n */\r\nexport function pruneArtifacts(artifacts: IArtifact[], artifactSetEffects: ArtifactSetEffects, significantStats: Set<StatKey>, maxBuildsToShow: number = 1, ascending: boolean = false, alwaysAccepted: Set<ArtifactSetKey> = new Set()): IArtifact[] {\r\n  function shouldKeepFirst(first: Dict<StatKey, number>, second: Dict<StatKey, number>, preferFirst: boolean) {\r\n    let firstBetter = Object.entries(first).some(([k, v]) => !isFinite(v) || v > (second[k] ?? 0))\r\n    let secondBetter = Object.entries(second).some(([k, v]) => !isFinite(v) || v > (first[k] ?? 0))\r\n    if (ascending) [firstBetter, secondBetter] = [secondBetter, firstBetter]\r\n    // Keep if first is strictly better, uncomparable, or equal + prefer first.\r\n    // That is, return false if second is strictly better, or equal + NOT prefer first\r\n    return firstBetter || (!secondBetter && preferFirst)\r\n  }\r\n\r\n  // Prune unused set effects. Sets with no relevant effects are regrouped to \"other\"\r\n  const prunedSetEffects: PrunedArtifactSetEffects = { \"other\": {} }\r\n  Object.entries(artifactSetEffects).forEach(([set, effect]) => {\r\n    Object.entries(effect).forEach(([num, item]) => {\r\n      const effects = Object.entries(item).filter(([key]) => significantStats.has(key as StatKey))\r\n      if (effects.length > 0) {\r\n        prunedSetEffects[set] = prunedSetEffects[set] ?? {}\r\n        prunedSetEffects[set]![num] = Object.fromEntries(effects)\r\n      }\r\n      const modifiers = item.modifiers\r\n      if (modifiers) {\r\n        // Modifiers are treated as infinite stats\r\n        prunedSetEffects[set] = prunedSetEffects[set] ?? {}\r\n        prunedSetEffects[set]![num] = prunedSetEffects[set]![num] ?? {}\r\n\r\n        Object.keys(modifiers)\r\n          .filter(key => significantStats.has(key as StatKey))\r\n          .forEach(key =>\r\n            prunedSetEffects[set]![num]![key] = Infinity\r\n          )\r\n      }\r\n    })\r\n  })\r\n\r\n  // array of artifacts, artifact stats, and set (may be \"other\")\r\n  let tmp: { artifact: IArtifact, numberOfBetterSameSetArtifacts: number, stats: Dict<StatKey, number>, set: ArtifactSetKey | \"other\" }[] = artifacts.map(artifact => {\r\n    const stats: Dict<StatKey, number> = {}, set: ArtifactSetKey | \"other\" = (artifact.setKey in prunedSetEffects || alwaysAccepted.has(artifact.setKey)) ? artifact.setKey : \"other\"\r\n    if (significantStats.has(artifact.mainStatKey as any))\r\n      stats[artifact.mainStatKey] = artifact.mainStatVal!\r\n    for (const { key, value } of artifact.substats)\r\n      if (key && significantStats.has(key as SubstatKey))\r\n        stats[key] = (stats[key] ?? 0) + value\r\n    for (const key in stats)\r\n      if (key.endsWith(\"enemyRes_\"))\r\n        stats[key as StatKey] = -stats[key as StatKey]!\r\n    return { artifact, numberOfBetterSameSetArtifacts: 0, stats, set }\r\n  })\r\n\r\n  // Compare artifacts' base stats from the same set\r\n  tmp = tmp.filter((first) => {\r\n    const { artifact: candidate, stats: candidateStats, set: candidateSet } = first\r\n    return tmp.every(({ artifact: other, stats: otherStats, set: otherSet }) => {\r\n      if (candidateSet !== otherSet || shouldKeepFirst(candidateStats, otherStats, candidate.id! <= other.id!)) {\r\n        return true\r\n      } else {\r\n        first.numberOfBetterSameSetArtifacts += 1\r\n        return first.numberOfBetterSameSetArtifacts < maxBuildsToShow\r\n      }\r\n    })\r\n  })\r\n\r\n  // Cross-check with different sets\r\n  tmp = tmp.filter(({ artifact: candidate, stats: candidateStats, set: candidateSet }) => {\r\n    if (alwaysAccepted.has(candidate.setKey))\r\n      return true\r\n    // Possible \"additional stats\" if a build equips `candidate` on an empty slot.\r\n    let possibleStats = [...Object.values(prunedSetEffects[candidateSet]!), {}].map(c => {\r\n      const current: BonusStats = { ...candidateStats }\r\n      mergeStats(current, c)\r\n      return { stat: current, numberOfBetterArtifacts: 0 }\r\n    })\r\n    return tmp.every(({ artifact: other, stats: otherStats, set: otherSet, numberOfBetterSameSetArtifacts }) => {\r\n      if (candidateSet === otherSet) return true // Already checked same-set\r\n\r\n      // Remove possibilities that shouldn't be kept\r\n      possibleStats = possibleStats.filter(current => {\r\n        if (shouldKeepFirst(current.stat, otherStats, candidate.id! <= other.id!)) {\r\n          return true\r\n        } else {\r\n          current.numberOfBetterArtifacts += 1\r\n          return current.numberOfBetterArtifacts + numberOfBetterSameSetArtifacts < maxBuildsToShow\r\n        }\r\n      })\r\n      return possibleStats.length !== 0\r\n    })\r\n  })\r\n\r\n  return tmp.map(tmp => tmp.artifact)\r\n}\r\n\r\n/**\r\n * Generate all set of artifacts-by-slots based on the filters\r\n * @param {Object.<slotKey, artifact[]>} artifactsBySlot - list of artifacts, separated by slots\r\n * @param {Object.<setKey, number>} setFilters - minimum number of artifacts in each set\r\n *\r\n */\r\nexport function artifactSetPermutations(artifactsBySlot: ArtifactsBySlot, setFilters: SetFilter) {\r\n  const setKeys = new Set(setFilters.map(i => i.key)), filteredArtifactsBySlot = {}\r\n  const slotKeys = Object.keys(artifactsBySlot)\r\n\r\n  for (const slotKey of slotKeys) {\r\n    let artifactsBySet: Dict<ArtifactSetKey, IArtifact[]> = {}\r\n    for (const artifact of (artifactsBySlot[slotKey] ?? [])) {\r\n      if (setKeys.has(artifact.setKey)) {\r\n        if (artifactsBySet[artifact.setKey]) artifactsBySet[artifact.setKey]!.push(artifact)\r\n        else artifactsBySet[artifact.setKey] = [artifact]\r\n      } else {\r\n        if (artifactsBySet['null']) artifactsBySet['null'].push(artifact)\r\n        else artifactsBySet['null'] = [artifact]\r\n      }\r\n    }\r\n    filteredArtifactsBySlot[slotKey] = Object.freeze(artifactsBySet)\r\n  }\r\n\r\n  const setCount = {}, accu: ArtifactsBySlot = {}, result: ArtifactsBySlot[] = []\r\n\r\n  function slotPerm(index) {\r\n    if (index >= slotKeys.length) {\r\n      for (const { key, num } of setFilters)\r\n        if ((setCount[key] ?? 0) < num)\r\n          return\r\n      result.push({ ...accu })\r\n      return\r\n    }\r\n\r\n    const slotKey = slotKeys[index]\r\n    let artifactsBySet = filteredArtifactsBySlot[slotKey]\r\n    for (const setKey in artifactsBySet) {\r\n      setCount[setKey] = (setCount[setKey] ?? 0) + 1\r\n      accu[slotKey] = artifactsBySet[setKey]\r\n      slotPerm(index + 1)\r\n      setCount[setKey] -= 1\r\n    }\r\n  }\r\n\r\n  slotPerm(0)\r\n  return result\r\n}\r\n\r\n/**\r\n * Compute number of all artifact permutations based on the filters\r\n * @param {Object.<slotKey, artifact[]>} artifactsBySlot - list of artifacts, separated by slots\r\n * @param {Object.<setKey, number>} setFilters - minimum number of artifacts in each set\r\n */\r\nexport function calculateTotalBuildNumber(artifactsBySlot: ArtifactsBySlot, setFilters: SetFilter) {\r\n  return artifactSetPermutations(artifactsBySlot, setFilters).reduce((accu, artifactsBySlot) =>\r\n    accu + Object.entries(artifactsBySlot).reduce((accu, artifacts) => accu * artifacts[1]!.length, 1)\r\n    , 0)\r\n}\r\n\r\n/**\r\n * @callback artifactCallback\r\n * @param {Object.<artifactKey, artifact>} artifacts - the list of artifacts\r\n * @param {stats} stats - the total stats for the artifacts\r\n */\r\n\r\n/**\r\n * Generate all artifact permutations and accumulate the stats\r\n * @param {stats} initialStats - initial stats before any artifact is added\r\n * @param {Object.<slotKey, artifact[]>} artifactsBySlot - list of artifacts, separated by slots\r\n * @param {Object.<setKey, Object.<number, Object.<statKey, statValue>>>} artifactSetEffects - the list of the set effects\r\n * @param {artifactCallback} callback - the functions called with each permutation\r\n */\r\nexport function artifactPermutations(initialStats: ICalculatedStats, artifactsBySlot: ArtifactsBySlot, artifactSetEffects: ArtifactSetEffects, callback) {\r\n  const slotKeys = Object.keys(artifactsBySlot), setCount: Dict<ArtifactSetKey, SetNum> = {}, accu = {}\r\n  function slotPerm(index: number, stats: ICalculatedStats) {\r\n    if (index >= slotKeys.length) {\r\n      callback(accu, stats)\r\n      return\r\n    }\r\n\r\n    const slotKey = slotKeys[index]\r\n    for (const artifact of artifactsBySlot[slotKey] ?? []) {\r\n      const newStats = { ...stats }\r\n\r\n      // Hand-pick costly copying\r\n      if (newStats.modifiers) newStats.modifiers = deepClone(newStats.modifiers)\r\n\r\n      accumulate(slotKey, artifact, setCount, accu, newStats, artifactSetEffects)\r\n      slotPerm(index + 1, newStats)\r\n      setCount[artifact.setKey]! -= 1\r\n    }\r\n  }\r\n\r\n  slotPerm(0, initialStats)\r\n}\r\n\r\nfunction accumulate(slotKey: SlotKey, art: IArtifact, setCount: Dict<ArtifactSetKey, SetNum>, accu: Dict<SlotKey, IArtifact>, stats: ICalculatedStats, artifactSetEffects: ArtifactSetEffects) {\r\n  const setKey = art.setKey\r\n  accu[slotKey] = art\r\n  setCount[setKey] = (setCount[setKey] ?? 0) + 1 as SetNum\r\n\r\n  // Add artifact stats\r\n  if (art.mainStatKey in stats) stats[art.mainStatKey] += art.mainStatVal!\r\n  art.substats.forEach((substat) => {\r\n    if (substat?.key in stats) stats[substat.key] += substat.value\r\n  })\r\n\r\n  // Add set effects\r\n  const setEffect = artifactSetEffects[setKey]?.[setCount[setKey]!]\r\n  setEffect && mergeStats(stats, setEffect) // TODO: This may slow down the computation\r\n}\r\n\r\n/**\r\n  * Create statKey in the form of ${ele}_elemental_${type} for elemental DMG, ${ele}_${src}_${type} for talent DMG.\r\n  * @param {string} skillKey - The DMG src. Can be \"norm\",\"skill\". Use an elemental to specify a elemental hit \"physical\" -> physical_elemental_{type}. Use \"elemental\" here to specify a elemental hit of character's element/reactionMode\r\n  * @param {*} stats - The calculated stats\r\n  * @param {*} overwriteElement - Override the hit to be the character's elemental, that is not part of infusion.\r\n  */\r\nexport function getTalentStatKey(skillKey: string, stats: BasicStats, overwriteElement?: ElementKey | \"physical\") {\r\n  const { hitMode = \"\", infusionAura = \"\", infusionSelf = \"\", reactionMode = null, characterEle = \"anemo\", weaponType = \"sword\" } = stats\r\n  if ((Object.keys(ElementalData) as any).includes(skillKey)) return `${skillKey}_elemental_${hitMode}`//elemental DMG\r\n  if (!overwriteElement && weaponType === \"catalyst\") overwriteElement = characterEle\r\n\r\n  if (skillKey === \"elemental\" || skillKey === \"burst\" || skillKey === \"skill\" || overwriteElement) {\r\n    if (reactionMode && reactionMode.startsWith(overwriteElement || characterEle)) return `${reactionMode}_${skillKey}_${hitMode}`\r\n    return `${overwriteElement || characterEle}_${skillKey}_${hitMode}`\r\n  }\r\n  //auto attacks\r\n  let eleKey = \"physical\"\r\n  if (infusionSelf) eleKey = infusionSelf\r\n  else if (infusionAura) eleKey = infusionAura\r\n  if (reactionMode && reactionMode.startsWith(eleKey)) return `${reactionMode}_${skillKey}_${hitMode}`\r\n\r\n  return `${eleKey}_${skillKey}_${hitMode}`\r\n}\r\n\r\nexport function getTalentStatKeyVariant(skillKey: string, stats: BasicStats, overwriteElement: ElementKey | \"physical\" | undefined | \"\" = \"\") {\r\n  if ((Object.keys(ElementalData) as any).includes(skillKey)) return skillKey//elemental DMG\r\n  const { infusionAura = \"\", infusionSelf = \"\", reactionMode = null, characterEle = \"anemo\", weaponType = \"sword\" } = stats\r\n  if (!overwriteElement && weaponType === \"catalyst\") overwriteElement = characterEle\r\n\r\n  if (skillKey === \"elemental\" || skillKey === \"burst\" || skillKey === \"skill\" || overwriteElement) {\r\n    if (reactionMode && reactionMode.startsWith(overwriteElement || characterEle)) {\r\n      if ([\"pyro_vaporize\", \"hydro_vaporize\"].includes(reactionMode)) return \"vaporize\"\r\n      else if ([\"pyro_melt\", \"cryo_melt\"].includes(reactionMode)) return \"melt\"\r\n    }\r\n    return overwriteElement || characterEle\r\n  }\r\n  //auto attacks\r\n  let eleKey = \"physical\"\r\n  if (infusionSelf) eleKey = infusionSelf\r\n  else if (infusionAura) eleKey = infusionAura\r\n  if (reactionMode && reactionMode.startsWith(eleKey)) {\r\n    if ([\"pyro_vaporize\", \"hydro_vaporize\"].includes(reactionMode)) return \"vaporize\"\r\n    else if ([\"pyro_melt\", \"cryo_melt\"].includes(reactionMode)) return \"melt\"\r\n  }\r\n  return eleKey\r\n}\r\n\r\nexport type PrunedArtifactSetEffects = Dict<ArtifactSetKey | \"other\", Dict<SetNum, Dict<StatKey, number>>>\r\n","import React from 'react';\nvar context = /*#__PURE__*/React.createContext(null);\ncontext.displayName = 'AccordionContext';\nexport default context;","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"as\", \"children\", \"eventKey\", \"onClick\"];\nimport React, { useContext } from 'react';\nimport SelectableContext from './SelectableContext';\nimport AccordionContext from './AccordionContext';\nexport function useAccordionToggle(eventKey, onClick) {\n  var contextEventKey = useContext(AccordionContext);\n  var onSelect = useContext(SelectableContext);\n  return function (e) {\n    /*\n      Compare the event key in context with the given event key.\n      If they are the same, then collapse the component.\n    */\n    var eventKeyPassed = eventKey === contextEventKey ? null : eventKey;\n    if (onSelect) onSelect(eventKeyPassed, e);\n    if (onClick) onClick(e);\n  };\n}\nvar AccordionToggle = /*#__PURE__*/React.forwardRef(function (_ref, ref) {\n  var _ref$as = _ref.as,\n      Component = _ref$as === void 0 ? 'button' : _ref$as,\n      children = _ref.children,\n      eventKey = _ref.eventKey,\n      onClick = _ref.onClick,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  var accordionOnClick = useAccordionToggle(eventKey, onClick);\n\n  if (Component === 'button') {\n    props.type = 'button';\n  }\n\n  return /*#__PURE__*/React.createElement(Component, _extends({\n    ref: ref,\n    onClick: accordionOnClick\n  }, props), children);\n});\nexport default AccordionToggle;","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"bsPrefix\", \"placement\", \"className\", \"style\", \"children\", \"arrowProps\", \"popper\", \"show\"];\nimport classNames from 'classnames';\nimport React from 'react';\nimport isRequiredForA11y from 'prop-types-extra/lib/isRequiredForA11y';\nimport { useBootstrapPrefix } from './ThemeProvider';\nvar defaultProps = {\n  placement: 'right'\n};\nvar Tooltip = /*#__PURE__*/React.forwardRef(function (_ref, ref) {\n  var bsPrefix = _ref.bsPrefix,\n      placement = _ref.placement,\n      className = _ref.className,\n      style = _ref.style,\n      children = _ref.children,\n      arrowProps = _ref.arrowProps,\n      _ = _ref.popper,\n      _2 = _ref.show,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  bsPrefix = useBootstrapPrefix(bsPrefix, 'tooltip');\n\n  var _ref2 = (placement == null ? void 0 : placement.split('-')) || [],\n      primaryPlacement = _ref2[0];\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: ref,\n    style: style,\n    role: \"tooltip\",\n    \"x-placement\": primaryPlacement,\n    className: classNames(className, bsPrefix, \"bs-tooltip-\" + primaryPlacement)\n  }, props), /*#__PURE__*/React.createElement(\"div\", _extends({\n    className: \"arrow\"\n  }, arrowProps)), /*#__PURE__*/React.createElement(\"div\", {\n    className: bsPrefix + \"-inner\"\n  }, children));\n});\nTooltip.defaultProps = defaultProps;\nTooltip.displayName = 'Tooltip';\nexport default Tooltip;","import _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nvar _excluded = [\"bsPrefix\", \"size\", \"hasValidation\", \"className\", \"as\"];\nimport classNames from 'classnames';\nimport React from 'react';\nimport createWithBsPrefix from './createWithBsPrefix';\nimport { useBootstrapPrefix } from './ThemeProvider';\nvar InputGroupAppend = createWithBsPrefix('input-group-append');\nvar InputGroupPrepend = createWithBsPrefix('input-group-prepend');\nvar InputGroupText = createWithBsPrefix('input-group-text', {\n  Component: 'span'\n});\n\nvar InputGroupCheckbox = function InputGroupCheckbox(props) {\n  return /*#__PURE__*/React.createElement(InputGroupText, null, /*#__PURE__*/React.createElement(\"input\", _extends({\n    type: \"checkbox\"\n  }, props)));\n};\n\nvar InputGroupRadio = function InputGroupRadio(props) {\n  return /*#__PURE__*/React.createElement(InputGroupText, null, /*#__PURE__*/React.createElement(\"input\", _extends({\n    type: \"radio\"\n  }, props)));\n};\n\n/**\n *\n * @property {InputGroupAppend} Append\n * @property {InputGroupPrepend} Prepend\n * @property {InputGroupText} Text\n * @property {InputGroupRadio} Radio\n * @property {InputGroupCheckbox} Checkbox\n */\nvar InputGroup = /*#__PURE__*/React.forwardRef(function (_ref, ref) {\n  var bsPrefix = _ref.bsPrefix,\n      size = _ref.size,\n      hasValidation = _ref.hasValidation,\n      className = _ref.className,\n      _ref$as = _ref.as,\n      Component = _ref$as === void 0 ? 'div' : _ref$as,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  bsPrefix = useBootstrapPrefix(bsPrefix, 'input-group');\n  return /*#__PURE__*/React.createElement(Component, _extends({\n    ref: ref\n  }, props, {\n    className: classNames(className, bsPrefix, size && bsPrefix + \"-\" + size, hasValidation && 'has-validation')\n  }));\n});\nInputGroup.displayName = 'InputGroup';\n\nvar InputGroupWithExtras = _extends({}, InputGroup, {\n  Text: InputGroupText,\n  Radio: InputGroupRadio,\n  Checkbox: InputGroupCheckbox,\n  Append: InputGroupAppend,\n  Prepend: InputGroupPrepend\n});\n\nexport default InputGroupWithExtras;","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"title\", \"children\", \"bsPrefix\", \"rootCloseEvent\", \"variant\", \"size\", \"menuAlign\", \"menuRole\", \"renderMenuOnMount\", \"disabled\", \"href\", \"id\"];\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Dropdown from './Dropdown';\nimport DropdownToggle from './DropdownToggle';\nimport DropdownMenu, { alignPropType } from './DropdownMenu';\nvar propTypes = {\n  /**\n   * An html id attribute for the Toggle button, necessary for assistive technologies, such as screen readers.\n   * @type {string|number}\n   * @required\n   */\n  id: PropTypes.any,\n\n  /** An `href` passed to the Toggle component */\n  href: PropTypes.string,\n\n  /** An `onClick` handler passed to the Toggle component */\n  onClick: PropTypes.func,\n\n  /** The content of the non-toggle Button.  */\n  title: PropTypes.node.isRequired,\n\n  /** Disables both Buttons  */\n  disabled: PropTypes.bool,\n\n  /**\n   * Aligns the dropdown menu responsively.\n   *\n   * _see [DropdownMenu](#dropdown-menu-props) for more details_\n   *\n   * @type {\"left\"|\"right\"|{ sm: \"left\"|\"right\" }|{ md: \"left\"|\"right\" }|{ lg: \"left\"|\"right\" }|{ xl: \"left\"|\"right\"} }\n   */\n  menuAlign: alignPropType,\n\n  /** An ARIA accessible role applied to the Menu component. When set to 'menu', The dropdown */\n  menuRole: PropTypes.string,\n\n  /** Whether to render the dropdown menu in the DOM before the first time it is shown */\n  renderMenuOnMount: PropTypes.bool,\n\n  /**\n   *  Which event when fired outside the component will cause it to be closed.\n   *\n   * _see [DropdownMenu](#dropdown-menu-props) for more details_\n   */\n  rootCloseEvent: PropTypes.string,\n\n  /** @ignore */\n  bsPrefix: PropTypes.string,\n\n  /** @ignore */\n  variant: PropTypes.string,\n\n  /** @ignore */\n  size: PropTypes.string\n};\n/**\n * A convenience component for simple or general use dropdowns. Renders a `Button` toggle and all `children`\n * are passed directly to the default `Dropdown.Menu`. This component accepts all of\n * [`Dropdown`'s props](#dropdown-props).\n *\n * _All unknown props are passed through to the `Dropdown` component._ Only\n * the Button `variant`, `size` and `bsPrefix` props are passed to the toggle,\n * along with menu-related props are passed to the `Dropdown.Menu`\n */\n\nvar DropdownButton = /*#__PURE__*/React.forwardRef(function (_ref, ref) {\n  var title = _ref.title,\n      children = _ref.children,\n      bsPrefix = _ref.bsPrefix,\n      rootCloseEvent = _ref.rootCloseEvent,\n      variant = _ref.variant,\n      size = _ref.size,\n      menuAlign = _ref.menuAlign,\n      menuRole = _ref.menuRole,\n      renderMenuOnMount = _ref.renderMenuOnMount,\n      disabled = _ref.disabled,\n      href = _ref.href,\n      id = _ref.id,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(Dropdown, _extends({\n    ref: ref\n  }, props), /*#__PURE__*/React.createElement(DropdownToggle, {\n    id: id,\n    href: href,\n    size: size,\n    variant: variant,\n    disabled: disabled,\n    childBsPrefix: bsPrefix\n  }, title), /*#__PURE__*/React.createElement(DropdownMenu, {\n    align: menuAlign,\n    role: menuRole,\n    renderOnMount: renderMenuOnMount,\n    rootCloseEvent: rootCloseEvent\n  }, children));\n});\nDropdownButton.displayName = 'DropdownButton';\nDropdownButton.propTypes = propTypes;\nexport default DropdownButton;","import { strPadLeft } from \"./Util\"\r\n\r\nexport function msToUnits(ms: number) {\r\n  let milliseconds = ms % 1000\r\n  let seconds = Math.floor((ms / 1000) % 60)\r\n  let minutes = Math.floor((ms / (1000 * 60)) % 60)\r\n  let hours = Math.floor((ms / (1000 * 60 * 60)))\r\n  return { hours, minutes, seconds, milliseconds }\r\n}\r\nexport function timeString(ms: number) {\r\n  //shows only in terms of hours/minutes. there are better calculations for days using Date functions.\r\n  let { hours, minutes, seconds } = msToUnits(ms)\r\n  let timeText = \"Minutes\"\r\n  if (hours) timeText = \"Hours\"\r\n  return `${hours ? `${hours}:` : \"\"}${strPadLeft(minutes, '0', 2)}:${strPadLeft(seconds, '0', 2)} ${timeText}`;\r\n}\r\nexport function timeStringMs(ms: number) {\r\n  //shows only in terms of hours/minutes. there are better calculations for days using Date functions.\r\n  let { hours, minutes, seconds, milliseconds } = msToUnits(ms)\r\n  let timeText = \"Minutes\"\r\n  if (hours) timeText = \"Hours\"\r\n  return `${hours ? `${hours}:` : \"\"}${strPadLeft(minutes, '0', 2)}:${strPadLeft(seconds, '0', 2)}.${strPadLeft(milliseconds, '0', 3)} ${timeText}`;\r\n}\r\n","import React, { useMemo } from 'react';\nimport { useUncontrolled } from 'uncontrollable';\nimport TabContext from './TabContext';\nimport SelectableContext from './SelectableContext';\n\nvar TabContainer = function TabContainer(props) {\n  var _useUncontrolled = useUncontrolled(props, {\n    activeKey: 'onSelect'\n  }),\n      id = _useUncontrolled.id,\n      generateCustomChildId = _useUncontrolled.generateChildId,\n      onSelect = _useUncontrolled.onSelect,\n      activeKey = _useUncontrolled.activeKey,\n      transition = _useUncontrolled.transition,\n      mountOnEnter = _useUncontrolled.mountOnEnter,\n      unmountOnExit = _useUncontrolled.unmountOnExit,\n      children = _useUncontrolled.children;\n\n  var generateChildId = useMemo(function () {\n    return generateCustomChildId || function (key, type) {\n      return id ? id + \"-\" + type + \"-\" + key : null;\n    };\n  }, [id, generateCustomChildId]);\n  var tabContext = useMemo(function () {\n    return {\n      onSelect: onSelect,\n      activeKey: activeKey,\n      transition: transition,\n      mountOnEnter: mountOnEnter || false,\n      unmountOnExit: unmountOnExit || false,\n      getControlledId: function getControlledId(key) {\n        return generateChildId(key, 'tabpane');\n      },\n      getControllerId: function getControllerId(key) {\n        return generateChildId(key, 'tab');\n      }\n    };\n  }, [onSelect, activeKey, transition, mountOnEnter, unmountOnExit, generateChildId]);\n  return /*#__PURE__*/React.createElement(TabContext.Provider, {\n    value: tabContext\n  }, /*#__PURE__*/React.createElement(SelectableContext.Provider, {\n    value: onSelect || null\n  }, children));\n};\n\nexport default TabContainer;","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"bsPrefix\", \"as\", \"className\"];\nimport classNames from 'classnames';\nimport React from 'react';\nimport { useBootstrapPrefix } from './ThemeProvider';\nvar TabContent = /*#__PURE__*/React.forwardRef(function (_ref, ref) {\n  var bsPrefix = _ref.bsPrefix,\n      _ref$as = _ref.as,\n      Component = _ref$as === void 0 ? 'div' : _ref$as,\n      className = _ref.className,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  var decoratedBsPrefix = useBootstrapPrefix(bsPrefix, 'tab-content');\n  return /*#__PURE__*/React.createElement(Component, _extends({\n    ref: ref\n  }, props, {\n    className: classNames(className, decoratedBsPrefix)\n  }));\n});\nexport default TabContent;","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"activeKey\", \"getControlledId\", \"getControllerId\"],\n    _excluded2 = [\"bsPrefix\", \"className\", \"active\", \"onEnter\", \"onEntering\", \"onEntered\", \"onExit\", \"onExiting\", \"onExited\", \"mountOnEnter\", \"unmountOnExit\", \"transition\", \"as\", \"eventKey\"];\nimport classNames from 'classnames';\nimport React, { useContext } from 'react';\nimport { useBootstrapPrefix } from './ThemeProvider';\nimport TabContext from './TabContext';\nimport SelectableContext, { makeEventKey } from './SelectableContext';\nimport Fade from './Fade';\n\nfunction useTabContext(props) {\n  var context = useContext(TabContext);\n  if (!context) return props;\n\n  var activeKey = context.activeKey,\n      getControlledId = context.getControlledId,\n      getControllerId = context.getControllerId,\n      rest = _objectWithoutPropertiesLoose(context, _excluded);\n\n  var shouldTransition = props.transition !== false && rest.transition !== false;\n  var key = makeEventKey(props.eventKey);\n  return _extends({}, props, {\n    active: props.active == null && key != null ? makeEventKey(activeKey) === key : props.active,\n    id: getControlledId(props.eventKey),\n    'aria-labelledby': getControllerId(props.eventKey),\n    transition: shouldTransition && (props.transition || rest.transition || Fade),\n    mountOnEnter: props.mountOnEnter != null ? props.mountOnEnter : rest.mountOnEnter,\n    unmountOnExit: props.unmountOnExit != null ? props.unmountOnExit : rest.unmountOnExit\n  });\n}\n\nvar TabPane = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  var _useTabContext = useTabContext(props),\n      bsPrefix = _useTabContext.bsPrefix,\n      className = _useTabContext.className,\n      active = _useTabContext.active,\n      onEnter = _useTabContext.onEnter,\n      onEntering = _useTabContext.onEntering,\n      onEntered = _useTabContext.onEntered,\n      onExit = _useTabContext.onExit,\n      onExiting = _useTabContext.onExiting,\n      onExited = _useTabContext.onExited,\n      mountOnEnter = _useTabContext.mountOnEnter,\n      unmountOnExit = _useTabContext.unmountOnExit,\n      Transition = _useTabContext.transition,\n      _useTabContext$as = _useTabContext.as,\n      Component = _useTabContext$as === void 0 ? 'div' : _useTabContext$as,\n      _ = _useTabContext.eventKey,\n      rest = _objectWithoutPropertiesLoose(_useTabContext, _excluded2);\n\n  var prefix = useBootstrapPrefix(bsPrefix, 'tab-pane');\n  if (!active && !Transition && unmountOnExit) return null;\n  var pane = /*#__PURE__*/React.createElement(Component, _extends({}, rest, {\n    ref: ref,\n    role: \"tabpanel\",\n    \"aria-hidden\": !active,\n    className: classNames(className, prefix, {\n      active: active\n    })\n  }));\n  if (Transition) pane = /*#__PURE__*/React.createElement(Transition, {\n    in: active,\n    onEnter: onEnter,\n    onEntering: onEntering,\n    onEntered: onEntered,\n    onExit: onExit,\n    onExiting: onExiting,\n    onExited: onExited,\n    mountOnEnter: mountOnEnter,\n    unmountOnExit: unmountOnExit\n  }, pane); // We provide an empty the TabContext so `<Nav>`s in `<TabPane>`s don't\n  // conflict with the top level one.\n\n  return /*#__PURE__*/React.createElement(TabContext.Provider, {\n    value: null\n  }, /*#__PURE__*/React.createElement(SelectableContext.Provider, {\n    value: null\n  }, pane));\n});\nTabPane.displayName = 'TabPane';\nexport default TabPane;","import _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\nimport React from 'react';\nimport TabContainer from './TabContainer';\nimport TabContent from './TabContent';\nimport TabPane from './TabPane';\n\n/* eslint-disable react/require-render-return, react/no-unused-prop-types */\nvar Tab = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(Tab, _React$Component);\n\n  function Tab() {\n    return _React$Component.apply(this, arguments) || this;\n  }\n\n  var _proto = Tab.prototype;\n\n  _proto.render = function render() {\n    throw new Error('ReactBootstrap: The `Tab` component is not meant to be rendered! ' + \"It's an abstract component that is only valid as a direct Child of the `Tabs` Component. \" + 'For custom tabs components use TabPane and TabsContainer directly');\n    return null;\n  };\n\n  return Tab;\n}(React.Component);\n\nTab.Container = TabContainer;\nTab.Content = TabContent;\nTab.Pane = TabPane;\nexport default Tab;","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"bsPrefix\", \"active\", \"disabled\", \"className\", \"variant\", \"action\", \"as\", \"onClick\"];\nimport classNames from 'classnames';\nimport React, { useCallback } from 'react';\nimport AbstractNavItem from './AbstractNavItem';\nimport { useBootstrapPrefix } from './ThemeProvider';\nvar defaultProps = {\n  variant: undefined,\n  active: false,\n  disabled: false\n};\nvar ListGroupItem = /*#__PURE__*/React.forwardRef(function (_ref, ref) {\n  var bsPrefix = _ref.bsPrefix,\n      active = _ref.active,\n      disabled = _ref.disabled,\n      className = _ref.className,\n      variant = _ref.variant,\n      action = _ref.action,\n      as = _ref.as,\n      onClick = _ref.onClick,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  bsPrefix = useBootstrapPrefix(bsPrefix, 'list-group-item');\n  var handleClick = useCallback(function (event) {\n    if (disabled) {\n      event.preventDefault();\n      event.stopPropagation();\n      return;\n    }\n\n    if (onClick) onClick(event);\n  }, [disabled, onClick]);\n\n  if (disabled && props.tabIndex === undefined) {\n    props.tabIndex = -1;\n    props['aria-disabled'] = true;\n  }\n\n  return /*#__PURE__*/React.createElement(AbstractNavItem, _extends({\n    ref: ref\n  }, props, {\n    // eslint-disable-next-line no-nested-ternary\n    as: as || (action ? props.href ? 'a' : 'button' : 'div'),\n    onClick: handleClick,\n    className: classNames(className, bsPrefix, active && 'active', disabled && 'disabled', variant && bsPrefix + \"-\" + variant, action && bsPrefix + \"-action\")\n  }));\n});\nListGroupItem.defaultProps = defaultProps;\nListGroupItem.displayName = 'ListGroupItem';\nexport default ListGroupItem;","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"className\", \"bsPrefix\", \"variant\", \"horizontal\", \"as\"];\nimport classNames from 'classnames';\nimport React from 'react';\nimport warning from 'warning';\nimport { useUncontrolled } from 'uncontrollable';\nimport { useBootstrapPrefix } from './ThemeProvider';\nimport AbstractNav from './AbstractNav';\nimport ListGroupItem from './ListGroupItem';\nvar defaultProps = {\n  variant: undefined,\n  horizontal: undefined\n};\nvar ListGroup = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  var _useUncontrolled = useUncontrolled(props, {\n    activeKey: 'onSelect'\n  }),\n      className = _useUncontrolled.className,\n      initialBsPrefix = _useUncontrolled.bsPrefix,\n      variant = _useUncontrolled.variant,\n      horizontal = _useUncontrolled.horizontal,\n      _useUncontrolled$as = _useUncontrolled.as,\n      as = _useUncontrolled$as === void 0 ? 'div' : _useUncontrolled$as,\n      controlledProps = _objectWithoutPropertiesLoose(_useUncontrolled, _excluded);\n\n  var bsPrefix = useBootstrapPrefix(initialBsPrefix, 'list-group');\n  var horizontalVariant;\n\n  if (horizontal) {\n    horizontalVariant = horizontal === true ? 'horizontal' : \"horizontal-\" + horizontal;\n  } else {\n    horizontalVariant = null;\n  }\n\n  process.env.NODE_ENV !== \"production\" ? warning(!(horizontal && variant === 'flush'), '`variant=\"flush\"` and `horizontal` should not be used together.') : void 0;\n  return /*#__PURE__*/React.createElement(AbstractNav, _extends({\n    ref: ref\n  }, controlledProps, {\n    as: as,\n    className: classNames(className, bsPrefix, variant && bsPrefix + \"-\" + variant, horizontalVariant && bsPrefix + \"-\" + horizontalVariant)\n  }));\n});\nListGroup.defaultProps = defaultProps;\nListGroup.displayName = 'ListGroup';\nListGroup.Item = ListGroupItem;\nexport default ListGroup;","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"children\", \"eventKey\"];\nimport React, { useContext } from 'react';\nimport Collapse from './Collapse';\nimport AccordionContext from './AccordionContext';\nimport SelectableContext from './SelectableContext';\nvar AccordionCollapse = /*#__PURE__*/React.forwardRef(function (_ref, ref) {\n  var children = _ref.children,\n      eventKey = _ref.eventKey,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  var contextEventKey = useContext(AccordionContext); // Empty SelectableContext is to prevent elements in the collapse\n  // from collapsing the accordion when clicked.\n\n  return /*#__PURE__*/React.createElement(SelectableContext.Provider, {\n    value: null\n  }, /*#__PURE__*/React.createElement(Collapse, _extends({\n    ref: ref,\n    in: contextEventKey === eventKey\n  }, props), /*#__PURE__*/React.createElement(\"div\", null, React.Children.only(children))));\n});\nAccordionCollapse.displayName = 'AccordionCollapse';\nexport default AccordionCollapse;","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"as\", \"activeKey\", \"bsPrefix\", \"children\", \"className\", \"onSelect\"];\nimport classNames from 'classnames';\nimport React from 'react';\nimport { useUncontrolled } from 'uncontrollable';\nimport { useBootstrapPrefix } from './ThemeProvider';\nimport AccordionToggle from './AccordionToggle';\nimport SelectableContext from './SelectableContext';\nimport AccordionCollapse from './AccordionCollapse';\nimport AccordionContext from './AccordionContext';\nvar Accordion = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  var _useUncontrolled = useUncontrolled(props, {\n    activeKey: 'onSelect'\n  }),\n      _useUncontrolled$as = _useUncontrolled.as,\n      Component = _useUncontrolled$as === void 0 ? 'div' : _useUncontrolled$as,\n      activeKey = _useUncontrolled.activeKey,\n      bsPrefix = _useUncontrolled.bsPrefix,\n      children = _useUncontrolled.children,\n      className = _useUncontrolled.className,\n      onSelect = _useUncontrolled.onSelect,\n      controlledProps = _objectWithoutPropertiesLoose(_useUncontrolled, _excluded);\n\n  var finalClassName = classNames(className, useBootstrapPrefix(bsPrefix, 'accordion'));\n  return /*#__PURE__*/React.createElement(AccordionContext.Provider, {\n    value: activeKey || null\n  }, /*#__PURE__*/React.createElement(SelectableContext.Provider, {\n    value: onSelect || null\n  }, /*#__PURE__*/React.createElement(Component, _extends({\n    ref: ref\n  }, controlledProps, {\n    className: finalClassName\n  }), children)));\n});\nAccordion.displayName = 'Accordion';\nAccordion.Toggle = AccordionToggle;\nAccordion.Collapse = AccordionCollapse;\nexport default Accordion;","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"min\", \"now\", \"max\", \"label\", \"srOnly\", \"striped\", \"animated\", \"className\", \"style\", \"variant\", \"bsPrefix\"],\n    _excluded2 = [\"isChild\"],\n    _excluded3 = [\"min\", \"now\", \"max\", \"label\", \"srOnly\", \"striped\", \"animated\", \"bsPrefix\", \"variant\", \"className\", \"children\"];\nimport classNames from 'classnames';\nimport React, { cloneElement } from 'react';\nimport { useBootstrapPrefix } from './ThemeProvider';\nimport { map } from './ElementChildren';\nvar ROUND_PRECISION = 1000;\n/**\n * Validate that children, if any, are instances of `<ProgressBar>`.\n */\n\nfunction onlyProgressBar(props, propName, componentName) {\n  var children = props[propName];\n\n  if (!children) {\n    return null;\n  }\n\n  var error = null;\n  React.Children.forEach(children, function (child) {\n    if (error) {\n      return;\n    }\n    /**\n     * Compare types in a way that works with libraries that patch and proxy\n     * components like react-hot-loader.\n     *\n     * see https://github.com/gaearon/react-hot-loader#checking-element-types\n     */\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n\n\n    var element = /*#__PURE__*/React.createElement(ProgressBar, null);\n    if (child.type === element.type) return;\n    var childType = child.type;\n    var childIdentifier = /*#__PURE__*/React.isValidElement(child) ? childType.displayName || childType.name || childType : child;\n    error = new Error(\"Children of \" + componentName + \" can contain only ProgressBar \" + (\"components. Found \" + childIdentifier + \".\"));\n  });\n  return error;\n}\n\nvar defaultProps = {\n  min: 0,\n  max: 100,\n  animated: false,\n  isChild: false,\n  srOnly: false,\n  striped: false\n};\n\nfunction getPercentage(now, min, max) {\n  var percentage = (now - min) / (max - min) * 100;\n  return Math.round(percentage * ROUND_PRECISION) / ROUND_PRECISION;\n}\n\nfunction renderProgressBar(_ref, ref) {\n  var _classNames;\n\n  var min = _ref.min,\n      now = _ref.now,\n      max = _ref.max,\n      label = _ref.label,\n      srOnly = _ref.srOnly,\n      striped = _ref.striped,\n      animated = _ref.animated,\n      className = _ref.className,\n      style = _ref.style,\n      variant = _ref.variant,\n      bsPrefix = _ref.bsPrefix,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: ref\n  }, props, {\n    role: \"progressbar\",\n    className: classNames(className, bsPrefix + \"-bar\", (_classNames = {}, _classNames[\"bg-\" + variant] = variant, _classNames[bsPrefix + \"-bar-animated\"] = animated, _classNames[bsPrefix + \"-bar-striped\"] = animated || striped, _classNames)),\n    style: _extends({\n      width: getPercentage(now, min, max) + \"%\"\n    }, style),\n    \"aria-valuenow\": now,\n    \"aria-valuemin\": min,\n    \"aria-valuemax\": max\n  }), srOnly ? /*#__PURE__*/React.createElement(\"span\", {\n    className: \"sr-only\"\n  }, label) : label);\n}\n\nvar ProgressBar = /*#__PURE__*/React.forwardRef(function (_ref2, ref) {\n  var isChild = _ref2.isChild,\n      props = _objectWithoutPropertiesLoose(_ref2, _excluded2);\n\n  props.bsPrefix = useBootstrapPrefix(props.bsPrefix, 'progress');\n\n  if (isChild) {\n    return renderProgressBar(props, ref);\n  }\n\n  var min = props.min,\n      now = props.now,\n      max = props.max,\n      label = props.label,\n      srOnly = props.srOnly,\n      striped = props.striped,\n      animated = props.animated,\n      bsPrefix = props.bsPrefix,\n      variant = props.variant,\n      className = props.className,\n      children = props.children,\n      wrapperProps = _objectWithoutPropertiesLoose(props, _excluded3);\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: ref\n  }, wrapperProps, {\n    className: classNames(className, bsPrefix)\n  }), children ? map(children, function (child) {\n    return /*#__PURE__*/cloneElement(child, {\n      isChild: true\n    });\n  }) : renderProgressBar({\n    min: min,\n    now: now,\n    max: max,\n    label: label,\n    srOnly: srOnly,\n    striped: striped,\n    animated: animated,\n    bsPrefix: bsPrefix,\n    variant: variant\n  }, ref));\n});\nProgressBar.displayName = 'ProgressBar';\nProgressBar.defaultProps = defaultProps;\nexport default ProgressBar;","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/BuildWorker.b4c6fc13.worker.js\");\n}\n","import { faCheckSquare, faSortAmountDownAlt, faSortAmountUp, faSquare, faTimes, faTrash, faUndo } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React, { lazy, useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { Alert, Badge, Button, ButtonGroup, Card, Col, Container, Dropdown, DropdownButton, Image, InputGroup, ListGroup, Modal, OverlayTrigger, ProgressBar, Row, Tooltip } from 'react-bootstrap';\r\nimport ReactGA from 'react-ga';\r\n// eslint-disable-next-line\r\nimport Worker from \"worker-loader!./BuildWorker\";\r\nimport Artifact from '../Artifact/Artifact';\r\nimport { ArtifactSheet } from '../Artifact/ArtifactSheet';\r\nimport SetEffectDisplay from '../Artifact/Component/SetEffectDisplay';\r\nimport SlotNameWithIcon, { artifactSlotIcon } from '../Artifact/Component/SlotNameWIthIcon';\r\nimport Character from '../Character/Character';\r\nimport CharacterCard from '../Character/CharacterCard';\r\nimport { HitModeToggle, InfusionAuraDropdown, ReactionToggle } from '../Character/CharacterDisplay/DamageOptionsAndCalculation';\r\nimport StatDisplayComponent from '../Character/CharacterDisplay/StatDisplayComponent';\r\nimport CharacterSheet from '../Character/CharacterSheet';\r\nimport { getFormulaTargetsDisplayHeading } from '../Character/CharacterUtil';\r\nimport { CharacterSelectionDropdownList } from '../Components/CharacterSelection';\r\nimport CustomFormControl from '../Components/CustomFormControl';\r\nimport InfoComponent from '../Components/InfoComponent';\r\nimport { Stars } from '../Components/StarDisplay';\r\nimport StatIcon from '../Components/StatIcon';\r\nimport { database } from '../Database/Database';\r\nimport { dbStorage } from '../Database/DBStorage';\r\nimport Formula from '../Formula';\r\nimport Stat from '../Stat';\r\nimport { StatKey } from '../Types/artifact';\r\nimport { ArtifactsBySlot, Build, BuildSetting } from '../Types/Build';\r\nimport { ICharacter } from '../Types/character';\r\nimport { allSlotKeys, ArtifactSetKey, CharacterKey, SetNum, SlotKey } from '../Types/consts';\r\nimport { IFieldDisplay } from '../Types/IFieldDisplay';\r\nimport { ICalculatedStats } from '../Types/stats';\r\nimport { useForceUpdate, usePromise } from '../Util/ReactUtil';\r\nimport { timeStringMs } from '../Util/TimeUtil';\r\nimport { crawlObject, deepClone } from '../Util/Util';\r\nimport WeaponSheet from '../Weapon/WeaponSheet';\r\nimport { calculateTotalBuildNumber } from './Build';\r\nimport { initialBuildSettings } from './BuildSetting';\r\nconst InfoDisplay = React.lazy(() => import('./InfoDisplay'));\r\n\r\n//lazy load the character display\r\nconst CharacterDisplayCard = lazy(() => import('../Character/CharacterDisplayCard'))\r\n\r\nconst warningBuildNumber = 10000000\r\nconst maxBuildsToShowList = [1, 2, 3, 4, 5, 8, 10]\r\nconst maxBuildsToShowDefault = 5\r\nconst autoBuildGenLimit = 100\r\nconst artifactsSlotsToSelectMainStats = [\"sands\", \"goblet\", \"circlet\"] as const\r\n\r\nfunction buildSettingsReducer(state: BuildSetting, action): BuildSetting {\r\n  switch (action.type) {\r\n    case 'mainStatKey': {\r\n      const { slotKey, mainStatKey } = action\r\n      const mainStatKeys = { ...state.mainStatKeys }//create a new object to update react dependencies\r\n\r\n      if (state.mainStatKeys[slotKey].includes(mainStatKey))\r\n        mainStatKeys[slotKey] = mainStatKeys[slotKey].filter(k => k !== mainStatKey)\r\n      else\r\n        mainStatKeys[slotKey].push(mainStatKey)\r\n      return { ...state, mainStatKeys }\r\n    }\r\n    case `setFilter`: {\r\n      const { index, key, num = 0 } = action\r\n      state.setFilters[index] = { key, num }\r\n      return { ...state, setFilters: [...state.setFilters] }//do this because this is a dependency, so needs to be a \"new\" array\r\n    }\r\n    default:\r\n      break;\r\n  }\r\n  return { ...state, ...action }\r\n}\r\n\r\nexport default function BuildDisplay({ location: { characterKey: propCharacterKey } }) {\r\n  const [characterKey, setcharacterKey] = useState(() => {\r\n    const { characterKey = \"\" } = dbStorage.get(\"BuildsDisplay.state\") ?? {}\r\n    //NOTE that propCharacterKey can override the selected character.\r\n    return (propCharacterKey ?? characterKey) as CharacterKey | \"\"\r\n  })\r\n\r\n  const [builds, setbuilds] = useState([] as any[])\r\n  const [maxBuildsToShow, setmaxBuildsToShow] = useState(() => {\r\n    const { maxBuildsToShow = maxBuildsToShowDefault } = dbStorage.get(\"BuildsDisplay.state\") ?? {}\r\n    return maxBuildsToShow\r\n  })\r\n\r\n  const [modalBuild, setmodalBuild] = useState(null) // the newBuild that is being displayed in the character modal\r\n  const [showArtCondModal, setshowArtCondModal] = useState(false)\r\n  const [showCharacterModal, setshowCharacterModal] = useState(false)\r\n\r\n  const [generatingBuilds, setgeneratingBuilds] = useState(false)\r\n  const [generationProgress, setgenerationProgress] = useState(0)\r\n  const [generationDuration, setgenerationDuration] = useState(0)//in ms\r\n  const [generationSkipped, setgenerationSkipped] = useState(0)\r\n\r\n  const [charDirty, setCharDirty] = useForceUpdate()\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n\r\n  const [artsDirty, setArtsDirty] = useForceUpdate()\r\n\r\n  const isMounted = useRef(false)\r\n\r\n  const worker = useRef(null as Worker | null)\r\n\r\n  type characterDataType = { character?: ICharacter, characterSheet?: CharacterSheet, weaponSheet?: WeaponSheet, initialStats?: ICalculatedStats, statsDisplayKeys?: { basicKeys: any, [key: string]: any } }\r\n  const [{ character, characterSheet, weaponSheet, initialStats, statsDisplayKeys }, setCharacterData] = useState({} as characterDataType)\r\n  const buildSettings = useMemo(() => character?.buildSettings ?? initialBuildSettings(), [character])\r\n  if (buildSettings.setFilters.length === 0) buildSettings.setFilters = initialBuildSettings().setFilters//hotfix for an issue with db. can be removed later.\r\n  const { setFilters, statFilters, mainStatKeys, optimizationTarget, mainStatAssumptionLevel, useLockedArts, useEquippedArts, ascending, } = buildSettings\r\n\r\n  const buildSettingsDispatch = useCallback((action) => {\r\n    if (!character) return\r\n    character.buildSettings = buildSettingsReducer(buildSettings, action)\r\n    database.updateChar(character)\r\n  }, [character, buildSettings])\r\n\r\n  useEffect(() => ReactGA.pageview('/build'), [])\r\n\r\n  //select a new character Key\r\n  const selectCharacter = useCallback((cKey = \"\") => {\r\n    if (characterKey === cKey) return\r\n    setcharacterKey(cKey)\r\n    setbuilds([])\r\n    setCharDirty()\r\n    setCharacterData({})\r\n  }, [setCharDirty, setcharacterKey, characterKey])\r\n\r\n  //load the character data as a whole\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (!characterKey || !artifactSheets) return\r\n      const character = database._getChar(characterKey)\r\n      if (!character) return selectCharacter(\"\")// character is prob deleted.\r\n      const characterSheet = await CharacterSheet.get(characterKey)\r\n      const weaponSheet = await WeaponSheet.get(character.weapon.key)\r\n      if (!characterSheet || !weaponSheet) return\r\n      const initialStats = Character.createInitialStats(character, characterSheet, weaponSheet)\r\n      //NOTE: since initialStats are used, there are no inclusion of artifact formulas here.\r\n      const statsDisplayKeys = Character.getDisplayStatKeys(initialStats, { characterSheet, weaponSheet, artifactSheets })\r\n      setCharacterData({ character, characterSheet, weaponSheet, initialStats, statsDisplayKeys })\r\n    })()\r\n  }, [charDirty, characterKey, artifactSheets, selectCharacter])\r\n\r\n  //register changes in artifact database\r\n  useEffect(() =>\r\n    database.followAnyArt(setArtsDirty),\r\n    [setArtsDirty])\r\n\r\n  //register changes in character in db\r\n  useEffect(() =>\r\n    characterKey ? database.followChar(characterKey, setCharDirty) : undefined,\r\n    [characterKey, setCharDirty])\r\n\r\n  //terminate worker when component unmounts\r\n  useEffect(() => () => worker.current?.terminate(), [])\r\n\r\n  //save to BuildsDisplay.state on change\r\n  useEffect(() => {\r\n    if (isMounted.current) dbStorage.set(\"BuildsDisplay.state\", { characterKey, maxBuildsToShow })\r\n    else isMounted.current = true\r\n  }, [characterKey, maxBuildsToShow])\r\n\r\n  //validate optimizationTarget \r\n  useEffect(() => {\r\n    if (!statsDisplayKeys) return\r\n    if (!Array.isArray(optimizationTarget)) return\r\n    for (const sectionKey in statsDisplayKeys) {\r\n      const section = statsDisplayKeys[sectionKey]\r\n      for (const keys of section)\r\n        if (JSON.stringify(keys) === JSON.stringify(optimizationTarget)) return\r\n    }\r\n    buildSettingsDispatch({ optimizationTarget: initialBuildSettings().optimizationTarget })\r\n  }, [optimizationTarget, statsDisplayKeys, buildSettingsDispatch])\r\n\r\n  const { split, totBuildNumber } = useMemo(() => {\r\n    if (!characterKey) // Make sure we have all slotKeys\r\n      return { split: Object.fromEntries(allSlotKeys.map(slotKey => [slotKey, []])) as ArtifactsBySlot, totBuildNumber: 0 }\r\n    const artifactDatabase = database._getArts().filter(art => {\r\n      //if its equipped on the selected character, bypass the check\r\n      if (art.location === characterKey) return true\r\n\r\n      if (art.lock && !useLockedArts) return false\r\n      if (art.location && !useEquippedArts) return false\r\n      return true\r\n    })\r\n    const split = Artifact.splitArtifactsBySlot(artifactDatabase);\r\n    //filter the split slots on the mainstats selected.\r\n    artifactsSlotsToSelectMainStats.forEach(slotKey =>\r\n      mainStatKeys[slotKey].length && (split[slotKey] = split[slotKey]?.filter((art) => mainStatKeys[slotKey].includes(art.mainStatKey))))\r\n    const totBuildNumber = calculateTotalBuildNumber(split, setFilters)\r\n    return artsDirty && { split, totBuildNumber }\r\n  }, [characterKey, useLockedArts, useEquippedArts, mainStatKeys, setFilters, artsDirty])\r\n\r\n  const generateBuilds = useCallback(() => {\r\n    if (!initialStats || !artifactSheets) return\r\n    setbuilds([])\r\n    setgeneratingBuilds(true)\r\n    setgenerationDuration(0)\r\n    setgenerationProgress(0)\r\n    setgenerationSkipped(0)\r\n    //get the formula for this target\r\n\r\n    initialStats.mainStatAssumptionLevel = mainStatAssumptionLevel\r\n    const artifactSetEffects = Artifact.setEffectsObjs(artifactSheets, initialStats)\r\n    const splitArtifacts = deepClone(split) as ArtifactsBySlot\r\n    //add mainStatVal to each artifact\r\n    Object.values(splitArtifacts).forEach(artArr => {\r\n      artArr!.forEach(art => {\r\n        art.mainStatVal = Artifact.mainStatValue(art.mainStatKey, art.numStars, Math.max(Math.min(mainStatAssumptionLevel, art.numStars * 4), art.level)) ?? 0;\r\n      })\r\n    })\r\n    //generate the key dependencies for the formula\r\n    const minFilters: Dict<StatKey, number> = Object.fromEntries(Object.entries(statFilters).map(([statKey, { min }]) => [statKey, min]).filter(([, min]) => typeof min === \"number\"))\r\n    const maxFilters: Dict<StatKey, number> = Object.fromEntries(Object.entries(statFilters).map(([statKey, { max }]) => [statKey, max]).filter(([, max]) => typeof max === \"number\"))\r\n    //create an obj with app the artifact set effects to pass to buildworker.\r\n    const data = {\r\n      splitArtifacts, initialStats, artifactSetEffects,\r\n      setFilters, minFilters, maxFilters, maxBuildsToShow, optimizationTarget, ascending\r\n    };\r\n    worker.current?.terminate()\r\n    worker.current = new Worker()\r\n    worker.current.onmessage = (e) => {\r\n      if (typeof e.data.progress === \"number\") {\r\n        const { progress, timing = 0, skipped = 0 } = e.data\r\n        setgenerationProgress(progress)\r\n        setgenerationDuration(timing)\r\n        setgenerationSkipped(skipped)\r\n        return\r\n      }\r\n      ReactGA.timing({\r\n        category: \"Build Generation\",\r\n        variable: \"timing\",\r\n        value: e.data.timing,\r\n        label: totBuildNumber.toString()\r\n      })\r\n      const builds = (e.data.builds as Build[]).map(obj =>\r\n        Character.calculateBuildwithArtifact(initialStats, obj.artifacts, artifactSheets))\r\n      setbuilds(builds)\r\n      setgeneratingBuilds(false)\r\n      worker.current?.terminate()\r\n      worker.current = null\r\n    };\r\n    worker.current.postMessage(data)\r\n  }, [artifactSheets, split, totBuildNumber, mainStatAssumptionLevel, ascending, initialStats, maxBuildsToShow, optimizationTarget, setFilters, statFilters])\r\n\r\n  //try to generate build when build numbers are low\r\n  useEffect(() => {\r\n    if (totBuildNumber && totBuildNumber <= autoBuildGenLimit) generateBuilds()\r\n    else setbuilds([])\r\n  }, [characterKey, split, totBuildNumber, buildSettings, generateBuilds])\r\n\r\n  const dropdownitemsForStar = useCallback((star, index) => artifactSheets && ArtifactSheet.setsWithMaxRarity(artifactSheets, star).map(([setKey, setobj]) => {\r\n    if (setFilters.some(filter => filter.key === setKey)) return false;\r\n    const setsNumArr = Object.keys(artifactSheets?.[setKey]?.setEffects ?? {})\r\n    const artsAccountedOther = setFilters.reduce((accu, cur, ind) => (cur.key && ind !== index) ? accu + cur.num : accu, 0)\r\n    if (setsNumArr.every((num: any) => parseInt(num) + artsAccountedOther > 5)) return false;\r\n    return (<Dropdown.Item key={setKey} onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: setKey, num: parseInt(setsNumArr[0] as any) ?? 0 })} >\r\n      {setobj.nameWithIcon}\r\n    </Dropdown.Item>)\r\n  }), [setFilters, buildSettingsDispatch, artifactSheets])\r\n\r\n  const characterName = characterSheet?.name ?? \"Character Name\"\r\n  const characterDropDown = useMemo(() => <DropdownButton title={characterName} disabled={generatingBuilds}>\r\n    <Dropdown.Item onClick={() => selectCharacter(\"\")}>Unselect Character</Dropdown.Item>\r\n    <Dropdown.Divider />\r\n    <CharacterSelectionDropdownList onSelect={cKey => selectCharacter(cKey)} />\r\n  </DropdownButton>, [characterName, generatingBuilds, selectCharacter])\r\n\r\n  const formula = usePromise(Array.isArray(optimizationTarget) ? Formula.get(optimizationTarget) : undefined, [optimizationTarget])\r\n  const sortByText = useMemo(() => {\r\n    if (Array.isArray(optimizationTarget)) {\r\n      if (!formula) return null\r\n      let [type, , talentKey] = (formula as any).keys as string[]\r\n      const field = (formula as any).field as IFieldDisplay\r\n      const variant = Character.getTalentFieldValue(field, \"variant\", initialStats)\r\n      const text = Character.getTalentFieldValue(field, \"text\", initialStats)\r\n      if (type === \"character\") {\r\n        if (talentKey === \"normal\" || talentKey === \"charged\" || talentKey === \"plunging\") talentKey = \"auto\"\r\n        return <b>{characterSheet?.getTalentOfKey(talentKey, initialStats?.characterEle)?.name}: <span className={`text-${variant}`}>{text}</span></b>\r\n      } else if (type === \"weapon\") {\r\n        return <b>{weaponSheet?.name}: <span className={`text-${variant}`}>{text}</span></b>\r\n      }\r\n    } else return <b>Basic Stat: <span className={`text-${Stat.getStatVariant(optimizationTarget)}`}>{Stat.getStatNameWithPercent(optimizationTarget)}</span></b>\r\n    // return <Badge variant=\"danger\">INVALID</Badge>\r\n  }, [optimizationTarget, formula, initialStats, characterSheet, weaponSheet])\r\n\r\n\r\n  const artsAccounted = setFilters.reduce((accu, cur) => cur.key ? accu + cur.num : accu, 0)\r\n  const artifactCondCount = useMemo(() => {\r\n    let count = 0;\r\n    crawlObject(initialStats?.conditionalValues?.artifact, [], v => Array.isArray(v), () => count++)\r\n    return count\r\n  }, [initialStats?.conditionalValues])\r\n  //rudimentary dispatcher, definitely not the same API as the real characterDispatch.\r\n  const characterDispatch = useCallback(val => database.updateChar({ ...character, ...val }), [character])\r\n  return <Container className=\"mt-2\">\r\n    <InfoComponent\r\n      pageKey=\"buildPage\"\r\n      modalTitle=\"Character Management Page Guide\"\r\n      text={[\"For self-infused attacks, like Noelle's Sweeping Time, enable the skill in the talent page.\",\r\n        \"You can compare the difference between equipped artifacts and generated builds.\",\r\n        \"The more complex the formula, the longer the generation time.\",]}\r\n    ><InfoDisplay /></InfoComponent>\r\n    <BuildModal {...{ build: modalBuild, showCharacterModal, characterKey, selectCharacter, setmodalBuild, setshowCharacterModal }} />\r\n    {!!initialStats && <ArtConditionalModal {...{ showArtCondModal, setshowArtCondModal, initialStats, characterDispatch, artifactCondCount }} />}\r\n    <Row className=\"mt-2 mb-2\">\r\n      <Col>\r\n        {/* Build Generator Editor */}\r\n        <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n          <Card.Header>Build Generator</Card.Header>\r\n          <Card.Body>\r\n            <Row >\r\n              <Col xs={12} lg={6}>\r\n                {/* character selection */}\r\n                {characterKey ?\r\n                  <CharacterCard header={characterDropDown} characterKey={characterKey} bg={\"lightcontent\"} cardClassName=\"mb-2\" onEdit={!generatingBuilds ? () => setshowCharacterModal(true) : undefined} /> :\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n                    <Card.Header>\r\n                      {characterDropDown}\r\n                    </Card.Header>\r\n                  </Card>}\r\n                {/* Hit mode options */}\r\n                {characterSheet && character && initialStats && <HitModeCard build={initialStats} characterSheet={characterSheet} className=\"mb-2\" character={character} />}\r\n                {/* Final Stat Filter */}\r\n                {Boolean(statsDisplayKeys) && <StatFilterCard className=\"mb-2\" statFilters={statFilters} statKeys={statsDisplayKeys?.basicKeys as any} setStatFilters={sFs => buildSettingsDispatch({ statFilters: sFs })} />}\r\n              </Col>\r\n              <Col xs={12} lg={6}><Row>\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}><Card.Body>\r\n                    <Button className=\"w-100\" onClick={() => setshowArtCondModal(true)} disabled={generatingBuilds}>\r\n                      <span>Default Artifact Set Effects {Boolean(artifactCondCount) && <Badge variant=\"success\">{artifactCondCount} Selected</Badge>}</span>\r\n                    </Button>\r\n                  </Card.Body></Card>\r\n                </Col>\r\n                {/* Artifact set picker */}\r\n                {setFilters.map(({ key: setKey, num: setNum }, index) => <Col className=\"mb-2\" key={index} xs={12}>\r\n                  <Card className=\"h-100\" bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                    <Card.Header>\r\n                      <ButtonGroup>\r\n                        {/* Artifact set */}\r\n                        <DropdownButton as={ButtonGroup} title={artifactSheets?.[setKey]?.nameWithIcon ?? \"Artifact Set Filter\"} disabled={generatingBuilds}>\r\n                          <Dropdown.Item onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: \"\" })}>Unselect Artifact</Dropdown.Item>\r\n                          <Dropdown.ItemText>Max Rarity </Dropdown.ItemText>\r\n                          {dropdownitemsForStar(5, index)}\r\n                          <Dropdown.Divider />\r\n                          <Dropdown.ItemText>Max Rarity </Dropdown.ItemText>\r\n                          {dropdownitemsForStar(4, index)}\r\n                          <Dropdown.Divider />\r\n                          <Dropdown.ItemText>Max Rarity </Dropdown.ItemText>\r\n                          {dropdownitemsForStar(3, index)}\r\n                        </DropdownButton>\r\n                        {/* set number */}\r\n                        <DropdownButton as={ButtonGroup} title={`${setNum}-set`}\r\n                          disabled={generatingBuilds || !setKey || artsAccounted >= 5}\r\n                        >\r\n                          {!!initialStats && Object.keys(artifactSheets?.[setKey]?.setEffects ?? {}).map((num: any) => {\r\n                            let artsAccountedOther = setFilters.reduce((accu, cur) => (cur.key && cur.key !== setKey) ? accu + cur.num : accu, 0)\r\n                            return (parseInt(num) + artsAccountedOther <= 5) &&\r\n                              (<Dropdown.Item key={num} onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: setFilters[index].key, num: parseInt(num) })} >\r\n                                {`${num}-set`}\r\n                              </Dropdown.Item>)\r\n                          })}\r\n                        </DropdownButton>\r\n                      </ButtonGroup>\r\n                    </Card.Header>\r\n                    {setKey ? <Card.Body><Row className=\"mb-n2\">\r\n                      {!!initialStats && Object.keys(artifactSheets?.[setKey].setEffects ?? {}).map(setNKey => parseInt(setNKey) as SetNum).filter(setNkey => setNkey <= setNum).map(setNumKey =>\r\n                        <SetEffectDisplay newBuild={undefined} key={setKey + setNumKey} {...{ setKey, setNumKey, equippedBuild: initialStats, characterDispatch, editable: true }} />)}\r\n                    </Row></Card.Body> : null}\r\n                  </Card>\r\n                </Col>)}\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}><Card.Body className=\"mb-n2\">\r\n                    <Button className=\"w-100 mb-2\" onClick={() => buildSettingsDispatch({ useEquippedArts: !useEquippedArts })} disabled={generatingBuilds}>\r\n                      <span><FontAwesomeIcon icon={useEquippedArts ? faCheckSquare : faSquare} /> Use Equipped Artifacts</span>\r\n                    </Button>\r\n                    <Button className=\"w-100 mb-2\" onClick={() => buildSettingsDispatch({ useLockedArts: !useLockedArts })} disabled={generatingBuilds}>\r\n                      <span><FontAwesomeIcon icon={useLockedArts ? faCheckSquare : faSquare} /> Use Locked Artifacts</span>\r\n                    </Button>\r\n                  </Card.Body></Card>\r\n                </Col>\r\n                {/* main stat selector */}\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                    <Card.Header>\r\n                      <Row>\r\n                        <Col>Artifact Main Stat</Col>\r\n                        <Col xs=\"auto\"><AssumeFullLevelToggle mainStatAssumptionLevel={mainStatAssumptionLevel} setmainStatAssumptionLevel={v => buildSettingsDispatch({ mainStatAssumptionLevel: v })} /></Col>\r\n                      </Row>\r\n                    </Card.Header>\r\n                    <Card.Body className=\"mb-n2\">\r\n                      {artifactsSlotsToSelectMainStats.map(slotKey => {\r\n                        const numSel = mainStatKeys[slotKey].length\r\n                        return <Card bg=\"darkcontent\" text={\"lightfont\" as any} className=\"mb-2\" key={slotKey}>\r\n                          <Card.Header className=\"p-2\"><Row >\r\n                            <Col className=\"ml-2\"><SlotNameWithIcon slotKey={slotKey} /></Col>\r\n                            <Col xs=\"auto\"><Badge variant=\"info\">{numSel ? `${numSel} Selected` : `Any`}</Badge></Col>\r\n                          </Row></Card.Header>\r\n                          <Card.Body className=\"p-0\"><Row className=\"no-gutters\">\r\n                            {Artifact.slotMainStats(slotKey).map((mainStatKey, i) => {\r\n                              const selected = mainStatKeys[slotKey].includes(mainStatKey)\r\n                              return <Col xs={i < 3 ? 4 : 6} key={mainStatKey}>\r\n                                <Button className=\"w-100 rounded-0\" size=\"sm\" variant={selected ? \"success\" : \"secondary\"}\r\n                                  onClick={() => buildSettingsDispatch({ type: \"mainStatKey\", slotKey, mainStatKey })}>\r\n                                  {StatIcon[mainStatKey]} {Stat.getStatNameWithPercent(mainStatKey, \"\", false)}\r\n                                </Button>\r\n                              </Col>\r\n                            })}\r\n                          </Row></Card.Body>\r\n                        </Card>\r\n                      })}\r\n                    </Card.Body>\r\n                  </Card>\r\n                </Col>\r\n              </Row></Col>\r\n            </Row>\r\n            <Row className=\"d-flex justify-content-between mb-2\">\r\n              <Col xs=\"auto\" >\r\n                <ButtonGroup>\r\n                  <Button\r\n                    className=\"h-100\"\r\n                    disabled={!characterKey || generatingBuilds}\r\n                    variant={(characterKey && totBuildNumber <= warningBuildNumber) ? \"success\" : \"warning\"}\r\n                    onClick={generateBuilds}\r\n                  ><span>Generate</span></Button>\r\n                  <Dropdown as={ButtonGroup}>\r\n                    <OverlayTrigger\r\n                      overlay={<Tooltip id=\"max-build-tooltip\">\r\n                        Decreasing the number of generated build will decrease build calculation time for large number of builds.\r\n                      </Tooltip>}\r\n                    >\r\n                      <Dropdown.Toggle ><b>{maxBuildsToShow}</b> {maxBuildsToShow === 1 ? \"Build\" : \"Builds\"}</Dropdown.Toggle>\r\n                    </OverlayTrigger>\r\n                    <Dropdown.Menu>\r\n                      {maxBuildsToShowList.map(v => <Dropdown.Item key={v} onClick={() => setmaxBuildsToShow(v)}>{v} {v === 1 ? \"Build\" : \"Builds\"}</Dropdown.Item>)}\r\n                    </Dropdown.Menu>\r\n                  </Dropdown>\r\n                  <Button\r\n                    className=\"h-100\"\r\n                    disabled={!generatingBuilds}\r\n                    variant=\"danger\"\r\n                    onClick={() => {\r\n                      if (!worker.current) return;\r\n                      worker.current.terminate();\r\n                      worker.current = null\r\n                      setgeneratingBuilds(false)\r\n                      setbuilds([])\r\n                      setgenerationDuration(0)\r\n                      setgenerationProgress(0)\r\n                      setgenerationSkipped(0)\r\n                    }}\r\n                  ><span>Cancel</span></Button>\r\n                </ButtonGroup>\r\n              </Col>\r\n              <Col xs=\"auto\">\r\n                {/* Dropdown to select sorting value */}\r\n                {<ButtonGroup>\r\n                  <Dropdown as={ButtonGroup} drop=\"up\">\r\n                    <Dropdown.Toggle disabled={generatingBuilds} variant=\"light\" >\r\n                      <span>Optimization Target: {sortByText}</span>\r\n                    </Dropdown.Toggle>\r\n                    <Dropdown.Menu align=\"right\" style={{ minWidth: \"40rem\" }} >\r\n                      <Row>\r\n                        {!!statsDisplayKeys && Object.entries(statsDisplayKeys).map(([sectionKey, fields]: [string, any]) => {\r\n                          const header = (characterSheet && weaponSheet && artifactSheets) ? getFormulaTargetsDisplayHeading(sectionKey, { characterSheet, weaponSheet, artifactSheets }, initialStats?.characterEle) : sectionKey\r\n                          return <Col xs={12} md={6} key={sectionKey}>\r\n                            <Dropdown.Header style={{ overflow: \"hidden\", textOverflow: \"ellipsis\" }}><b>{header}</b></Dropdown.Header>\r\n                            {fields.map((target, i) => {\r\n                              if (Array.isArray(target))\r\n                                return <TargetSelectorDropdownItem key={i} {...{ target, buildSettingsDispatch, initialStats }} />\r\n                              else if (typeof target === \"string\")\r\n                                return <Dropdown.Item key={i} onClick={() => buildSettingsDispatch({ optimizationTarget: target })}>{Stat.getStatNameWithPercent(target)}</Dropdown.Item>\r\n                              return null\r\n                            })}\r\n                          </Col>\r\n                        })}\r\n                      </Row>\r\n                    </Dropdown.Menu>\r\n                  </Dropdown>\r\n                  <Button onClick={() => buildSettingsDispatch({ ascending: !buildSettings.ascending })} disabled={generatingBuilds} variant={ascending ? \"danger\" : \"primary\"}>\r\n                    <FontAwesomeIcon icon={ascending ? faSortAmountDownAlt : faSortAmountUp} className=\"fa-fw\" />\r\n                    <span>{ascending ? \"Ascending\" : \"Descending\"}</span>\r\n                  </Button>\r\n                </ButtonGroup >}\r\n              </Col>\r\n            </Row>\r\n            <Row className=\"\">\r\n              <Col>{!!characterKey && <BuildAlert {...{ totBuildNumber, generatingBuilds, generationSkipped, generationProgress, generationDuration, characterName, maxBuildsToShow }} />}</Col>\r\n            </Row>\r\n          </Card.Body>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n    <Row className=\"mb-2\">\r\n      <Col>\r\n        <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n          <Card.Header>\r\n            <Row>\r\n              <Col>{characterKey ? <span>Showing <b>{builds.length}</b> Builds generated for {characterName}</span> : <span>Select a character to generate builds.</span>}</Col>\r\n            </Row>\r\n          </Card.Header>\r\n          {/* Build List */}\r\n          <ListGroup>\r\n            {builds.map((build, index) =>\r\n              index < maxBuildsToShow && characterSheet && weaponSheet && artifactSheets && <ArtifactDisplayItem sheets={{ characterSheet, weaponSheet, artifactSheets }} build={build} characterKey={characterKey as CharacterKey} index={index} key={index} statsDisplayKeys={statsDisplayKeys} onClick={() => setmodalBuild(build as any)} />\r\n            )}\r\n          </ListGroup>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n  </Container >\r\n}\r\n\r\nfunction TargetSelectorDropdownItem({ target, buildSettingsDispatch, initialStats }) {\r\n  const formula = usePromise(Formula.get(target), [target])\r\n  if (!formula) return null\r\n  const talentField = (formula as any).field as IFieldDisplay\r\n  return <Dropdown.Item onClick={() => buildSettingsDispatch({ optimizationTarget: target })} style={{ overflow: \"hidden\", textOverflow: \"ellipsis\" }}>\r\n    <span className={`text-${Character.getTalentFieldValue(talentField, \"variant\", initialStats)}`}>{Character.getTalentFieldValue(talentField, \"text\", initialStats)}</span>\r\n  </Dropdown.Item>\r\n}\r\n\r\nfunction BuildModal({ build, showCharacterModal, characterKey, selectCharacter, setmodalBuild, setshowCharacterModal }) {\r\n  const closeModal = useCallback(() => {\r\n    setmodalBuild(null)\r\n    setshowCharacterModal(false)\r\n  }, [setmodalBuild, setshowCharacterModal])\r\n  return <Modal show={Boolean(showCharacterModal || build)} onHide={closeModal} size=\"xl\" contentClassName=\"bg-transparent\">\r\n    <React.Suspense fallback={<span>Loading...</span>}>\r\n      <CharacterDisplayCard\r\n        character={undefined}\r\n        tabName={undefined}\r\n        characterKey={characterKey}\r\n        setCharacterKey={cKey => selectCharacter(cKey)}\r\n        newBuild={build}\r\n        onClose={closeModal}\r\n        editable={showCharacterModal}\r\n        footer={<Button variant=\"danger\" onClick={closeModal}>Close</Button>} />\r\n    </React.Suspense>\r\n  </Modal>\r\n}\r\n\r\nfunction ArtConditionalModal({ showArtCondModal, setshowArtCondModal, initialStats, characterDispatch, artifactCondCount }) {\r\n  const closeArtCondModal = useCallback(() => setshowArtCondModal(false), [setshowArtCondModal])\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n  if (!artifactSheets) return null\r\n  const artSetKeyList = Object.entries(ArtifactSheet.setKeysByRarities(artifactSheets)).reverse().flatMap(([, sets]) => sets)\r\n  return <Modal show={showArtCondModal} onHide={closeArtCondModal} size=\"xl\" contentClassName=\"bg-transparent\">\r\n    <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n      <Card.Header>\r\n        <Row>\r\n          <Col>\r\n            <h5>Default Artifact Set Effects  {Boolean(artifactCondCount) && <Badge variant=\"success\">{artifactCondCount} Selected</Badge>}</h5>\r\n          </Col>\r\n          <Col xs=\"auto\" >\r\n            <Button onClick={() => {\r\n              if (initialStats.conditionalValues.artifact) initialStats.conditionalValues.artifact = {}\r\n              characterDispatch({ conditionalValues: initialStats.conditionalValues })\r\n            }}><span><FontAwesomeIcon icon={faUndo} /> Reset All</span></Button>\r\n          </Col>\r\n          <Col xs=\"auto\" >\r\n            <Button variant=\"danger\" onClick={closeArtCondModal}>\r\n              <FontAwesomeIcon icon={faTimes} /></Button>\r\n          </Col>\r\n        </Row>\r\n      </Card.Header>\r\n      <Card.Body>\r\n        <Row>\r\n          {artSetKeyList.map(setKey => {\r\n            const sheet = artifactSheets[setKey]\r\n            let icon = Object.values(sheet.slotIcons)[0]\r\n            const rarity = sheet.rarity\r\n            const numStars = rarity[0]\r\n            return <Col className=\"mb-2\" key={setKey} xs={12} lg={6} xl={4}>\r\n              <Card className=\"h-100\" bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                <Card.Header >\r\n                  <Row>\r\n                    <Col xs=\"auto\" className=\"ml-n3 my-n2\">\r\n                      <Image src={icon} className={`thumb-mid grad-${numStars}star m-1`} thumbnail />\r\n                    </Col>\r\n                    <Col >\r\n                      <h6><b>{artifactSheets?.[setKey].name ?? \"\"}</b></h6>\r\n                      <span>{rarity.map((ns, i) => <span key={ns}>{ns}<Stars stars={1} /> {i < (rarity.length - 1) ? \"/ \" : null}</span>)}</span>\r\n                    </Col>\r\n                  </Row>\r\n                </Card.Header>\r\n                <Card.Body><Row className=\"mb-n2\">\r\n                  {Boolean(setKey) && Object.keys(sheet.setEffects).map(key => parseInt(key) as SetNum).map(setNumKey =>\r\n                    <SetEffectDisplay newBuild={undefined} key={setKey + setNumKey} {...{ setKey, setNumKey, equippedBuild: initialStats, editable: true, characterDispatch, }} />)}\r\n                </Row></Card.Body>\r\n              </Card>\r\n            </Col>\r\n          })}\r\n        </Row>\r\n      </Card.Body>\r\n      <Card.Footer>\r\n        <Button variant=\"danger\" onClick={closeArtCondModal}>\r\n          <FontAwesomeIcon icon={faTimes} /> CLOSE</Button>\r\n      </Card.Footer>\r\n    </Card>\r\n  </Modal>\r\n}\r\n\r\nfunction StatFilterItem({ statKey, statKeys = [], min, max, close, setFilter }: {\r\n  statKey?, statKeys, min, max, close, setFilter\r\n}) {\r\n  const isFloat = Stat.getStatUnit(statKey) === \"%\"\r\n  const inputProps = {\r\n    disabled: !statKey,\r\n    allowEmpty: true,\r\n    float: isFloat,\r\n  }\r\n  const minInputProps = {\r\n    ...inputProps,\r\n    placeholder: \"MIN\",\r\n    value: min,\r\n    onChange: (s) => setFilter(statKey, s, max)\r\n  }\r\n  const maxInputProps = {\r\n    ...inputProps,\r\n    placeholder: \"MAX\",\r\n    value: max,\r\n    onChange: (s) => setFilter(statKey, min, s)\r\n  }\r\n  return <InputGroup className=\"mb-2\">\r\n    <DropdownButton\r\n      as={InputGroup.Prepend}\r\n      title={Stat.getStatNameWithPercent(statKey, \"New Stat\")}\r\n      id=\"input-group-dropdown-1\"\r\n    >\r\n      {statKeys.map(sKey => <Dropdown.Item key={sKey} onClick={() => { close?.(); setFilter(sKey, min, max) }}>{Stat.getStatNameWithPercent(sKey)}</Dropdown.Item>)}\r\n    </DropdownButton>\r\n    <CustomFormControl {...minInputProps} />\r\n    <CustomFormControl {...maxInputProps} />\r\n    {Boolean(close) && <InputGroup.Append>\r\n      <Button variant=\"danger\" onClick={close}><FontAwesomeIcon icon={faTrash} /></Button>\r\n    </InputGroup.Append>}\r\n  </InputGroup>\r\n}\r\n\r\nfunction HitModeCard({ characterSheet, character, build, className }: { characterSheet: CharacterSheet, character: ICharacter, build: ICalculatedStats, className: string }) {\r\n  const setHitmode = useCallback(({ hitMode }) => database.updateChar({ ...character, hitMode }), [character])\r\n  const setReactionMode = useCallback(({ reactionMode }) => database.updateChar({ ...character, reactionMode }), [character])\r\n  const setInfusionAura = useCallback(({ infusionAura }) => database.updateChar({ ...character, infusionAura }), [character])\r\n  if (!character) return null\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className={className}>\r\n    <Card.Header>\r\n      <Row>\r\n        <Col>Hit Mode Options</Col>\r\n        <Col xs=\"auto\"><InfusionAuraDropdown characterSheet={characterSheet} character={character} characterDispatch={setInfusionAura} /></Col>\r\n      </Row>\r\n    </Card.Header>\r\n    <Card.Body className=\"mb-n2\">\r\n      <HitModeToggle hitMode={character.hitMode} characterDispatch={setHitmode} className=\"w-100 mb-2\" />\r\n      <ReactionToggle build={build} character={character} characterDispatch={setReactionMode} className=\"w-100 mb-2\" />\r\n    </Card.Body>\r\n  </Card >\r\n}\r\n\r\nfunction StatFilterCard({ statKeys = [], statFilters = {}, setStatFilters, className }) {\r\n  const remainingKeys = statKeys.filter(key => !(Object.keys(statFilters) as any).some(k => k === key))\r\n  const setFilter = (sKey, min, max) => setStatFilters({ ...statFilters, [sKey]: { min, max } })\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className={className}>\r\n    <Card.Header>Final Stat Filter</Card.Header>\r\n    <Card.Body>\r\n      <Row className=\"mb-n2\">\r\n        {(Object.entries(statFilters) as [string, { min, max }][]).map(([statKey, { min, max }]) => {\r\n          return <Col xs={12} key={statKey} ><StatFilterItem statKey={statKey} statKeys={remainingKeys} setFilter={setFilter} min={min} max={max} close={() => {\r\n            delete statFilters[statKey]\r\n            setStatFilters({ ...statFilters })\r\n          }} /></Col>\r\n        })}\r\n        <Col xs={12}>\r\n          <StatFilterItem min={undefined} max={undefined} close={undefined} statKeys={remainingKeys} setFilter={setFilter} />\r\n        </Col>\r\n      </Row>\r\n    </Card.Body>\r\n  </Card>\r\n}\r\n\r\ntype ArtifactDisplayItemProps = {\r\n  sheets: {\r\n    characterSheet: CharacterSheet\r\n    weaponSheet: WeaponSheet,\r\n    artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet>\r\n  },\r\n  index: number,\r\n  characterKey: CharacterKey,\r\n  build: ICalculatedStats,\r\n  statsDisplayKeys: any,\r\n  onClick: () => void\r\n}\r\n//for displaying each artifact build\r\nfunction ArtifactDisplayItem({ sheets, sheets: { artifactSheets }, index, characterKey, build, statsDisplayKeys, onClick }: ArtifactDisplayItemProps) {\r\n  const character = database._getChar(characterKey)\r\n  if (!character) return null\r\n  const { equippedArtifacts } = character\r\n  const currentlyEquipped = allSlotKeys.every(slotKey => equippedArtifacts[slotKey] === build.equippedArtifacts?.[slotKey])\r\n  return (<div>\r\n    <ListGroup.Item\r\n      variant={index % 2 ? \"customdark\" : \"customdarker\"} className=\"text-white\" action\r\n      onClick={onClick}\r\n    >\r\n      <h5 className=\"mb-2\"><Row>\r\n        <Col xs=\"auto\">\r\n          <Badge variant=\"info\"><strong>{index + 1}{currentlyEquipped ? \" (Equipped)\" : \"\"}</strong></Badge>\r\n        </Col>\r\n        <Col xs=\"auto\">{(Object.entries(build.setToSlots) as [ArtifactSetKey, SlotKey[]][]).sort(([key1, slotarr1], [key2, slotarr2]) => slotarr2.length - slotarr1.length).map(([key, slotarr]) =>\r\n          <Badge key={key} variant={currentlyEquipped ? \"success\" : \"primary\"} className=\"mr-2\">\r\n            {slotarr.map(slotKey => artifactSlotIcon(slotKey))} {artifactSheets?.[key].name ?? \"\"}\r\n          </Badge>\r\n        )}</Col>\r\n      </Row></h5>\r\n      <StatDisplayComponent editable={false} {...{ sheets, character, newBuild: build, statsDisplayKeys, cardbg: (index % 2 ? \"lightcontent\" : \"darkcontent\") }} />\r\n    </ListGroup.Item>\r\n  </div>)\r\n}\r\n\r\nfunction BuildAlert({ totBuildNumber, generatingBuilds, generationSkipped, generationProgress, generationDuration, characterName, maxBuildsToShow }) {\r\n  const totalBuildNumberString = totBuildNumber?.toLocaleString() ?? totBuildNumber\r\n  const totalUnskipped = totBuildNumber - generationSkipped\r\n  const generationProgressString = generationProgress?.toLocaleString() ?? generationProgress\r\n  const generationSkippedString = generationSkipped?.toLocaleString() ?? generationSkipped\r\n  const totalUnskippedString = totalUnskipped?.toLocaleString() ?? totalUnskipped\r\n  const generationSkippedText = Boolean(generationSkipped) && <span>(<b>{generationSkippedString}</b> skipped)</span>\r\n  if (generatingBuilds) {\r\n    let progPercent = generationProgress * 100 / (totalUnskipped)\r\n    return <Alert variant=\"success\">\r\n      <span>Generating and testing <b className=\"text-monospace\">{generationProgressString}/{totalUnskippedString}</b> build configurations against the criteria for <b>{characterName}</b>. {generationSkippedText}</span><br />\r\n      <h6>Time elapsed: <strong className=\"text-monospace\">{timeStringMs(generationDuration)}</strong></h6>\r\n      <ProgressBar now={progPercent} label={`${progPercent.toFixed(1)}%`} />\r\n    </Alert>\r\n  } else if (!generatingBuilds && generationProgress) {//done\r\n    return <Alert variant=\"success\">\r\n      <span>Generated and tested <b className=\"text-monospace\">{totalUnskippedString}</b> Build configurations against the criteria for <b>{characterName}</b>. {generationSkippedText}</span>\r\n      <h6>Total duration: <strong className=\"text-monospace\">{timeStringMs(generationDuration)}</strong></h6>\r\n      <ProgressBar now={100} variant=\"success\" label=\"100%\" />\r\n    </Alert>\r\n  } else {\r\n    return totBuildNumber === 0 ?\r\n      <Alert variant=\"warning\" className=\"mb-0\"><span>Current configuration will not generate any builds for <b>{characterName}</b>. Please change your Artifact configurations, or add/unlock more Artifacts.</span></Alert>\r\n      : (totBuildNumber > warningBuildNumber ?\r\n        <Alert variant=\"warning\" className=\"mb-0\"><span>Current configuration will generate <b>{totalBuildNumberString}</b> builds for <b>{characterName}</b>. This might take quite a while to generate...</span></Alert> :\r\n        <Alert variant=\"success\" className=\"mb-0\"><span>Current configuration {totBuildNumber <= maxBuildsToShow ? \"generated\" : \"will generate\"} <b>{totalBuildNumberString}</b> builds for <b>{characterName}</b>.</span></Alert>)\r\n  }\r\n}\r\n\r\nconst levels = {\r\n  0: <span>No level assumption</span>,\r\n  4: <span>Assume at least level 4</span>,\r\n  8: <span>Assume at least level 8</span>,\r\n  12: <span>Assume at least level 12</span>,\r\n  16: <span>Assume at least level 16</span>,\r\n  20: <span>Assume at least level 20</span>\r\n}\r\nfunction AssumeFullLevelToggle({ mainStatAssumptionLevel = 0, setmainStatAssumptionLevel }) {\r\n  return <OverlayTrigger overlay={<Tooltip id=\"assume-level-tooltip\">Change Main Stat value to be at least a specific level. Does not change substats.</Tooltip>}  >\r\n    <Dropdown>\r\n      <Dropdown.Toggle variant={mainStatAssumptionLevel ? \"orange\" : \"primary\"}>{levels[mainStatAssumptionLevel]}</Dropdown.Toggle>\r\n      <Dropdown.Menu>\r\n        {Object.entries(levels).map(([key, text]) => <Dropdown.Item key={key} onClick={() => setmainStatAssumptionLevel(parseInt(key))}>{text}</Dropdown.Item>)}\r\n      </Dropdown.Menu>\r\n    </Dropdown>\r\n  </OverlayTrigger>\r\n}\r\n"],"sourceRoot":""}