import{e as o,p as e,n as C,aH as z,aI as Q,U as _,aJ as V,aK as X,q as W,r as Y,i as Z,j as ee,u as F,a9 as ae,b as H,d as te,ap as re,aL as $,X as se,aE as oe,Q as ne,aM as le,K as N,J as A,C as B,aA as L,B as E,D as ie,T as ce,aN as me,aO as ue}from"./index-85cfbf13.js";import{T as O,A as he,C as de,f as pe,s as fe,u as ge,a as ye,S as Ce}from"./StarDisplay-fcf9b853.js";import{a as Te,T as ve,d as xe}from"./TeamCard-63cabba9.js";import{M as we}from"./DropdownButton-06faedfe.js";import{g as Se}from"./index-ac0d9841.js";import{b as be}from"./totalUtils-4e306bf7.js";import{C as ke}from"./CardHeader-33aefca0.js";import"./ColoredText-1e6821be.js";import"./BootstrapTooltip-b3328893.js";import"./DataContext-cb40fc9b.js";import"./Artifact-1851f3bf.js";import"./SqBadge-454f7f55.js";import"./index-ef713999.js";import"./SlotIcon-10e77f9b.js";import"./useWeapon-36a17728.js";import"./index-95ad8698.js";import"./CardActionArea-d26a3a9f.js";function Ie({options:i,valueKeys:a,label:d,onChange:u,toImg:g,toExItemLabel:p,toExLabel:m,chipProps:T,...S}){const b=o.useMemo(()=>a.map(n=>i.find(t=>t.key===n)).filter(n=>n),[i,a]);return e(he,{autoHighlight:!0,options:i,multiple:!0,disableCloseOnSelect:!0,value:b,onChange:(n,t,c)=>c==="clear"?u([]):t!==null&&u(t.map(l=>l.key)),isOptionEqualToValue:(n,t)=>n.key===t.key,renderInput:n=>e(O,{...n,label:d,inputProps:{...n.inputProps,autoComplete:"new-password"},color:a.length?"success":"primary"}),renderOption:(n,t)=>C(we,{value:t.key,...n,children:[e(z,{children:g(t.key)}),e(Q,{children:e(o.Suspense,{fallback:e(_,{variant:"text",width:100}),children:C(V,{color:t.color,sx:{display:"flex",gap:1},children:[a.includes(t.key)?e("strong",{children:t.label}):e("span",{children:t.label}),p==null?void 0:p(t.key)]})})}),!!t.favorite&&e(Te,{})]}),renderTags:(n,t)=>n.map(({key:c,label:l,color:y},v)=>X(W,{...T,...t({index:v}),key:`${v}${c}${l}`,icon:g(c),label:m?C("span",{children:[l," ",m(c)]}):l,color:y})),filterOptions:(n,{inputValue:t})=>n.filter(c=>{var l;return c.label.toLowerCase().includes(t.toLowerCase())||((l=c.alternateNames)==null?void 0:l.some(y=>y.toLowerCase().includes(t.toLowerCase())))}),...S})}var j={},De=Z;Object.defineProperty(j,"__esModule",{value:!0});var P=j.default=void 0,Me=De(Y()),_e=ee,Ke=(0,Me.default)((0,_e.jsx)("path",{d:"M5 20h14v-2H5v2zm0-10h4v6h6v-6h4l-7-7-7 7z"}),"Upload");P=j.default=Ke;function Ne({teamIds:i,charKeys:a,setCharKey:d,acProps:u}){const{t:g}=F(["sillyWisher_charNames","charNames_gen"]),{silly:p}=o.useContext(ae),m=H(),{gender:T}=te(),S=o.useCallback(r=>m.charMeta.get(r).favorite,[m.charMeta]),b=o.useCallback(r=>e(de,{characterKey:r}),[]),n=o.useCallback((r,h)=>g(`${h?"sillyWisher_charNames":"charNames_gen"}:${re(r,T)}`),[T,g]),t=o.useCallback(r=>Se(r,T).elementKey??void 0,[T]),c=o.useMemo(()=>m.chars.keys,[m]),{characterTeamTotal:l}=o.useMemo(()=>be({characterTeamTotal:c},h=>{m.teams.values.forEach(f=>{const{loadoutData:x}=f;x.filter($).forEach(({teamCharId:D})=>{const k=m.teamChars.get(D);if(!k)return;const I=k.key;h.characterTeamTotal[I].total++})}),i.forEach(f=>{const x=m.teams.get(f);if(!x)return;const{loadoutData:D}=x;D.filter($).forEach(({teamCharId:k})=>{const I=m.teamChars.get(k);if(!I)return;const M=I.key;h.characterTeamTotal[M].current++})})}),[m,c,i]),y=o.useCallback(r=>e("strong",{children:l[r]}),[l]),v=o.useCallback(r=>e(W,{size:"small",label:l[r]}),[l]),K=o.useMemo(()=>c.map(r=>({key:r,label:n(r,p),favorite:S(r),color:t(r)})).sort((r,h)=>r.favorite&&!h.favorite?-1:!r.favorite&&h.favorite?1:r.label.localeCompare(h.label)),[p,n,t,S,c]);return e(o.Suspense,{fallback:e(_,{variant:"text",width:100}),children:e(Ie,{label:"Characters",options:K,toImg:b,valueKeys:a,onChange:r=>d(r),toExLabel:y,toExItemLabel:v,chipProps:{variant:"outlined"},...u})})}function Ee(){return{name:i=>i.name??"",lastEdit:i=>i.lastEdit??0}}const $e={name:["name","lastEdit"],lastEdit:["lastEdit"]};function Oe(i){return{charKeys:(a,d)=>{var u;return!d.length||!!((u=i.teams.get(a))!=null&&u.loadoutData.filter($).every(({teamCharId:g})=>{var p;return d.includes((p=i.teamChars.get(g))==null?void 0:p.key)}))},name:(a,d)=>{var u;return!d||!!((u=i.teams.get(a))!=null&&u.name.toLowerCase().includes(d.toLowerCase()))}}}const Pe={xs:1,sm:2,md:3,lg:3,xl:3},je={xs:6,sm:12,md:18,lg:24,xl:24};function ea(){const{t:i}=F(["page_teams","sillyWisher_charNames","charNames_gen"]),a=H(),[d,u]=se(),g=oe();o.useEffect(()=>a.teams.followAny((s,w)=>(w==="new"||w==="remove"||w==="update")&&u()),[u,a]);const p=()=>{const s=a.teams.new();g(s)},[m,T,S]=ne(),[b,n]=o.useState(""),t=()=>{try{const s=JSON.parse(b);a.teams.import(s)||window.alert("Data verification failed."),S()}catch(s){window.alert(`Data Import failed. ${s}`);return}},c=le(a.displayTeam),{sortType:l,ascending:y,charKeys:v}=c,[K,r]=o.useState(c.searchTerm),h=o.useDeferredValue(K);o.useEffect(()=>{a.displayTeam.set({searchTerm:h})},[a,h]);const{teamIds:f,totalTeamNum:x}=o.useMemo(()=>{const s=a.teams.keys.length,w=a.teams.keys.filter(pe({charKeys:v,name:h},Oe(a))).sort((G,R)=>fe($e[l],y,Ee())(a.teams.get(G),a.teams.get(R)));return d&&{teamIds:w,totalTeamNum:s}},[d,a,v,h,l,y]),D=ge(),{numShow:k,setTriggerElement:I}=ye(je[D],f.length),M=o.useMemo(()=>f.slice(0,k),[f,k]),J=f.length!==x?`${f.length}/${x}`:`${x}`,U={numShowing:M.length,total:J,t:i,namespace:"page_teams"},q={sortKeys:[...ue],value:l,onChange:s=>a.displayTeam.set({sortType:s}),ascending:y,onChangeAsc:s=>a.displayTeam.set({ascending:s})};return C(N,{my:1,display:"flex",flexDirection:"column",gap:1,children:[e(L,{children:C(B,{sx:{display:"flex",flexDirection:"column",gap:1},children:[C(N,{display:"flex",gap:1,alignItems:"stretch",children:[e(Ne,{teamIds:f,charKeys:v,setCharKey:s=>a.displayTeam.set({charKeys:s}),acProps:{sx:{flexGrow:1}}}),e(O,{autoFocus:!0,value:K,onChange:s=>r(s.target.value),label:"Team Name",sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}})]}),e(N,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(Ce,{showingTextProps:U,sortByButtonProps:q})})]})}),C(N,{sx:{display:"flex",gap:1},children:[e(E,{fullWidth:!0,onClick:p,color:"info",startIcon:e(xe,{}),children:"Add Team"}),e(me,{open:m,onClose:S,children:C(L,{children:[e(ke,{title:"Import Team"}),e(ie,{}),C(B,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(ce,{children:"Import a team in JSON form below."}),e(O,{fullWidth:!0,label:"JSON Data",placeholder:"Paste your Team JSON here",value:b,onChange:s=>n(s.target.value),multiline:!0,rows:4}),e(E,{startIcon:e(P,{}),disabled:!b,onClick:t,children:"Import"})]})]})}),e(E,{fullWidth:!0,onClick:T,color:"info",startIcon:e(P,{}),children:"Import Team"})]}),e(o.Suspense,{fallback:e(_,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(A,{container:!0,spacing:1,columns:Pe,children:M.map(s=>e(A,{item:!0,xs:1,children:e(o.Suspense,{fallback:e(_,{variant:"rectangular",width:"100%",height:150}),children:e(ve,{teamId:s,bgt:"light",onClick:w=>g(`${s}${w?`/${w}`:""}`),hoverCard:!0})})},s))})}),f.length!==M.length&&e(_,{ref:s=>{s&&I(s)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{ea as default};
