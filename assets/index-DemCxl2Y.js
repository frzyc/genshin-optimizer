import{t as ee,v as te,w as ne,g as ie,r as C,e as t,h as b,d as e,G as i,W,X as L,T as s,aQ as I,ai as M,M as B,N as S,aR as X,aS as q,aT as F,aU as z,f as y,aV as N,ax as re,aW as le,az as se,a as Q,a7 as p,aX as K,aY as ae,a6 as O,aZ as ce,a_ as oe,a$ as de,b0 as he,a8 as $,ab as ue}from"./index-XMBOmH0H.js";import{R as j,A as me}from"./AccessTimeFilled-DCNNbZ9i.js";var A={},J;function pe(){if(J)return A;J=1;var r=ee();Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;var n=r(te()),u=ne(),h=(0,n.default)((0,u.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");return A.default=h,A}var xe=pe();const fe=ie(xe),Z={advice:{name:"Wanderer's Advice",exp:1e3,cost:200,img:L.exp_books.advice},experience:{name:"Adventurer's Experience",exp:5e3,cost:1e3,img:L.exp_books.experience},wit:{name:"Hero's Wit",exp:2e4,cost:4e3,img:L.exp_books.wit}},D=[0,1e3,1325,1700,2150,2625,3150,3725,4350,5e3,5700,6450,7225,8050,8925,9825,10750,11725,12725,13775,14875,16800,18e3,19250,20550,21875,23250,24650,26100,27575,29100,30650,32250,33875,35550,37250,38975,40750,42575,44425,46300,50625,52700,54775,56900,59075,61275,63525,65800,68125,70475,76500,79050,81650,84275,86950,89650,92400,95175,98e3,100875,108950,112050,115175,118325,121525,124775,128075,131400,134775,138175,148700,152375,156075,159825,163600,167425,171300,175225,179175,183175,216225,243025,273100,306800,344600,386950,434425,487625,547200],ge=[20,40,50,60,70,80,90];function be(){return{mora:0,level:1,curExp:0,goUnder:!1,books:{advice:0,experience:0,wit:0}}}function Ce(){const[r,n]=C.useState(()=>be()),{mora:u,level:h,curExp:c,goUnder:a,books:o,books:{advice:x,experience:f,wit:m}}=r,g=ge.find(d=>d>h);let l=-c;for(let d=h;d<Math.min(g,D.length);d++)l+=D[d];const T=ye(m,f,x,l,a)||[],[v=0,E=0,_=0]=T,H={advice:_,experience:E,wit:v},G=v*2e4+E*5e3+_*1e3,Y=G/5,V=l-G,U=u-Y;let k=G+c,w=h;for(;w<Math.min(g,D.length)&&D[w]<=k;w++)k-=D[w];w===g&&(k=0);let R="";return U<0?R=t("span",{children:["You don't have enough ",e("b",{children:"Mora"})," for this operation."]}):T.length===0?R=t("span",{children:["You don't have enough ",e("b",{children:"EXP. books"})," to level to the next milestone."]}):h===90&&(R="You are at the maximum level."),t(b,{children:[t(i,{container:!0,sx:{px:2,py:1},spacing:2,children:[e(i,{item:!0,children:e(W,{src:Z.wit.img,size:2})}),e(i,{item:!0,flexGrow:1,children:e(s,{variant:"h6",children:"Experience Calculator"})}),e(i,{item:!0,children:t(I,{children:[e(M,{color:"primary",disabled:!a,onClick:()=>n({...r,goUnder:!1}),children:"Full Level"}),e(M,{color:"primary",disabled:a,onClick:()=>n({...r,goUnder:!0}),children:"Don't fully level"})]})})]}),e(B,{}),e(S,{children:t(i,{container:!0,spacing:1,children:[e(i,{item:!0,children:t(s,{children:[t("span",{children:["This calculator tries to calculate the amount of exp books required to get to the next milestone level."," "]}),a?"It will try to get as close to the milestone level as possible, so you can grind the rest of the exp without any waste.":"It will try to calculate the amount of books needed to minimize as much exp loss as possible."]})}),e(i,{item:!0,xs:6,md:3,children:t(I,{sx:{display:"flex"},children:[e(X,{children:"Current Level"}),e(q,{sx:{flexBasis:30,flexGrow:1},children:e(F,{value:h,onChange:d=>n({...r,level:z(d??0,0,90)}),sx:{px:2}})})]})}),e(i,{item:!0,xs:6,md:3,children:t(I,{sx:{display:"flex"},children:[e(X,{children:"Current EXP."}),e(q,{sx:{flexBasis:30,flexGrow:1},children:e(F,{value:c,onChange:d=>n({...r,curExp:z(d??0,0,(D[h]||1)-1)}),endAdornment:`/${D[h]||0}`,sx:{px:2}})})]})}),e(i,{item:!0,xs:6,md:3,children:e(b,{bgt:"light",children:t(y,{sx:{p:1,display:"flex",justifyContent:"space-between"},children:[e(s,{children:"Next Milestone Level:"}),e(s,{children:e("b",{children:g})})]})})}),e(i,{item:!0,xs:6,md:3,children:e(b,{bgt:"light",children:t(y,{sx:{p:1,display:"flex",justifyContent:"space-between"},children:[e(s,{children:"EXP. to milestone:"}),e(s,{children:t("span",{children:[e("strong",{children:G})," / ",e("strong",{children:l})]})})]})})}),Object.entries(o).map(([d])=>e(i,{item:!0,xs:12,md:4,children:e(ve,{bookKey:d,value:o[d],setValue:P=>n({...r,books:{...o,[d]:P}}),required:H[d]})},d)),e(i,{item:!0,xs:12,md:4,children:t(I,{sx:{display:"flex"},children:[e(X,{children:"Current Mora"}),e(q,{sx:{flexBasis:30,flexGrow:1},children:e(F,{value:u,onChange:d=>n({...r,mora:Math.max(d??0,0)}),sx:{px:2}})})]})}),e(i,{item:!0,xs:12,md:4,children:e(b,{bgt:"light",children:t(y,{sx:{p:1,display:"flex",justifyContent:"space-between"},children:[e(s,{children:"Mora Cost: "}),e(s,{children:e("b",{children:Y})})]})})}),e(i,{item:!0,xs:12,md:4,children:e(b,{bgt:"light",children:t(y,{sx:{p:1,display:"flex",justifyContent:"space-between"},children:[t(s,{children:["EXP ",a?"Diff":"Waste",": "]}),e(s,{children:e("b",{children:e(N,{color:V<0?"error":"success",children:V})})})]})})}),e(i,{item:!0,xs:12,md:4,children:e(b,{bgt:"light",children:t(y,{sx:{p:1,display:"flex",justifyContent:"space-between"},children:[e(s,{children:"Final Mora: "}),e(s,{children:e("b",{children:e(N,{color:U<0?"error":"success",children:U})})})]})})}),e(i,{item:!0,xs:12,md:4,children:e(b,{bgt:"light",children:t(y,{sx:{p:1,display:"flex",justifyContent:"space-between"},children:[e(s,{children:"Final Level: "}),e(s,{children:e("b",{children:e(N,{color:"success",children:w})})})]})})}),e(i,{item:!0,xs:12,md:4,children:e(b,{bgt:"light",children:t(y,{sx:{p:1,display:"flex",justifyContent:"space-between"},children:[e(s,{children:"Final EXP: "}),e(s,{children:e("b",{children:e(N,{color:k<0?"error":"success",children:k})})})]})})})]})}),e(B,{}),e(S,{sx:{py:1},children:t(i,{container:!0,spacing:2,children:[e(i,{item:!0,flexGrow:1,children:!!R&&e(re,{variant:"filled",severity:"error",children:R})}),e(i,{item:!0,xs:"auto",children:e(M,{disabled:!!R,onClick:()=>n({...r,level:w,curExp:k,books:le(H,(d,P)=>o[P]-d),mora:U}),color:"success",startIcon:e(fe,{}),sx:{height:"100%"},children:"Apply"})})]})})]})}function ve(r){const{bookKey:n,value:u=0,setValue:h,required:c=0}=r;return t(b,{bgt:"light",children:[e(S,{sx:{py:1},children:e(s,{children:Z[n].name})}),e(B,{}),e(S,{children:t(i,{container:!0,children:[e(i,{item:!0,xs:3,children:e(se,{src:Z[n].img})}),t(i,{item:!0,xs:9,children:[t(I,{sx:{display:"flex"},children:[e(X,{children:"Amount"}),e(q,{sx:{flexBasis:30,flexGrow:1},children:e(F,{value:u,onChange:a=>h(Math.max(a??0,0)),sx:{px:2}})})]}),t(y,{display:"flex",justifyContent:"space-between",mt:1,children:[e(s,{children:"Required:"}),e(s,{children:e("b",{children:e(N,{color:c?"success":void 0,children:c})})})]})]})]})})]})}function ye(r,n,u,h,c){let a=c?Math.floor(h/1e3):Math.ceil(h/1e3);const o=Math.min(Math.floor(a/20),r);a-=o*20;const x=Math.min(Math.floor(a/5),n);a-=x*5;const f=Math.min(a,u);return a-=f,c||a===0?[o,x,f]:x===3&&o!==r?[o+1,0,0]:x!==n?[o,x+1,0]:o!==r?[o+1,0,0]:null}const Te=[0,-1,-10,-20,-30,-40,-60,1,60,p];function we(){const r=Q(),[{resin:n,resinDate:u},h]=C.useState(()=>r.displayTool.get());C.useEffect(()=>r.displayTool.follow((l,T)=>h(T)),[r]);const c=C.useRef(void 0),a=l=>{l>=p?(c.current&&clearTimeout(c.current),c.current=void 0):c.current=setTimeout(()=>console.log("set resin",l+1),j),r.displayTool.set({resin:l,resinDate:new Date().getTime()})};C.useEffect(()=>{if(n<p){const l=Date.now(),T=p-n,v=Math.min(Math.floor((l-u)/j),T),E=n+v,_=u+v*j;r.displayTool.set({resin:E,resinDate:_}),E<p&&(c.current=setTimeout(()=>a(E+1),l-_))}return()=>c.current&&clearTimeout(c.current)},[]);const o=n>=p?u:u+j,x=n>=p?u:u+(p-n)*j,f=new Date(x),m=K(Math.abs(o-Date.now())),g=l=>{const v=parseInt(l);v>=0&&v<=2e3&&a(v)};return t(b,{children:[t(i,{container:!0,sx:{px:2,py:1},spacing:2,children:[e(i,{item:!0,children:e(W,{src:L.resin.fragile,size:2})}),e(i,{item:!0,children:e(s,{variant:"h6",children:"Resin Counter"})})]}),e(B,{}),e(S,{children:t(i,{container:!0,spacing:2,children:[e(i,{item:!0,children:t(s,{variant:"h2",children:[e(W,{src:L.resin.fragile}),e(ae,{type:"number",sx:{width:"2.5em",fontSize:"4rem"},value:n,inputProps:{min:0,max:999,sx:{textAlign:"right"}},onChange:l=>g(l.target.value)}),t("span",{children:["/",p]})]})}),t(i,{item:!0,flexGrow:1,children:[e(I,{fullWidth:!0,children:Te.map(l=>l===0?e(M,{onClick:()=>a(l),disabled:n===0,children:l}):l===p?t(M,{onClick:()=>a(p),disabled:n>=p,children:["MAX ",l]}):l>0?t(M,{onClick:()=>a(n+l),disabled:n>=p,children:["+",l]}):e(M,{onClick:()=>a(n+l),disabled:n<Math.abs(l),children:l}))}),e(s,{variant:"subtitle1",sx:{mt:2},children:n<p?t("span",{children:["Next resin in ",m,", full Resin at"," ",f.toLocaleTimeString()," ",f.toLocaleDateString()]}):t("span",{children:["Resin has been full for at least ",m,", since"," ",f.toLocaleTimeString()," ",f.toLocaleDateString()]})})]}),e(i,{item:!0,xs:12,children:e(s,{variant:"caption",children:"Because we do not provide a mechanism to synchronize resin time, actual resin recharge time might be as much as 8 minutes earlier than predicted."})})]})})]})}function De(){const r=Q(),[{timeZoneKey:n},u]=C.useState(()=>r.displayTool.get());C.useEffect(()=>r.displayTool.follow((m,g)=>u(g)),[r]);const h=C.useCallback(m=>r.displayTool.set({timeZoneKey:m}),[r]),[c,a]=C.useState(new Date(Date.now()+O[n]));C.useEffect(()=>{const m=()=>(a(new Date(Date.now()+O[n])),setTimeout(()=>{g=m()},$-Date.now()%$));let g=m();return()=>clearTimeout(g)},[n]);let o=new Date(c);o.getUTCHours()<4||(o=new Date(o.getTime()+ce)),o.setUTCHours(4,0,0,0);const x=o.getTime()-c.getTime(),f=K(x);return t(b,{children:[t(S,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(me,{}),e(s,{variant:"h6",sx:{flexGrow:1},children:"Teyvat Time"}),e(oe,{title:n,children:Object.keys(O).map(m=>e(de,{selected:n===m,disabled:n===m,onClick:()=>h(m),children:m},m))})]}),e(B,{}),e(S,{children:t(i,{container:!0,justifyContent:"center",spacing:3,children:[e(i,{item:!0,sx:{my:4},children:e(s,{variant:"h2",children:c.toLocaleTimeString([],{timeZone:"UTC"})})}),t(i,{item:!0,display:"flex",flexDirection:"column",justifyContent:"space-around",children:[t(s,{children:["Server Date: ",e("b",{children:c.toDateString()})]}),t(s,{children:["Time until reset: ",e("b",{children:f})]}),t(s,{children:["Resin until reset:"," ",e("b",{children:Math.floor(x/(8*he))})]})]})]})})]})}function Ee(){return ue.send({hitType:"pageview",page:"/tools"}),t(y,{display:"flex",flexDirection:"column",gap:1,children:[e(De,{}),e(we,{}),e(Ce,{})]})}export{Ee as default};
