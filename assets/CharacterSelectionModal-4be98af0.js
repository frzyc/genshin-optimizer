import{u as X,e as o,a9 as A,b as N,d as j,X as q,dO as M,h as J,f as Q,p as e,n as l,C as W,K as r,D as R,J as F,t as Y,V as Z,at as H,v as ee,dN as te,Q as ae,aA as se,T as x,c4 as oe,s as ne}from"./index-94c37da5.js";import{f as re,s as le,T as ie,l as ce,F as de,c as pe}from"./StarDisplay-4aa86735.js";import{g as b,X as me}from"./index-581f9494.js";import{c as G,E as he,o as ue,k as fe,a as xe,l as ye,p as ge,b as Ce,e as ve}from"./CharacterSort-5f5db85b.js";import{C as Te}from"./CloseButton-f7ad2d98.js";import{S as I}from"./SqBadge-28fa9002.js";import{W as we}from"./WeaponUtil-8a7b29e7.js";import{D as be}from"./FieldDisplay-ac1a92e2.js";import{c as z}from"./totalUtils-c6f82a1a.js";import{C as De}from"./CardActionArea-ea9fd492.js";import"./DropdownButton-7ced2b07.js";import"./ColoredText-5a5b0be5.js";import"./index-312c1899.js";import"./index-3c5f49c3.js";import"./Artifact-66c9ac2f.js";import"./Help-175da644.js";import"./SlotIcon-214f7314.js";import"./Groups-f30c483b.js";const Se=Object.keys(G);function Xe({show:n,onHide:c,onSelect:d,filter:s=()=>!0,newFirst:m=!1}){const{t:y}=X(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:h}=o.useContext(A),a=N(),[g,C]=o.useState(()=>a.displayCharacter.get());o.useEffect(()=>a.displayCharacter.follow((t,i)=>C(i)),[a,C]);const{gender:u}=j(),[D,v]=q();o.useEffect(()=>a.charMeta.followAny(()=>v()),[v,a]);const[T,w]=o.useState(""),S=o.useDeferredValue(T),B=o.useDeferredValue(g),k=o.useDeferredValue(D),f=o.useMemo(()=>{const{element:t,weaponType:i,sortType:p,ascending:K}=B,U=[...m?["new"]:[],...G[p]??[]];return k&&M.filter(E=>s(a.chars.get(E),b(E,u))).filter(re({element:t,weaponType:i,name:S},Ce(a,h))).sort(le(U,K,ve(a,h),["new","favorite"]))},[B,m,k,S,a,h,s,u]),L=o.useMemo(()=>z(J,t=>M.forEach(i=>{const p=b(i,a.gender).weaponTypeKey;t[p].total++,f.includes(i)&&t[p].current++})),[f,a]),V=o.useMemo(()=>z(Q,t=>M.forEach(i=>{const p=b(i,a.gender).elementKey;t[p].total++,f.includes(i)&&t[p].current++})),[f,a]),{weaponType:_,element:O,sortType:P,ascending:$}=g;return e(Z,{open:n,onClose:c,sx:{"& .MuiContainer-root":{justifyContent:"normal"}},children:l(Y,{children:[l(W,{sx:{py:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e(we,{sx:{height:"100%"},onChange:t=>a.displayCharacter.set({weaponType:t}),value:_,totals:L,size:"small"}),e(he,{sx:{height:"100%"},onChange:t=>a.displayCharacter.set({element:t}),value:O,totals:V,size:"small"}),e(r,{flexGrow:1,children:e(ie,{autoFocus:!0,value:T,onChange:t=>w(t.target.value),label:y("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})}),e(ce,{sx:{height:"100%"},sortKeys:Se,value:P,onChange:t=>a.displayCharacter.set({sortType:t}),ascending:$,onChangeAsc:t=>a.displayCharacter.set({ascending:t})}),e(Te,{onClick:c})]}),e(R,{}),e(be.Provider,{value:{teamData:void 0},children:e(W,{children:e(F,{container:!0,spacing:1,columns:{xs:2,sm:3,md:4,lg:5},children:f.map(t=>e(F,{item:!0,xs:1,children:e(Be,{characterKey:t,onClick:()=>{c(),d==null||d(t)}})},t))})})})]})})}const Me=H(({className:n,...c})=>e(ee,{...c,classes:{popper:n}}))({[`& .${te.tooltip}`]:{padding:0}});function Be({characterKey:n,onClick:c}){const{gender:d}=j(),s=b(n,d),m=ue(n),{favorite:y}=fe(n),h=N(),{silly:a}=o.useContext(A),[g,C,u]=ae(),{level:D=1,ascension:v=0,constellation:T=0}=m??{},w=me(n,"banner",d);return e(Me,{enterDelay:300,enterNextDelay:300,arrow:!0,placement:"bottom",open:g,onClose:u,onOpen:C,title:e(r,{sx:{width:300},children:e(xe,{hideStats:!0,characterKey:n})}),children:e(r,{children:l(ne,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e(r,{sx:{position:"absolute",opacity:.7,zIndex:2},children:e(se,{sx:{p:.25},onClick:S=>{u(),h.charMeta.set(n,{favorite:!y})},children:y?e(de,{}):e(ye,{})})}),e(De,{onClick:c,children:l(r,{display:"flex",position:"relative",className:w?void 0:`grad-${s==null?void 0:s.rarity}star`,sx:{"&::before":{content:'""',display:"block",position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:.7,backgroundImage:`url(${w})`,backgroundPosition:"center",backgroundSize:"cover"}},width:"100%",children:[e(r,{flexShrink:1,sx:{maxWidth:{xs:"33%",lg:"30%"}},alignSelf:"flex-end",display:"flex",flexDirection:"column",zIndex:1,children:e(r,{component:"img",src:ge(n,d,a),width:"100%",height:"auto",maxWidth:256,sx:{mt:"auto"}})}),l(r,{flexGrow:1,sx:{pr:1,pt:1},display:"flex",flexDirection:"column",zIndex:1,justifyContent:"space-evenly",children:[e(x,{variant:"body2",sx:{flexGrow:1},children:e(I,{color:s==null?void 0:s.elementKey,sx:{opacity:.85,textShadow:"0 0 5px gray"},children:s==null?void 0:s.name})}),m?l(r,{sx:{display:"flex",gap:1,alignItems:"center"},children:[l(r,{sx:{textShadow:"0 0 5px gray"},children:[l(x,{variant:"body2",component:"span",whiteSpace:"nowrap",children:["Lv. ",D]}),l(x,{variant:"body2",component:"span",color:"text.secondary",children:["/",oe[v]]})]}),l(x,{variant:"body2",children:["C",T]})]}):e(x,{component:"span",variant:"body2",children:e(I,{children:"NEW"})}),e(pe,{stars:(s==null?void 0:s.rarity)??1,colored:!0})]})]})})]})})})}export{Xe as default};
