import{x as j,r as o,b3 as J,a as U,bN as R,d as e,bP as X,cn as Y,aw as O,bb as Z,Q as q,b as ee,cX as te,S as K,cY as N,y as ae,cZ as se,c_ as re,ah as oe,bF as ne,aK as le,aL as ce,aG as ie,aM as me,e as S,N as $,f as M,bp as P,aO as he,c$ as ue,h as A,aP as de,aj as L,L as pe,M as fe,T as ge,ao as ye,G as W}from"./index-CnkQijoq.js";import{T as Te}from"./TeamCard-CwS3HLpQ.js";import{U as G}from"./Upload-Cv16yVnE.js";import"./useTeamChar-DpT2BQqo.js";import"./TeamDelModal-sBLlnS-h.js";function Ce({teamIds:s,charKeys:r,setCharKey:m,acProps:c}){const{t:h}=j(["page_team","sillyWisher_charNames","charNames_gen"]),{silly:u}=o.useContext(J),l=U(),{gender:p}=R(),d=o.useCallback(t=>l.charMeta.get(t).favorite,[l.charMeta]),E=o.useCallback(t=>e(X,{characterKey:t}),[]),T=o.useCallback((t,n)=>h(`${n?"sillyWisher_charNames":"charNames_gen"}:${Y(t,p)}`),[p,h]),x=ee,[F,I]=O();o.useEffect(()=>l.chars.followAny((t,n)=>["new","remove"].includes(n)&&I()),[l.chars,I]);const f=o.useMemo(()=>F&&l.chars.keys,[l,F]),{characterTeamTotal:g}=o.useMemo(()=>Z({characterTeamTotal:f},n=>{l.teams.values.forEach(C=>{const{loadoutData:b}=C;b.filter(N).forEach(({teamCharId:w})=>{const v=l.teamChars.get(w);if(!v)return;const y=v.key;n.characterTeamTotal[y].total++})}),s.forEach(C=>{const b=l.teams.get(C);if(!b)return;const{loadoutData:w}=b;w.filter(N).forEach(({teamCharId:v})=>{const y=l.teamChars.get(v);if(!y)return;const B=y.key;n.characterTeamTotal[B].current++})})}),[l,f,s]),k=o.useCallback(t=>e("strong",{children:g[t]}),[g]),D=o.useCallback(t=>e(q,{size:"small",label:g[t]}),[g]),_=o.useMemo(()=>f.map(t=>({key:t,label:T(t,u),alternateNames:u?[T(t,!u)]:void 0,favorite:d(t),color:x(t)})).sort((t,n)=>t.favorite&&!n.favorite?-1:!t.favorite&&n.favorite?1:t.label.localeCompare(n.label)),[u,T,x,d,f]);return e(o.Suspense,{fallback:e(K,{variant:"text",width:100}),children:e(te,{label:h("searchLabel.char"),options:_,toImg:E,valueKeys:r,onChange:t=>m(t),toExLabel:k,toExItemLabel:D,chipProps:{variant:"outlined"},...c})})}function xe(){return{name:s=>s.name??"",lastEdit:s=>s.lastEdit??0}}const be={name:["name","lastEdit"],lastEdit:["lastEdit"]};function we(s){return{charKeys:(r,m)=>{var l;if(!m.length)return!0;const c=(l=s.teams.get(r))==null?void 0:l.loadoutData.filter(N),h=c==null?void 0:c.map(({teamCharId:p})=>{var d;return(d=s.teamChars.get(p))==null?void 0:d.key}).filter(N);return m.every(p=>h==null?void 0:h.includes(p))},name:(r,m)=>{var c;return!m||!!((c=s.teams.get(r))!=null&&c.name.toLowerCase().includes(m.toLowerCase()))}}}const ve={xs:1,sm:2,md:2,lg:3,xl:3},Se={xs:6,sm:12,md:18,lg:24,xl:24};function Me(){const{t:s}=j(["page_team","page_teams","sillyWisher_charNames","charNames_gen"]),r=U(),[m,c]=O(),h=ae(),u=se();o.useEffect(()=>r.teams.followAny((a,i)=>(i==="new"||i==="remove"||i==="update")&&c()),[c,r]),re();const l=()=>{const a=r.teams.new();h(a)},[p,d,E]=oe(),[T,x]=o.useState("");o.useEffect(()=>{var a,i;(a=u.state)!=null&&a.openImportModal&&(x((i=u.state)==null?void 0:i.teamData),d())},[u.state,d,x]);const F=()=>{try{const a=JSON.parse(T);r.teams.import(a)||window.alert(s("importForm.error.verifi")),E()}catch(a){window.alert(s("importForm.error.import")+`
${a}`);return}},I=ne(r.displayTeam),{sortType:f,ascending:g,charKeys:k}=I,[D,_]=o.useState(I.searchTerm),t=o.useDeferredValue(D);o.useEffect(()=>{r.displayTeam.set({searchTerm:t})},[r,t]);const{teamIds:n,totalTeamNum:C}=o.useMemo(()=>{const a=r.teams.keys.length,i=r.teams.keys.filter(le({charKeys:k,name:t},we(r))).sort((V,z)=>ce(be[f],g,xe())(r.teams.get(V),r.teams.get(z)));return m&&{teamIds:i,totalTeamNum:a}},[m,r,k,t,f,g]),b=ie(),{numShow:w,setTriggerElement:v}=me(Se[b],n.length),y=o.useMemo(()=>n.slice(0,w),[n,w]),B=n.length!==C?`${n.length}/${C}`:`${C}`,H={numShowing:y.length,total:B,t:s,namespace:"page_teams"},Q={sortKeys:[...ue],value:f,onChange:a=>r.displayTeam.set({sortType:a}),ascending:g,onChangeAsc:a=>r.displayTeam.set({ascending:a})};return S(M,{display:"flex",flexDirection:"column",gap:1,children:[e(A,{children:S($,{sx:{display:"flex",flexDirection:"column",gap:1},children:[S(M,{display:"flex",gap:1,alignItems:"stretch",children:[e(Ce,{teamIds:n,charKeys:k,setCharKey:a=>r.displayTeam.set({charKeys:a}),acProps:{sx:{flexGrow:1}}}),e(P,{autoFocus:!0,value:D,onChange:a=>_(a.target.value),label:s("searchLabel.team"),sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}})]}),e(M,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(he,{showingTextProps:H,sortByButtonProps:Q})})]})}),S(M,{sx:{display:"flex",gap:1},children:[e(L,{fullWidth:!0,onClick:l,color:"info",startIcon:e(de,{}),children:s("addTeamBtn")}),e(ye,{open:p,onClose:E,children:S(A,{children:[e(pe,{title:s("importForm.title")}),e(fe,{}),S($,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(ge,{children:s("importForm.desc")}),e(P,{fullWidth:!0,label:s("importForm.label"),placeholder:s("importForm.placeholder"),value:T,onChange:a=>x(a.target.value),multiline:!0,rows:4}),e(L,{startIcon:e(G,{}),disabled:!T,onClick:F,children:s("importForm.importBtn")})]})]})}),e(L,{fullWidth:!0,onClick:d,color:"info",startIcon:e(G,{}),children:s("importTeamBtn")})]}),e(o.Suspense,{fallback:e(K,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(W,{container:!0,spacing:2,columns:ve,children:y.map(a=>e(W,{item:!0,xs:1,children:e(o.Suspense,{fallback:e(K,{variant:"rectangular",width:"100%",height:150}),children:e(Te,{teamId:a,bgt:"light",onClick:i=>h(`${a}${i?`/${i}`:""}`)})})},a))})}),n.length!==y.length&&e(K,{ref:a=>{a&&v(a)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Me as default};
