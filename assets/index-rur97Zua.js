import{x as j,r as o,a_ as z,a as U,bI as R,d as e,bK as X,cj as q,ar as H,b6 as Y,Q as Z,b as ee,cT as ae,S as M,cU as N,y as te,cV as se,cW as re,ac as oe,bA as ne,aF as le,aG as ce,aB as ie,aH as me,e as S,N as L,f as K,bk as W,aJ as he,cX as ue,h as $,aK as de,ae as A,L as pe,M as fe,T as ge,aj as ye,G}from"./index-D5rENohr.js";import{T as Te}from"./TeamCard-DpDLPu-0.js";import{U as P}from"./Upload-DSGBI_Hs.js";import"./useTeamChar-D_kXtbTM.js";import"./TeamDelModal-Cj7nuamz.js";function Ce({teamIds:s,charKeys:r,setCharKey:m,acProps:c}){const{t:h}=j(["page_team","sillyWisher_charNames","charNames_gen"]),{silly:u}=o.useContext(z),l=U(),{gender:p}=R(),d=o.useCallback(a=>l.charMeta.get(a).favorite,[l.charMeta]),E=o.useCallback(a=>e(X,{characterKey:a}),[]),T=o.useCallback((a,n)=>h(`${n?"sillyWisher_charNames":"charNames_gen"}:${q(a,p)}`),[p,h]),x=ee,[F,I]=H();o.useEffect(()=>l.chars.followAny((a,n)=>["new","remove"].includes(n)&&I()),[l.chars,I]);const f=o.useMemo(()=>F&&l.chars.keys,[l,F]),{characterTeamTotal:g}=o.useMemo(()=>Y({characterTeamTotal:f},n=>{l.teams.values.forEach(C=>{const{loadoutData:b}=C;b.filter(N).forEach(({teamCharId:w})=>{const v=l.teamChars.get(w);if(!v)return;const y=v.key;n.characterTeamTotal[y].total++})}),s.forEach(C=>{const b=l.teams.get(C);if(!b)return;const{loadoutData:w}=b;w.filter(N).forEach(({teamCharId:v})=>{const y=l.teamChars.get(v);if(!y)return;const B=y.key;n.characterTeamTotal[B].current++})})}),[l,f,s]),k=o.useCallback(a=>e("strong",{children:g[a]}),[g]),D=o.useCallback(a=>e(Z,{size:"small",label:g[a]}),[g]),_=o.useMemo(()=>f.map(a=>({key:a,label:T(a,u),alternateNames:u?[T(a,!u)]:void 0,favorite:d(a),color:x(a)})).sort((a,n)=>a.favorite&&!n.favorite?-1:!a.favorite&&n.favorite?1:a.label.localeCompare(n.label)),[u,T,x,d,f]);return e(o.Suspense,{fallback:e(M,{variant:"text",width:100}),children:e(ae,{label:h("searchLabel.char"),options:_,toImg:E,valueKeys:r,onChange:a=>m(a),toExLabel:k,toExItemLabel:D,chipProps:{variant:"outlined"},...c})})}function xe(){return{name:s=>s.name??"",lastEdit:s=>s.lastEdit??0}}const be={name:["name","lastEdit"],lastEdit:["lastEdit"]};function we(s){return{charKeys:(r,m)=>{var l;if(!m.length)return!0;const c=(l=s.teams.get(r))==null?void 0:l.loadoutData.filter(N),h=c==null?void 0:c.map(({teamCharId:p})=>{var d;return(d=s.teamChars.get(p))==null?void 0:d.key}).filter(N);return m.every(p=>h==null?void 0:h.includes(p))},name:(r,m)=>{var c;return!m||!!((c=s.teams.get(r))!=null&&c.name.toLowerCase().includes(m.toLowerCase()))}}}const ve={xs:1,sm:2,md:2,lg:3,xl:3},Se={xs:6,sm:12,md:18,lg:24,xl:24};function Ke(){const{t:s}=j(["page_team","page_teams","sillyWisher_charNames","charNames_gen"]),r=U(),[m,c]=H(),h=te(),u=se();o.useEffect(()=>r.teams.followAny((t,i)=>(i==="new"||i==="remove"||i==="update")&&c()),[c,r]),re();const l=()=>{const t=r.teams.new();h(t)},[p,d,E]=oe(),[T,x]=o.useState("");o.useEffect(()=>{var t,i;(t=u.state)!=null&&t.openImportModal&&(x((i=u.state)==null?void 0:i.teamData),d())},[u.state,d,x]);const F=()=>{try{const t=JSON.parse(T);r.teams.import(t)||window.alert(s("importForm.error.verifi")),E()}catch(t){window.alert(s("importForm.error.import")+`
${t}`);return}},I=ne(r.displayTeam),{sortType:f,ascending:g,charKeys:k}=I,[D,_]=o.useState(I.searchTerm),a=o.useDeferredValue(D);o.useEffect(()=>{r.displayTeam.set({searchTerm:a})},[r,a]);const{teamIds:n,totalTeamNum:C}=o.useMemo(()=>{const t=r.teams.keys.length,i=r.teams.keys.filter(le({charKeys:k,name:a},we(r))).sort((J,Q)=>ce(be[f],g,xe())(r.teams.get(J),r.teams.get(Q)));return m&&{teamIds:i,totalTeamNum:t}},[m,r,k,a,f,g]),b=ie(),{numShow:w,setTriggerElement:v}=me(Se[b],n.length),y=o.useMemo(()=>n.slice(0,w),[n,w]),B=n.length!==C?`${n.length}/${C}`:`${C}`,O={numShowing:y.length,total:B,t:s,namespace:"page_teams"},V={sortKeys:[...ue],value:f,onChange:t=>r.displayTeam.set({sortType:t}),ascending:g,onChangeAsc:t=>r.displayTeam.set({ascending:t})};return S(K,{display:"flex",flexDirection:"column",gap:1,children:[e($,{children:S(L,{sx:{display:"flex",flexDirection:"column",gap:1},children:[S(K,{display:"flex",gap:1,alignItems:"stretch",children:[e(Ce,{teamIds:n,charKeys:k,setCharKey:t=>r.displayTeam.set({charKeys:t}),acProps:{sx:{flexGrow:1}}}),e(W,{autoFocus:!0,value:D,onChange:t=>_(t.target.value),label:s("searchLabel.team"),sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}})]}),e(K,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(he,{showingTextProps:O,sortByButtonProps:V})})]})}),S(K,{sx:{display:"flex",gap:1},children:[e(A,{fullWidth:!0,onClick:l,color:"info",startIcon:e(de,{}),children:s("addTeamBtn")}),e(ye,{open:p,onClose:E,children:S($,{children:[e(pe,{title:s("importForm.title")}),e(fe,{}),S(L,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(ge,{children:s("importForm.desc")}),e(W,{fullWidth:!0,label:s("importForm.label"),placeholder:s("importForm.placeholder"),value:T,onChange:t=>x(t.target.value),multiline:!0,rows:4}),e(A,{startIcon:e(P,{}),disabled:!T,onClick:F,children:s("importForm.importBtn")})]})]})}),e(A,{fullWidth:!0,onClick:d,color:"info",startIcon:e(P,{}),children:s("importTeamBtn")})]}),e(o.Suspense,{fallback:e(M,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(G,{container:!0,spacing:2,columns:ve,children:y.map(t=>e(G,{item:!0,xs:1,children:e(o.Suspense,{fallback:e(M,{variant:"rectangular",width:"100%",height:150}),children:e(Te,{teamId:t,bgt:"light",onClick:i=>h(`${t}${i?`/${i}`:""}`)})})},t))})}),n.length!==y.length&&e(M,{ref:t=>{t&&v(t)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Ke as default};
