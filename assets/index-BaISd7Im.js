import{x as R,a as U,r as a,b9 as G,ba as ce,bb as ie,d as e,e as l,G as h,T as P,aj as T,ad as b,aq as re,f as M,az as A,M as H,bc as O,bd as pe,be as de,bf as ue,bg as he,au as J,av as X,Q as j,bh as me,bi as ge,bj as ye,B as fe,bk as we,N as Y,h as Z,as as $,at as ke,F as Q,E as We,bl as be,aw as xe,ab as Te,aG as Se,bm as Ce,aK as Ie,aL as ve,aM as qe,bn as Ee,bo as De,bp as Ke,aO as Be,aP as Fe,bq as Me,S as V,br as Le,bs as Ne,bt as ee}from"./index-CnkQijoq.js";const oe=["locked","unlocked"],ze=me([...oe]);function Ae({numShowing:u,total:o,weaponIds:i}){const{t:p}=R(["page_weapon","ui"]),t=U(),[f,v]=a.useState(t.displayWeapon.get());a.useEffect(()=>{t.displayWeapon.follow((s,r)=>v(r))},[t]);const{weaponType:q,rarity:K,locked:d,showEquipped:c,showInventory:S,locations:E}=f,w=a.useMemo(()=>G(We,s=>t.weapons.entries.forEach(([r,W])=>{const g=Q(W.key).weaponType;s[g].total++,i.includes(r)&&s[g].current++})),[t,i]),k=a.useMemo(()=>G(be,s=>t.weapons.entries.forEach(([r,W])=>{const g=Q(W.key).rarity;s[g].total++,i.includes(r)&&s[g].current++})),[t,i]),{lockedTotal:D,equippedTotal:C,locationTotal:B}=a.useMemo(()=>{const s={lockedTotal:["locked","unlocked"],equippedTotal:["equipped","unequipped"],locationTotal:[...ce,""]};return ie(s,r=>t.weapons.entries.forEach(([W,g])=>{const I=g.location,m=g.lock?"locked":"unlocked",x=I?"equipped":"unequipped";r.lockedTotal[m].total++,r.equippedTotal[x].total++,r.locationTotal[I].total++,i.includes(W)&&(r.lockedTotal[m].current++,r.equippedTotal[x].current++,r.locationTotal[I].current++)}))},[t,i]);return e(Z,{children:l(Y,{sx:{display:"flex",flexDirection:"column",gap:1},children:[l(h,{container:!0,children:[e(h,{item:!0,children:e(P,{variant:"h6",children:p("weaponFilterTitle")})}),e(h,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:l(P,{children:[e("strong",{children:u})," / ",o]})}),e(h,{item:!0,children:e(T,{size:"small",color:"error",onClick:()=>t.displayWeapon.set({action:"reset"}),startIcon:e(re,{}),children:e(b,{t:p,i18nKey:"ui:reset"})})})]}),e(M,{children:l(h,{container:!0,spacing:1,children:[l(h,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",children:[e(b,{t:p,i18nKey:"subheadings.general"}),l(A,{spacing:1,children:[e(H,{sx:{bgcolor:O.palette.contentNormal.light}}),e(pe,{fullWidth:!0,onChange:s=>t.displayWeapon.set({weaponType:s}),value:q,totals:w,size:"small"}),e(de,{sx:{height:"100%"},fullWidth:!0,onChange:s=>t.displayWeapon.set({rarity:s}),value:K,totals:k,size:"small"})]})]}),e(h,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",gap:1,children:l(M,{children:[e(b,{t:p,i18nKey:"subheadings.inventory"}),l(A,{spacing:1,children:[e(H,{sx:{bgcolor:O.palette.contentNormal.light}}),e(ue,{fullWidth:!0,value:d,size:"small",children:oe.map((s,r)=>l(he,{value:s,sx:{display:"flex",gap:1},onClick:()=>t.displayWeapon.set({locked:ze(d,s)}),children:[r?e(J,{}):e(X,{}),e(b,{t:p,i18nKey:`ui:${s}`}),e(j,{label:D[r?"unlocked":"locked"],size:"small"})]},s))}),l(T,{startIcon:e(ge,{}),color:S?"success":"secondary",onClick:()=>t.displayWeapon.set({showInventory:!S}),children:[p("weaponInInv")," ",e(j,{sx:{ml:1},label:C.unequipped,size:"small"})]}),l(T,{startIcon:e(ye,{}),color:c?"success":"secondary",onClick:()=>t.displayWeapon.set({showEquipped:!c}),children:[p("equippedWeapon")," ",e(j,{sx:{ml:1},label:C.equipped,size:"small"})]})]}),e(A,{spacing:1.5,pt:1.5,children:e(a.Suspense,{fallback:null,children:e(fe,{title:c?p("locationsTooltip"):"",placement:"top",children:e("span",{children:e(we,{totals:B,locations:c?[]:E,setLocations:s=>t.displayWeapon.set({locations:s}),disabled:c})})})})})]})})]})})]})})}function je({weaponIds:u}){const{t:o}=R(["page_weapon","ui"]),i=U(),{numDelete:p,numUnlock:t,numLock:f}=a.useMemo(()=>{const d=u.map(w=>i.weapons.get(w)),c=d.reduce((w,k)=>w+(k.lock?0:1),0),S=d.length-c;return{numDelete:d.reduce((w,k)=>w+(k.lock||k.location?0:1),0),numUnlock:c,numLock:S}},[u,i]);return l(h,{container:!0,spacing:1,alignItems:"center",children:[e(h,{item:!0,xs:16,sm:8,md:4,children:l(T,{fullWidth:!0,color:"error",disabled:!p,onClick:()=>window.confirm(`Are you sure you want to delete ${p} weapons?`)&&u.map(d=>{const c=i.weapons.get(d);!(c!=null&&c.lock)&&!(c!=null&&c.location)&&i.weapons.remove(d)}),startIcon:e(ke,{}),children:[e(b,{t:o,i18nKey:"button.deleteWeapons",children:"Delete Weapons"}),e($,{sx:{ml:1},color:p?"success":"secondary",children:p})]})}),e(h,{item:!0,xs:16,sm:8,md:4,children:l(T,{fullWidth:!0,color:"error",disabled:!f,onClick:()=>window.confirm(`Are you sure you want to unlock ${f} weapons ?`)&&u.map(d=>i.weapons.set(d,{lock:!1})),startIcon:e(J,{}),children:[e(b,{t:o,i18nKey:"button.unlockWeapons",children:"Unlock Weapons"}),e($,{sx:{ml:1},color:f?"success":"secondary",children:f})]})}),e(h,{item:!0,xs:16,sm:8,md:4,children:l(T,{fullWidth:!0,color:"error",disabled:!t,onClick:()=>window.confirm(`Are you sure you want to lock ${t} weapons ?`)&&u.map(d=>i.weapons.set(d,{lock:!0})),startIcon:e(X,{}),children:[e(b,{t:o,i18nKey:"button.lockWeapons",children:"Lock Weapons"}),e($,{sx:{ml:1},color:t?"success":"secondary",children:t})]})}),e(h,{item:!0,xs:12,display:"flex",justifyContent:"space-around",children:e(P,{variant:"caption",color:"text.secondary",children:l(b,{t:o,i18nKey:"buttonHint",children:["Note: the red buttons above only apply to",e("b",{children:"currently filtered weapons"})]})})})]})}const $e={xs:1,sm:2,md:3,lg:3,xl:4},Pe={xs:10,sm:12,md:24,lg:24,xl:24},Re=Object.keys(ee);function _e(){const{t:u}=R(["page_weapon","ui","weaponNames_gen"]),o=U(),[i,p]=a.useState(o.displayWeapon.get());a.useEffect(()=>o.displayWeapon.follow((n,y)=>p(y)),[o]);const[t,f]=a.useState(!1),[v,q]=xe();a.useEffect(()=>(Te.send({hitType:"pageview",page:"/weapon"}),o.weapons.followAny((n,y)=>(y==="new"||y==="remove"||y==="update")&&q())),[q,o]);const K=Se(),d=a.useCallback(async n=>{const y=o.weapons.get(n);if(!y)return;const z=u(`weaponNames_gen:${y.key}`);window.confirm(u("removeWeapon",{value:z}))&&(o.weapons.remove(n),i.editWeaponId===n&&o.displayWeapon.set({editWeaponId:""}))},[i.editWeaponId,o,u]),c=a.useCallback(n=>{o.displayWeapon.set({editWeaponId:n})},[o]),S=a.useCallback(n=>{c(o.weapons.new(Ce(n)))},[o,c]),[E,w]=a.useState(""),k=a.useDeferredValue(E),{sortType:D,ascending:C,weaponType:B,rarity:s,locked:r,showEquipped:W,showInventory:g,locations:I}=i,{weaponIds:m,totalWeaponNum:x}=a.useMemo(()=>{const n=o.weapons.values,y=n.length,z=n.filter(Ie({weaponType:B,rarity:s,name:k,locked:r,showInventory:g,showEquipped:W,locations:I},Le())).sort(ve(ee[D]??[],C,Ne())).map(le=>le.id);return v&&{weaponIds:z,totalWeaponNum:y}},[v,o,D,C,s,B,r,g,W,I,k]),{numShow:_,setTriggerElement:ne}=qe(Pe[K],m.length),L=a.useMemo(()=>m.slice(0,_),[m,_]),te=m.length!==x?`${m.length}/${x}`:`${x}`,N=a.useCallback(()=>o.displayWeapon.set({editWeaponId:""}),[o]),{editWeaponId:F}=i;a.useEffect(()=>{F&&(o.weapons.get(F)||N())},[o,F,N]);const ae={numShowing:L.length,total:te,t:u,namespace:"page_weapon"},se={sortKeys:[...Re],value:D,onChange:n=>o.displayWeapon.set({sortType:n}),ascending:C,onChangeAsc:n=>o.displayWeapon.set({ascending:n})};return l(M,{display:"flex",flexDirection:"column",gap:1,children:[e(a.Suspense,{fallback:!1,children:e(Ee,{show:t,onHide:()=>f(!1),onSelect:S})}),e(a.Suspense,{fallback:!1,children:e(De,{weaponId:F,footer:!0,onClose:N})}),e(Ae,{numShowing:m.length,total:x,weaponIds:m}),e(Z,{children:l(Y,{sx:{display:"flex",flexDirection:"column",gap:1},children:[l(M,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:[e(Ke,{autoFocus:!0,size:"small",value:E,onChange:n=>w(n.target.value),label:u("weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}}),e(Be,{showingTextProps:ae,sortByButtonProps:se})]}),e(je,{weaponIds:m})]})}),l(a.Suspense,{fallback:e(V,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:500}}),children:[e(T,{fullWidth:!0,onClick:()=>f(!0),color:"info",startIcon:e(Fe,{}),children:u("page_weapon:addWeapon")}),e(h,{container:!0,spacing:1,columns:$e,children:L.map(n=>e(h,{item:!0,xs:1,children:e(Me,{weaponId:n,onDelete:d,onEdit:c,canEquip:!0})},n))})]}),m.length!==L.length&&e(V,{ref:n=>{n&&ne(n)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{_e as default};
