import{ar as Jt,as as Qt,dm as Tt,at as _e,aN as Oe,au as Ae,dn as Et,e as _,av as Zt,aw as Xt,j as we,ax as er,ay as tr,p as n,dp as Pt,c as Ot,a0 as ne,dq as Se,o as rr,aq as Ue,dr as nr,cp as sr,k as Qe,bT as Ge,bx as he,ds as or,bJ as ar,n as C,bW as Le,al as ie,by as $e,am as ir,dt as Ie,bI as cr,$ as Ze,an as lr,u as Xe,b$ as ze,b_ as We,D as He,J as N,T as B,N as et,s as $t,bj as dr,cl as ur,du as hr,a1 as fr,a2 as pr,B as re,K as ee,bV as mr,C as be,Y as Dt,t as gr,V as tt,bB as yr,cf as ct,b as br,X as vr,dv as wr,l as Sr,m as Cr,bi as xr,bc as kr,az as ce,U as lt,bw as Lr,bt as Ar,dw as Rr,Z as Tr}from"./index-f2007351.js";import{S as qe,q as Er}from"./index-7e35cb9f.js";import{d as Pr}from"./Help-a8e6b6e8.js";import{P as Mt,k as Ve,l as Or,a as $r,d as Dr,A as dt}from"./StatEditorList-4e01f60c.js";import{R as _t,A as Mr,a as _r,C as Ir}from"./ArtifactRarityDropdown-d6220253.js";import{M as Re,D as rt}from"./DropdownButton-db077e45.js";import{S as ut}from"./SlotIcon-f924d0db.js";import{b as Nr,A as ht}from"./LocationAutocomplete-0c86834e.js";import{C as Ye}from"./CloseButton-efc9a48e.js";import{T as Kr}from"./StarDisplay-3207920d.js";import{B as It,I as jr}from"./ColoredText-b48b47dc.js";import{g as ft}from"./index-3f6aa365.js";import{A as Fr}from"./Artifact-25891d2b.js";import{I as Br}from"./InfoTooltip-65c8c59c.js";import{S as pt}from"./SqBadge-32d06067.js";import{T as Ur}from"./TextButton-f7eac6e8.js";import{S as Gr}from"./sortByRarityAndName-460dee57.js";import{C as zr}from"./CardHeader-08b909d9.js";import"./Link-d8fc6602.js";import"./CardActionArea-5407562f.js";class Wr{constructor(t,r){this.data={},this.init=t,this.deinit=r}async borrow(t,r){this.data[t]||(this.data[t]={value:this.init(t),refCount:0});const s=this.data[t];s.refCount+=1;const i=await r(s.value);return s.refCount-=1,s.refCount||(delete this.data[t],this.deinit(t,s.value)),i}}function Hr(e){return Jt("MuiCircularProgress",e)}Qt("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const qr=["className","color","disableShrink","size","style","thickness","value","variant"];let Ne=e=>e,mt,gt,yt,bt;const ue=44,Vr=Tt(mt||(mt=Ne`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`)),Yr=Tt(gt||(gt=Ne`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`)),Jr=e=>{const{classes:t,variant:r,color:s,disableShrink:i}=e,u={root:["root",r,`color${Oe(s)}`],svg:["svg"],circle:["circle",`circle${Oe(r)}`,i&&"circleDisableShrink"]};return tr(u,Hr,t)},Qr=_e("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],t[`color${Oe(r.color)}`]]}})(({ownerState:e,theme:t})=>Ae({display:"inline-block"},e.variant==="determinate"&&{transition:t.transitions.create("transform")},e.color!=="inherit"&&{color:(t.vars||t).palette[e.color].main}),({ownerState:e})=>e.variant==="indeterminate"&&Et(yt||(yt=Ne`
      animation: ${0} 1.4s linear infinite;
    `),Vr)),Zr=_e("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(e,t)=>t.svg})({display:"block"}),Xr=_e("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.circle,t[`circle${Oe(r.variant)}`],r.disableShrink&&t.circleDisableShrink]}})(({ownerState:e,theme:t})=>Ae({stroke:"currentColor"},e.variant==="determinate"&&{transition:t.transitions.create("stroke-dashoffset")},e.variant==="indeterminate"&&{strokeDasharray:"80px, 200px",strokeDashoffset:0}),({ownerState:e})=>e.variant==="indeterminate"&&!e.disableShrink&&Et(bt||(bt=Ne`
      animation: ${0} 1.4s ease-in-out infinite;
    `),Yr)),en=_.forwardRef(function(t,r){const s=Zt({props:t,name:"MuiCircularProgress"}),{className:i,color:u="primary",disableShrink:a=!1,size:c=40,style:p,thickness:w=3.6,value:k=0,variant:v="indeterminate"}=s,A=Xt(s,qr),P=Ae({},s,{color:u,disableShrink:a,size:c,thickness:w,value:k,variant:v}),o=Jr(P),E={},$={},j={};if(v==="determinate"){const b=2*Math.PI*((ue-w)/2);E.strokeDasharray=b.toFixed(3),j["aria-valuenow"]=Math.round(k),E.strokeDashoffset=`${((100-k)/100*b).toFixed(3)}px`,$.transform="rotate(-90deg)"}return we.jsx(Qr,Ae({className:er(o.root,i),style:Ae({width:c,height:c},$,p),ownerState:P,ref:r,role:"progressbar"},j,A,{children:we.jsx(Zr,{className:o.svg,ownerState:P,viewBox:`${ue/2} ${ue/2} ${ue} ${ue}`,children:we.jsx(Xr,{className:o.circle,style:E,ownerState:P,cx:ue,cy:ue,r:(ue-w)/2,fill:"none",strokeWidth:w})})}))}),tn=en;function rn({setKey:e}){return n(Pt,{ns:"artifactNames_gen",key18:e})}function nn({slotKey:e}){return n(Pt,{ns:"artifact",key18:`slotName.${e}`})}const sn=Ot([we.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),we.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"},"1")],"PhotoCamera"),on=Ot(we.jsx("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update");function le(e,t=10){return Nt(e,t)}function de(e,t=10){return Nt(e,-t)}function Nt(e,t=10){const{r,g:s,b:i,a:u}=e;return{r:ne(r+t,0,255),g:ne(s+t,0,255),b:ne(i+t,0,255),a:u}}function Kt(e,t,r){return Se(e.r,t.r,r.r)&&Se(e.g,t.g,r.g)&&Se(e.b,t.b,r.b)}function fe(e,t){const r=e.width,s=e.height;let{x1:i=0,x2:u=r,y1:a=0,y2:c=s}=t;return i=ne(i,0,r),u=ne(u,0,r),a=ne(a,0,s),c=ne(c,0,s),a>=c&&(console.warn(`trying to crop with y1:${a} y2:${c}, with src height ${s}.`),a=0,c=s),i>=u&&(console.warn(`trying to crop with x1:${i} x2:${u}, with src width ${r}.`),i=0,u=r),e.getContext("2d",{willReadFrequently:!0}).getImageData(i,a,u-i,c-a)}const an=e=>new Promise(t=>{const r=new FileReader;r.onloadend=({target:s})=>t(s.result),r.readAsDataURL(e)}),cn=e=>new Promise(t=>{const r=new Image;r.onload=({target:s})=>t(ln(s)),r.src=e});function ln(e){const t=document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0});return t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height),r.getImageData(0,0,e.width,e.height)}function Y(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t}function me(e,t,r,s=!0){const i=e.width,u=e.height,a=e.getContext("2d");return a.fillStyle=`rgba(${r.r},${r.g},${r.b},${r.a?r.a/255:1})`,s?a.fillRect(t,0,1,u):a.fillRect(0,t,i,1),e}function ge(e,t,r,s=!0){const i=e.getContext("2d");return i&&(i.fillStyle=`rgba(${r.r},${r.g},${r.b},${r.a?r.a/255:1})`,t.forEach((u,a)=>s?i.fillRect(a,0,1,u):i.fillRect(0,a,u,1))),e}function je(e,t,r,s="color"){const i=Uint8ClampedArray.from(e.data),u=s==="bw",a=s==="invert";for(let c=0;c<i.length;c+=4){const p=i[c],w=i[c+1],k=i[c+2];Kt({r:p,g:w,b:k},t,r)?u?i[c]=i[c+1]=i[c+2]=0:a&&(i[c]=255-p,i[c+1]=255-w,i[c+2]=255-k):i[c]=i[c+1]=i[c+2]=255}return new ImageData(i,e.width,e.height)}function Fe(e,t,r,s=!0){const i=e.height,u=e.width,a=e.data;return Array.from({length:s?u:i},(c,p)=>{let w=0;for(let k=0;k<(s?i:u);k++){const v=s?De(p,k,u):De(k,p,u),[A,P,o]=[a[v],a[v+1],a[v+2]];Kt({r:A,g:P,b:o},t,r)&&w++}return w})}function Ce(e,t,r,s=!0,i=[0,1]){const u=e.height,a=e.width,c=e.data,p=s?a:u,[w,k]=i,v=p*w,A=p*k;return Array.from({length:p},(P,o)=>{if(o<v||o>A)return 0;let E=0,$=0;for(let j=0;j<(s?u:a);j++){const b=s?De(o,j,a):De(j,o,a),[U,K,M]=[c[b],c[b+1],c[b+2]];Se(U,t.r,r.r)&&Se(K,t.g,r.g)&&Se(M,t.b,r.b)?$++:($>E&&(E=$),$=0)}return $>E&&(E=$),E})}function De(e,t,r){return t*(r*4)+e*4}function ye(e,t=.7,r=3){const i=Math.max(...e)*t,u=e.length;let a=-r;for(let p=0;p<u;p++){const w=e[p]>i;if(!w)a=-r;else if(w&&a<0)a=p;else if(w&&p-a>r)break}a<0&&(a=0);let c=u-1+r;for(let p=u-1;p>=0;p--){const w=e[p]>i;if(!w)c=u-1+r;else if(w&&c>u-1)c=p;else if(w&&c-p>r)break}return c>u-1&&(c=u-1),[a,c]}const dn={r:145,g:81,b:40},un={r:188,g:104,b:50},hn={r:121,g:67,b:167},fn={r:160,g:86,b:224},pn={r:62,g:96,b:149},mn={r:81,g:127,b:204},Me={r:235,g:228,b:216},vt={r:255,g:231,b:186},Te={r:93,g:178,b:87},wt={r:255,g:137,b:117},Ee={r:255,g:204,b:50},gn={r:131,g:131,b:130},yn={r:74,g:81,b:102},bn={physical:"Physical",anemo:"Anemo",geo:"Geo",electro:"Electro",hydro:"Hydro",pyro:"Pyro",cryo:"Cryo",dendro:"Dendro"},xe={hp:"HP",hp_:"HP",atk:"ATK",atk_:"ATK",def:"DEF",def_:"DEF",eleMas:"Elemental Mastery",enerRech_:"Energy Recharge",critRate_:"Crit Rate",critDMG_:"Crit DMG",heal_:"Healing Bonus"};Object.entries(bn).forEach(([e,t])=>{xe[`${e}_dmg_`]=`${t} DMG Bonus`});const vn={flower:"Flower of Life",plume:"Plume of Death",sands:"Sands of Eon",goblet:"Goblet of Eonothem",circlet:"Circlet of Logos"};function wn(e,t,r,s,i,u,a,c=!1){const p={lock:b(c,"Lock",g=>g?"Locked":"Unlocked")};a&&(p.location=b(a,"Location",g=>g));const w=t.size?[...t]:["EmblemOfSeveredFate"];let k=-1,v=[{setKey:"EmblemOfSeveredFate",rarity:5,level:0,slotKey:"flower",mainStatKey:"hp",substats:[],location:a??"",lock:c}];const A=rr(sr,g=>{let R=0;if(t.size){const T=[...t].reduce((F,O)=>F+(Ue.art.data[O].rarities.includes(g)?1:0),0);R+=T/t.size}if(e.has(g)&&R++,s.length){const T=s.reduce((F,O)=>F+(nr(O.key,O.value,g).length?1:0),0);R+=T/s.length*2}return R});for(const g of Qe)for(const R of Ge[g]){const T=he(R),F=T==="%"?1:0,O=T==="%"?.1:1,G=(r.has(g)?1:0)+(i.has(R)?1:0),J=u.filter(q=>q.unit!=="%"||he(R)==="%").map(q=>q.mainStatValue);for(const[q,Q]of Object.entries(A)){const Z=parseInt(q),V=w.filter(h=>Ue.art.data[h].rarities.includes(Z)),H=G+Q;if(!(H+2<k)){for(const h of J){const l=or(Z,R),f=Math.max(0,l.findIndex(y=>y+O>=h)),x=l[f],d=H+(x.toFixed(F)===h.toFixed(F)?1:0);for(const y of V){const L=d+(t.has(y)?1:0);L>=k&&(L>k&&(v=[]),k=L,v.push({setKey:y,rarity:Z,level:f,slotKey:g,mainStatKey:R,substats:[],location:a??"",lock:c}))}}if(H>=k)for(const l of V){const f=H+(t.has(l)?1:0);f>k&&(v=[]),k=f,v.push({setKey:l,rarity:Z,level:0,slotKey:g,mainStatKey:R,substats:[],location:a??"",lock:c})}}}}const P={setKey:new Set,rarity:new Set,level:new Set,slotKey:new Set,mainStatKey:new Set,mainStatVal:new Set},o=v[0],E=ar(o.mainStatKey,o.rarity,o.level);o.substats=s.filter((g,R)=>g.key!==o.mainStatKey&&s.slice(0,R).every(T=>T.key!==g.key));for(let g=o.substats.length;g<4;g++)o.substats.push({key:"",value:0});for(const g of v)P.setKey.add(g.setKey),P.rarity.add(g.rarity),P.level.add(g.level),P.slotKey.add(g.slotKey),P.mainStatKey.add(g.mainStatKey);function $(g,R,T){return C(ie,{children:["Unknown ",R," : Set to"," ",n(Le,{color:"error",children:T(g)})]})}function j(g,R,T,F){return C(ie,{children:["Ambiguous ",T," ",n(Le,{color:"error",children:F(g)})," : May also be"," ",R.filter(O=>O!==g).map((O,G)=>C(ie,{children:[n("b",{children:G>0?"/":""}),n(Le,{color:"warning",children:F(O)})]}))]})}function b(g,R,T){return C(ie,{children:["Detected ",R," ",n(Le,{color:"success",children:T(g)})]})}function U(g,R,T){return C(ie,{children:["Inferred ",R," ",n(Le,{color:"warning",children:T(g)})]})}function K(g,R,T,F){const O=new Set([...P[g]].filter(J=>R.has(J))),G=o[g];O.size>1?p[g]=j(G,[...R],T,F):O.size===1?p[g]=b(G,T,F):P[g].size>1?p[g]=$(G,T,F):p[g]=U(G,T,F)}K("setKey",t,"Set",g=>n(rn,{setKey:g})),K("rarity",e,"Rarity",g=>C(ie,{children:[g," ",g!==1?"Stars":"Star"]})),K("slotKey",r,"Slot",g=>n(nn,{slotKey:g})),K("mainStatKey",i,"Main Stat",g=>n("span",{children:xe[g]})),p.substats=n(ie,{children:o.substats.filter(g=>g.key!=="").map((g,R)=>n("div",{children:b(g,"Sub Stat",T=>C(ie,{children:[xe[T.key],"+",$e(T.value,he(T.key)),he(T.key)]}))},R))});const M=g=>C(ie,{children:[$e(g,he(o.mainStatKey)),he(o.mainStatKey)]}),W=he(o.mainStatKey)==="%"?1:0;return u.find(g=>g.mainStatValue.toFixed(W)===E.toFixed(W))?i.has(o.mainStatKey)?(p.level=b(o.level,"Level",g=>"+"+g),p.mainStatVal=b(E,"Main Stat value",M)):(p.level=U(o.level,"Level",g=>"+"+g),p.mainStatVal=U(E,"Main Stat value",M)):(p.level=$(o.level,"Level",g=>"+"+g),p.mainStatVal=$(E,"Main Stat value",M)),[o,p]}function Ke(e){const t=Math.min(...e.map(([,s])=>s)),r=e.filter(([,s])=>s===t).map(([s])=>s);return new Set(r)}function Sn(e){const t=[];for(const r of e)for(const s of ir)t.push([s,Ie(r.replace(/\W/g,""),s)]);return Ke(t)}function Cn(e){const t=[];for(const r of e)for(const s of Qe)t.push([s,Ie(r.replace(/\W/g,""),vn[s].replace(/\W/g,""))]);return Ke(t)}function xn(e){var r;const t=[];for(const s of e)for(const i of cr){const u=(r=xe[i])==null?void 0:r.toLowerCase();u.length<=3?s.toLowerCase().includes(u??"")&&t.push([i,0]):t.push([i,Ie(s.replace(/\W/g,""),(xe[i]??"").replace(/\W/g,""))])}return Ke(t)}function kn(e){const t=[];for(const r of e){let s=/(\d+[,|\\.]+\d)%/,i=s.exec(r);i&&t.push({mainStatValue:parseFloat(i[1].replace(/,/g,".").replace(/\.{2,}/g,".")),unit:"%"}),s=/(\d+[,|\\.]\d{3}|\d{2,3})/,i=s.exec(r),i&&t.push({mainStatValue:parseInt(i[1].replace(/[,|\\.]+/g,""))})}return t}function Ln(e){const t=[];for(let r of e)r=r.replace(/^[\W]+/,"").replace(/\n/,""),Ze.forEach(s=>{const i=xe[s],a=(he(s)==="%"?new RegExp(i+"\\s*\\+\\s*(\\d+[\\.|,]+\\d)%","im"):new RegExp(i+"\\s*\\+\\s*(\\d+,\\d+|\\d+)($|\\s)","im")).exec(r);a&&t.push({key:s,value:parseFloat(a[1].replace(/,/g,".").replace(/\.{2,}/g,"."))})});return t.slice(0,4)}function An(e){const t=[];for(let s of e){if(!s)continue;const i=s.indexOf(":");if(i!==-1&&(s=s.slice(i+1)),!!s)for(const u of lr)t.push([u,Ie(s.replace(/\W/g,""),u)])}t.push(["Traveler",8]);const[r]=Ke(t);return r}async function Rn(e,t,r=!1){const{f:s,fName:i}=e,u=await an(s),a=await cn(u),c=r?{}:void 0,p=Tn(a,c),w=Y(p),k=Pn(p),[v,A]=k?ye(k,.7,1):[0,0],P=Ce(p,de(Me),le(Me),!1),[o,E]=ye(P,.8,2);let $=E;const j=Ce(a,de(vt),le(vt),!1),b=j.some(S=>S>p.width*.5),[U,K]=ye(j);if(b)$=K;else{const S=Fe(p,de(Te),le(Te),!1),[I,te]=ye(S,.2),X=te-I;te>$&&($=ne(te+X,0,p.height))}const M=fe(w,{y1:v,y2:$}),W=b?fe(w,{y1:U,y2:K}):void 0,g=fe(w,{x1:0,x2:w.width*.6,y1:A,y2:o});if(c){const S=Y(p);k&&ge(S,k,{r:0,g:150,b:150,a:100},!1),ge(S,P,{r:150,g:0,b:0,a:100},!1),ge(S,j,{r:0,g:0,b:100,a:100},!1),me(S,v,{r:0,g:255,b:0,a:200},!1),me(S,b?K:$,{r:0,g:0,b:255,a:200},!1),me(S,o,{r:255,g:0,b:200,a:200},!1),c.artifactCardAnalysis=S.toDataURL()}c&&(c.headerCropped=Y(g).toDataURL());const R=fe(w,{y1:o,y2:$}),T=Fe(R,de(Te),le(Te),!1),[F,O]=ye(T,.2);if(c){const S=Y(R);ge(S,T,{r:100,g:0,b:0,a:100},!1),me(S,F,{r:0,g:255,b:0,a:200},!1),me(S,O,{r:0,g:0,b:255,a:200},!1),c.whiteCardAnalysis=S.toDataURL()}const G=O-F,J=fe(Y(R),{y1:F-G,y2:O+G}),q=fe(Y(R),{y2:F}),Q=Fe(R,de(wt),le(wt)),Z=Q.filter(S=>S>5).length>5;if(c){const S=Y(q);ge(S,Q,{r:0,g:100,b:0,a:100}),c.substatsCardCropped=S.toDataURL()}const V=je(g,{r:140,g:140,b:140},{r:255,g:255,b:255},"bw"),H=je(J,{r:30,g:100,b:30},{r:200,g:255,b:200},"bw"),h=W&&je(W,de(yn),le(gn),"bw");c&&(c.bwHeader=Y(V).toDataURL(),c.greenTextCropped=Y(J).toDataURL(),c.bwGreenText=Y(H).toDataURL(),h&&(c.bwEquipped=Y(h).toDataURL()));const[l,f,x,d]=await Promise.all([t(V),t(q),t(H),h&&t(h)]),y=En(g,c),[L,D]=wn(new Set([y]),Sn(x),Cn(l),Ln(f),xn(l),kn(l),d?An(d):"",Z);return{fileName:i,imageURL:Y(M).toDataURL(),artifact:L,texts:D,debugImgs:c}}function Tn(e,t){const r=Ce(e,de(Me),le(Me)),[s,i]=ye(r),u=fe(Y(e),{x1:s,x2:i});if(t){const a=Y(e);ge(a,r,{r:255,g:0,b:0,a:100}),me(a,s,{r:0,g:255,b:0,a:150}),me(a,i,{r:0,g:0,b:255,a:150}),t.fullAnalysis=a.toDataURL()}return u}function En(e,t){const r=Ce(e,de(Ee),le(Ee),!1),[s,i]=ye(r,.3),u=fe(Y(e),{y1:s,y2:i}),a=Ce(u,de(Ee),le(Ee));if(t){const k=Y(u);ge(k,a,{r:100,g:0,b:0,a:100}),t.rarity=k.toDataURL()}const c=Math.max(...a)*.5;let p=0,w=!1;for(let k=0;k<a.length;k++)a[k]>c?w||(p++,w=!0):w&&(w=!1);return ne(p,1,5)}function Pn(e){const r=e.width*.7;function s(u,a){const c=Ce(e,de(u,20),le(a,20),!1,[0,.3]);return c.find(p=>p>r)?c:null}return[[dn,un],[hn,fn],[pn,mn]].reduce((u,a)=>u||s(a[0],a[1]),null)}const On=3,$n=16;class Dn{constructor(t,r=!1){this.processed=[],this.outstanding=[],this.scanning=[],this.callback=()=>{},this.textsFromImage=t,this.debug=r}addFiles(t){this.outstanding.push(...t),this.processQueue()}processQueue(){const t=Math.min($n-this.processed.length-this.scanning.length,On-this.scanning.length,this.outstanding.length);t&&this.outstanding.splice(0,t).map(r=>{const s=Rn(r,this.textsFromImage,this.debug);this.scanning.push(s),s.then(i=>{const u=this.scanning.indexOf(s);u!==-1&&(this.scanning.splice(u,1),this.processed.push(i),this.processQueue())})}),this.callCB()}callCB(){this.callback({processedNum:this.processed.length,outstandingNum:this.outstanding.length,scanningNum:this.scanning.length})}shiftProcessed(){const t=this.processed.shift();return t&&this.processQueue(),t}clearQueue(){this.processed=[],this.outstanding=[],this.scanning=[],this.callCB()}}function Mn({slotKey:e="",onChange:t,hasUnselect:r=!1,...s}){const{t:i}=Xe(["artifact","ui"]);return C(rt,{title:i(e?`artifact:slotName:${e}`:"artifact:slot"),color:e?"success":"primary",startIcon:e?n(ut,{slotKey:e}):void 0,...s,children:[r&&C(Re,{selected:e==="",disabled:e==="",onClick:()=>t(""),children:[n(We,{children:n(_t,{})}),n(ze,{children:i`ui:unselect`})]}),r&&n(He,{}),Qe.map(u=>C(Re,{selected:e===u,disabled:e===u,onClick:()=>t(u),children:[n(We,{children:n(ut,{slotKey:u})}),n(ze,{children:i(`artifact:slotName:${u}`)})]},u))]})}function _n({value:e,onChange:t,disabled:r=!1,float:s=!1,...i}){const[u,a]=_.useState(""),c=_.useCallback(()=>{if(u==="")return t(0);t((s?parseFloat:parseInt)(u))},[t,u,s]);return _.useEffect(()=>a((e==null?void 0:e.toString())??""),[e,a]),n(Kr,{value:u,"aria-label":"custom-input",type:"number",onChange:p=>a(p.target.value),onBlur:c,disabled:r,onKeyDown:p=>p.key==="Enter"&&c(),...i})}function St({efficiency:e,max:t=!1,t:r,valid:s}){const i=t?"maxSubEff":"curSubEff";return n($t,{sx:{py:1,px:2},children:C(N,{container:!0,spacing:1,children:[n(N,{item:!0,children:r(`editor.${i}`)}),n(N,{item:!0,flexGrow:1,children:n(Br,{title:C("span",{children:[n(B,{variant:"h6",children:r(`editor.${i}`)}),n(B,{children:n(et,{t:r,i18nKey:`editor.${i}Desc`})})]})})}),n(N,{item:!0,xs:"auto",children:n(Mt,{valid:s,max:900,value:s?e:"ERR"})})]})})}function In({index:e,artifact:t,setSubstat:r}){const{t:s}=Xe("artifact"),{mainStatKey:i="",rarity:u=5}=t??{},{key:a="",value:c=0,rolls:p=[],efficiency:w=0}=(t==null?void 0:t.substats[e])??{},k=p.reduce((b,U)=>b+U,0),v=dr.unit(a),A=p.length;let P="",o=[],E=0;if(t){const b=t.rarity,{numUpgrades:U,high:K}=mr[b];E=U+K-3-A,o=a?ur(a,b):[]}const $=7-o.length;!A&&a&&c&&(P=P||s`editor.substat.error.noCalc`),E<0&&(P=P||s("editor.substat.error.noOverRoll",{value:E+A}));const j=_.useMemo(()=>a?[{value:0},...hr(u,a).map(b=>({value:b}))]:[{value:0}],[a,u]);return C($t,{children:[n(ee,{sx:{display:"flex"},children:C(It,{size:"small",sx:{width:"100%",display:"flex"},children:[C(rt,{startIcon:a?n(qe,{statKey:a}):void 0,title:a?n(Ve,{statKey:a}):s("editor.substat.substatFormat",{value:e+1}),disabled:!t,color:a?"success":"primary",sx:{whiteSpace:"nowrap"},children:[a&&n(Re,{onClick:()=>r(e,{key:"",value:0}),children:s`editor.substat.noSubstat`}),Ze.filter(b=>i!==b).map(b=>C(Re,{selected:a===b,disabled:a===b,onClick:()=>r(e,{key:b,value:0}),children:[n(We,{children:n(qe,{statKey:b})}),n(ze,{children:n(Ve,{statKey:b})})]},b))]}),n(fr,{sx:{flexBasis:30,flexGrow:1},children:n(pr,{float:v==="%",placeholder:s`editor.substat.selectSub`,value:a?c:void 0,onChange:b=>r(e,{key:a,value:b??0}),disabled:!a,error:!!P,sx:{px:1},inputProps:{sx:{textAlign:"right"}}})}),!!o.length&&n(Ur,{children:s`editor.substat.nextRolls`}),o.map((b,U)=>{var M,W;let K=$e(k+b,v);return K=((W=(M=Ue.art.subRollCorrection[u])==null?void 0:M[a])==null?void 0:W[K])??K,n(re,{color:`roll${ne($+U,1,6)}`,disabled:c&&!A||E<=0,onClick:()=>r(e,{key:a,value:parseFloat(K)}),children:K},U)})]})}),n(ee,{px:2,children:n(Nn,{value:c,marks:j,setValue:b=>r(e,{key:a,value:b??0}),disabled:!a})}),n(ee,{sx:{px:1,pb:1},children:P?n(pt,{color:"error",children:s`ui:error`}):C(N,{container:!0,children:[n(N,{item:!0,children:n(pt,{color:A===0?"secondary":`roll${ne(A,1,6)}`,children:A?s("editor.substat.RollCount",{count:A}):s`editor.substat.noRoll`})}),n(N,{item:!0,flexGrow:1,children:!!p.length&&[...p].sort().map((b,U)=>n(B,{component:"span",color:`roll${ne($+o.indexOf(b),1,6)}.main`,sx:{ml:1},children:$e(b,v)},`${U}.${b}`))}),n(N,{item:!0,xs:"auto",flexShrink:1,children:n(B,{children:C(et,{t:s,i18nKey:"editor.substat.eff",color:"text.secondary",children:["Efficiency: ",n(Mt,{valid:!0,max:A*100,value:w||s`editor.substat.noStat`})]})})})]})})]})}function Nn({value:e,setValue:t,marks:r,disabled:s=!1}){var a;const[i,u]=_.useState(e);return _.useEffect(()=>u(e),[e]),n(Gr,{value:i,step:null,disabled:s,marks:r,min:0,max:((a=r[r.length-1])==null?void 0:a.value)??0,onChange:(c,p)=>u(p),onChangeCommitted:(c,p)=>t(p),valueLabelDisplay:"auto"})}const Kn=""+new URL("scanned-f7f27047.png",import.meta.url).href,jn=""+new URL("fullscreen-9e994755.png",import.meta.url).href;function Fn({modalShow:e,hide:t}){return n(tt,{open:e,onClose:t,children:C(gr,{children:[n(be,{sx:{py:1},children:C(N,{container:!0,children:[n(N,{item:!0,flexGrow:1,children:n(B,{variant:"subtitle1",children:"How to Upload Screenshots for parsing"})}),n(N,{item:!0,children:n(Ye,{onClick:t})})]})}),n(He,{}),C(be,{children:[C(Dt,{variant:"outlined",severity:"warning",children:["NOTE: Artifact Scanning currently only works for"," ",n("strong",{children:"ENGLISH"})," artifacts."]}),C(N,{container:!0,spacing:1,mt:1,children:[n(N,{item:!0,xs:8,md:6,children:n(ee,{component:"img",alt:"snippet of the screen to take",src:jn,width:"100%",height:"auto"})}),C(N,{item:!0,xs:12,md:6,children:[n(B,{gutterBottom:!0,children:"Using screenshots can dramatically decrease the amount of time you manually input in stats on the Genshin Optimizer."}),n(B,{variant:"h5",children:"Where to snip the screenshot."}),C(B,{gutterBottom:!0,children:["In game, Open your bag, and navigate to the artifacts tab. Select the artifact you want to scan with Genshin Optimizer."," ",n("b",{children:"Only artifact from this screen can be scanned."})]}),n(B,{variant:"h6",children:"Single artifact"}),C(B,{gutterBottom:!0,children:["To take a screenshot, in Windows, the shortcut is"," ",n("strong",{children:"Alt + Print Screen"}),". Once you selected the region, the image is automatically included in your clipboard."]}),n(B,{variant:"h6",children:"Multiple artifacts"}),C(B,{gutterBottom:!0,children:["To take advantage of batch uploads, you can use a tool like"," ",n("a",{href:"https://picpick.app/",target:"_blank",rel:"noreferrer",children:"PicPick"})," ","to create a macro to easily to screenshot multiple artifacts at once."]}),n(B,{variant:"h5",children:"What to include in the screenshot."}),n(B,{children:"The full genshin window, or at least a region that covers the artifact card."})]}),C(N,{item:!0,xs:12,md:7,children:[n(B,{variant:"h5",children:"Adding Screenshot to Genshin Optimizer"}),n(B,{children:"At this point, you should have the artifact screenshot either saved to your harddrive, or in your clipboard."}),n(B,{gutterBottom:!0,children:'You can click on the box next to "Browse" to browse the files in your harddrive for multiple screenshots.'}),C(B,{children:["For single screenshots from the snippets, just press"," ",n("strong",{children:"Ctrl + V"})," to paste from your clipboard."]}),C(B,{gutterBottom:!0,children:["You should be able to see a Preview of your artifact snippet, and after waiting a few seconds, the artifact set and the substats will be filled in in the ",n("b",{children:"Artifact Editor"}),"."]}),n(B,{variant:"h5",children:"Finishing the Artifact"}),C(B,{children:["Unfortunately, computer vision is not 100%. There will always be cases where something is not scanned properly. You should always double check the scanned artifact values! Once the artifact has been filled, Click on ",n("strong",{children:"Add Artifact"})," to finish editing the artifact."]})]}),n(N,{item:!0,xs:8,md:5,children:n(ee,{component:"img",alt:"main screen after importing stats",src:Kn,width:"100%",height:"auto"})})]})]}),n(He,{}),n(be,{sx:{py:1},children:n(Ye,{large:!0,onClick:t})})]})})}var Bn={exports:{}};(function(e){var t=function(r){var s=Object.prototype,i=s.hasOwnProperty,u=Object.defineProperty||function(h,l,f){h[l]=f.value},a,c=typeof Symbol=="function"?Symbol:{},p=c.iterator||"@@iterator",w=c.asyncIterator||"@@asyncIterator",k=c.toStringTag||"@@toStringTag";function v(h,l,f){return Object.defineProperty(h,l,{value:f,enumerable:!0,configurable:!0,writable:!0}),h[l]}try{v({},"")}catch{v=function(l,f,x){return l[f]=x}}function A(h,l,f,x){var d=l&&l.prototype instanceof U?l:U,y=Object.create(d.prototype),L=new Z(x||[]);return u(y,"_invoke",{value:G(h,f,L)}),y}r.wrap=A;function P(h,l,f){try{return{type:"normal",arg:h.call(l,f)}}catch(x){return{type:"throw",arg:x}}}var o="suspendedStart",E="suspendedYield",$="executing",j="completed",b={};function U(){}function K(){}function M(){}var W={};v(W,p,function(){return this});var g=Object.getPrototypeOf,R=g&&g(g(V([])));R&&R!==s&&i.call(R,p)&&(W=R);var T=M.prototype=U.prototype=Object.create(W);K.prototype=M,u(T,"constructor",{value:M,configurable:!0}),u(M,"constructor",{value:K,configurable:!0}),K.displayName=v(M,k,"GeneratorFunction");function F(h){["next","throw","return"].forEach(function(l){v(h,l,function(f){return this._invoke(l,f)})})}r.isGeneratorFunction=function(h){var l=typeof h=="function"&&h.constructor;return l?l===K||(l.displayName||l.name)==="GeneratorFunction":!1},r.mark=function(h){return Object.setPrototypeOf?Object.setPrototypeOf(h,M):(h.__proto__=M,v(h,k,"GeneratorFunction")),h.prototype=Object.create(T),h},r.awrap=function(h){return{__await:h}};function O(h,l){function f(y,L,D,S){var I=P(h[y],h,L);if(I.type==="throw")S(I.arg);else{var te=I.arg,X=te.value;return X&&typeof X=="object"&&i.call(X,"__await")?l.resolve(X.__await).then(function(se){f("next",se,D,S)},function(se){f("throw",se,D,S)}):l.resolve(X).then(function(se){te.value=se,D(te)},function(se){return f("throw",se,D,S)})}}var x;function d(y,L){function D(){return new l(function(S,I){f(y,L,S,I)})}return x=x?x.then(D,D):D()}u(this,"_invoke",{value:d})}F(O.prototype),v(O.prototype,w,function(){return this}),r.AsyncIterator=O,r.async=function(h,l,f,x,d){d===void 0&&(d=Promise);var y=new O(A(h,l,f,x),d);return r.isGeneratorFunction(l)?y:y.next().then(function(L){return L.done?L.value:y.next()})};function G(h,l,f){var x=o;return function(y,L){if(x===$)throw new Error("Generator is already running");if(x===j){if(y==="throw")throw L;return H()}for(f.method=y,f.arg=L;;){var D=f.delegate;if(D){var S=J(D,f);if(S){if(S===b)continue;return S}}if(f.method==="next")f.sent=f._sent=f.arg;else if(f.method==="throw"){if(x===o)throw x=j,f.arg;f.dispatchException(f.arg)}else f.method==="return"&&f.abrupt("return",f.arg);x=$;var I=P(h,l,f);if(I.type==="normal"){if(x=f.done?j:E,I.arg===b)continue;return{value:I.arg,done:f.done}}else I.type==="throw"&&(x=j,f.method="throw",f.arg=I.arg)}}}function J(h,l){var f=l.method,x=h.iterator[f];if(x===a)return l.delegate=null,f==="throw"&&h.iterator.return&&(l.method="return",l.arg=a,J(h,l),l.method==="throw")||f!=="return"&&(l.method="throw",l.arg=new TypeError("The iterator does not provide a '"+f+"' method")),b;var d=P(x,h.iterator,l.arg);if(d.type==="throw")return l.method="throw",l.arg=d.arg,l.delegate=null,b;var y=d.arg;if(!y)return l.method="throw",l.arg=new TypeError("iterator result is not an object"),l.delegate=null,b;if(y.done)l[h.resultName]=y.value,l.next=h.nextLoc,l.method!=="return"&&(l.method="next",l.arg=a);else return y;return l.delegate=null,b}F(T),v(T,k,"Generator"),v(T,p,function(){return this}),v(T,"toString",function(){return"[object Generator]"});function q(h){var l={tryLoc:h[0]};1 in h&&(l.catchLoc=h[1]),2 in h&&(l.finallyLoc=h[2],l.afterLoc=h[3]),this.tryEntries.push(l)}function Q(h){var l=h.completion||{};l.type="normal",delete l.arg,h.completion=l}function Z(h){this.tryEntries=[{tryLoc:"root"}],h.forEach(q,this),this.reset(!0)}r.keys=function(h){var l=Object(h),f=[];for(var x in l)f.push(x);return f.reverse(),function d(){for(;f.length;){var y=f.pop();if(y in l)return d.value=y,d.done=!1,d}return d.done=!0,d}};function V(h){if(h){var l=h[p];if(l)return l.call(h);if(typeof h.next=="function")return h;if(!isNaN(h.length)){var f=-1,x=function d(){for(;++f<h.length;)if(i.call(h,f))return d.value=h[f],d.done=!1,d;return d.value=a,d.done=!0,d};return x.next=x}}return{next:H}}r.values=V;function H(){return{value:a,done:!0}}return Z.prototype={constructor:Z,reset:function(h){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(Q),!h)for(var l in this)l.charAt(0)==="t"&&i.call(this,l)&&!isNaN(+l.slice(1))&&(this[l]=a)},stop:function(){this.done=!0;var h=this.tryEntries[0],l=h.completion;if(l.type==="throw")throw l.arg;return this.rval},dispatchException:function(h){if(this.done)throw h;var l=this;function f(S,I){return y.type="throw",y.arg=h,l.next=S,I&&(l.method="next",l.arg=a),!!I}for(var x=this.tryEntries.length-1;x>=0;--x){var d=this.tryEntries[x],y=d.completion;if(d.tryLoc==="root")return f("end");if(d.tryLoc<=this.prev){var L=i.call(d,"catchLoc"),D=i.call(d,"finallyLoc");if(L&&D){if(this.prev<d.catchLoc)return f(d.catchLoc,!0);if(this.prev<d.finallyLoc)return f(d.finallyLoc)}else if(L){if(this.prev<d.catchLoc)return f(d.catchLoc,!0)}else if(D){if(this.prev<d.finallyLoc)return f(d.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(h,l){for(var f=this.tryEntries.length-1;f>=0;--f){var x=this.tryEntries[f];if(x.tryLoc<=this.prev&&i.call(x,"finallyLoc")&&this.prev<x.finallyLoc){var d=x;break}}d&&(h==="break"||h==="continue")&&d.tryLoc<=l&&l<=d.finallyLoc&&(d=null);var y=d?d.completion:{};return y.type=h,y.arg=l,d?(this.method="next",this.next=d.finallyLoc,b):this.complete(y)},complete:function(h,l){if(h.type==="throw")throw h.arg;return h.type==="break"||h.type==="continue"?this.next=h.arg:h.type==="return"?(this.rval=this.arg=h.arg,this.method="return",this.next="end"):h.type==="normal"&&l&&(this.next=l),b},finish:function(h){for(var l=this.tryEntries.length-1;l>=0;--l){var f=this.tryEntries[l];if(f.finallyLoc===h)return this.complete(f.completion,f.afterLoc),Q(f),b}},catch:function(h){for(var l=this.tryEntries.length-1;l>=0;--l){var f=this.tryEntries[l];if(f.tryLoc===h){var x=f.completion;if(x.type==="throw"){var d=x.arg;Q(f)}return d}}throw new Error("illegal catch attempt")},delegateYield:function(h,l,f){return this.delegate={iterator:V(h),resultName:l,nextLoc:f},this.method==="next"&&(this.arg=a),b}},r}(e.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(Bn);var nt=(e,t)=>`${e}-${t}-${Math.random().toString(16).slice(3,8)}`;const Un=nt;let Ct=0;var jt=({id:e,action:t,payload:r={}})=>{let s=e;return typeof s>"u"&&(s=Un("Job",Ct),Ct+=1),{id:s,action:t,payload:r}},ke={};let st=!1;ke.logging=st;ke.setLogging=e=>{st=e};ke.log=(...e)=>st?console.log.apply(globalThis,e):null;const Gn=jt,{log:Pe}=ke,zn=nt;let xt=0;var Wn=()=>{const e=zn("Scheduler",xt),t={},r={};let s=[];xt+=1;const i=()=>s.length,u=()=>Object.keys(t).length,a=()=>{if(s.length!==0){const v=Object.keys(t);for(let A=0;A<v.length;A+=1)if(typeof r[v[A]]>"u"){s[0](t[v[A]]);break}}},c=(v,A)=>new Promise((P,o)=>{const E=Gn({action:v,payload:A});s.push(async $=>{s.shift(),r[$.id]=E;try{P(await $[v].apply(globalThis,[...A,E.id]))}catch(j){o(j)}finally{delete r[$.id],a()}}),Pe(`[${e}]: Add ${E.id} to JobQueue`),Pe(`[${e}]: JobQueue length=${s.length}`),a()});return{addWorker:v=>(t[v.id]=v,Pe(`[${e}]: Add ${v.id}`),Pe(`[${e}]: Number of workers=${u()}`),a(),v.id),addJob:async(v,...A)=>{if(u()===0)throw Error(`[${e}]: You need to have at least one worker before adding jobs`);return c(v,A)},terminate:async()=>{Object.keys(t).forEach(async v=>{await t[v].terminate()}),s=[]},getQueueLen:i,getNumWorkers:u}};function Hn(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var qn=Hn;const Vn=qn;var Yn=e=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":Vn()?t.type="electron":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof yr=="function"&&(t.type="node"),typeof e>"u"?t:t[e]};const Jn=Yn("type")==="browser",Qn=Jn?e=>new URL(e,window.location.href).href:e=>e;var Zn=e=>{const t={...e};return["corePath","workerPath","langPath"].forEach(r=>{e[r]&&(t[r]=Qn(t[r]))}),t},Xn=e=>{const t=[],r=[],s=[],i=[],u=[];return e.blocks&&e.blocks.forEach(a=>{a.paragraphs.forEach(c=>{c.lines.forEach(p=>{p.words.forEach(w=>{w.symbols.forEach(k=>{u.push({...k,page:e,block:a,paragraph:c,line:p,word:w})}),i.push({...w,page:e,block:a,paragraph:c,line:p})}),s.push({...p,page:e,block:a,paragraph:c})}),r.push({...c,page:e,block:a})}),t.push({...a,page:e})}),{...e,blocks:t,paragraphs:r,lines:s,words:i,symbols:u}},Ft={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const es="tesseract.js",ts="5.0.2",rs="Pure Javascript Multilingual OCR",ns="src/index.js",ss="src/index.d.ts",os="dist/tesseract.min.js",as="dist/tesseract.min.js",is={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js && rollup -c scripts/rollup.esm.mjs","profile:tesseract":"webpack-bundle-analyzer dist/tesseract-stats.json","profile:worker":"webpack-bundle-analyzer dist/worker-stats.json",prepublishOnly:"npm run build",wait:"rimraf dist && wait-on http://localhost:3000/dist/tesseract.min.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:* test:node:all","test:node":"nyc mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser-tpl":"mocha-headless-chrome -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:detect":"npm run test:browser-tpl -- -f ./tests/detect.test.html","test:browser:recognize":"npm run test:browser-tpl -- -f ./tests/recognize.test.html","test:browser:scheduler":"npm run test:browser-tpl -- -f ./tests/scheduler.test.html","test:browser:FS":"npm run test:browser-tpl -- -f ./tests/FS.test.html",lint:"eslint src","lint:fix":"eslint --fix src",postinstall:"opencollective-postinstall || true"},cs={"./src/worker/node/index.js":"./src/worker/browser/index.js"},ls="",ds=["jeromewu"],us="Apache-2.0",hs={"@babel/core":"^7.21.4","@babel/eslint-parser":"^7.21.3","@babel/preset-env":"^7.21.4","@rollup/plugin-commonjs":"^24.1.0",acorn:"^8.8.2","babel-loader":"^9.1.2",buffer:"^6.0.3",cors:"^2.8.5",eslint:"^7.32.0","eslint-config-airbnb-base":"^14.2.1","eslint-plugin-import":"^2.27.5","expect.js":"^0.3.1",express:"^4.18.2",mocha:"^10.2.0","mocha-headless-chrome":"^4.0.0","npm-run-all":"^4.1.5",nyc:"^15.1.0",rimraf:"^5.0.0",rollup:"^3.20.7","wait-on":"^7.0.1",webpack:"^5.79.0","webpack-bundle-analyzer":"^4.8.0","webpack-cli":"^5.0.1","webpack-dev-middleware":"^6.0.2","rollup-plugin-sourcemaps":"^0.6.3"},fs={"bmp-js":"^0.1.0","idb-keyval":"^6.2.0","is-electron":"^2.2.2","is-url":"^1.2.4","node-fetch":"^2.6.9","opencollective-postinstall":"^2.0.3","regenerator-runtime":"^0.13.3","tesseract.js-core":"^5.0.0","wasm-feature-detect":"^1.2.11",zlibjs:"^0.3.1"},ps={"@rollup/pluginutils":"^5.0.2"},ms={type:"git",url:"https://github.com/naptha/tesseract.js.git"},gs={url:"https://github.com/naptha/tesseract.js/issues"},ys="https://github.com/naptha/tesseract.js",bs={type:"opencollective",url:"https://opencollective.com/tesseractjs"},vs={name:es,version:ts,description:rs,main:ns,types:ss,unpkg:os,jsdelivr:as,scripts:is,browser:cs,author:ls,contributors:ds,license:us,devDependencies:hs,dependencies:fs,overrides:ps,repository:ms,bugs:gs,homepage:ys,collective:bs};var ws={workerBlobURL:!0,logger:()=>{}};const{version:Ss}=vs,Cs=ws;var xs={...Cs,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${Ss}/dist/worker.min.js`},ks=({workerPath:e,workerBlobURL:t})=>{let r;if(Blob&&URL&&t){const s=new Blob([`importScripts("${e}");`],{type:"application/javascript"});r=new Worker(URL.createObjectURL(s))}else r=new Worker(e);return r},Ls=e=>{e.terminate()},As=(e,t)=>{e.onmessage=({data:r})=>{t(r)}},Rs=async(e,t)=>{e.postMessage(t)};const Be=e=>new Promise((t,r)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=({target:{error:{code:i}}})=>{r(Error(`File could not be read! Code=${i}`))},s.readAsArrayBuffer(e)}),Je=async e=>{let t=e;if(typeof e>"u")return"undefined";if(typeof e=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(r=>r.charCodeAt(0)):t=await(await fetch(e)).arrayBuffer();else if(typeof HTMLElement<"u"&&e instanceof HTMLElement)e.tagName==="IMG"&&(t=await Je(e.src)),e.tagName==="VIDEO"&&(t=await Je(e.poster)),e.tagName==="CANVAS"&&await new Promise(r=>{e.toBlob(async s=>{t=await Be(s),r()})});else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas){const r=await e.convertToBlob();t=await Be(r)}else(e instanceof File||e instanceof Blob)&&(t=await Be(e));return new Uint8Array(t)};var Ts=Je;const Es=xs,Ps=ks,Os=Ls,$s=As,Ds=Rs,Ms=Ts;var _s={defaultOptions:Es,spawnWorker:Ps,terminateWorker:Os,onMessage:$s,send:Ds,loadImage:Ms};const Is=Zn,Ns=Xn,ae=jt,{log:kt}=ke,Ks=nt,pe=Ft,{defaultOptions:js,spawnWorker:Fs,terminateWorker:Bs,onMessage:Us,loadImage:Lt,send:Gs}=_s;let At=0;var Bt=async(e="eng",t=pe.LSTM_ONLY,r={},s={})=>{const i=Ks("Worker",At),{logger:u,errorHandler:a,...c}=Is({...js,...r}),p={},w={},k=typeof e=="string"?e.split("+"):e;let v=t,A=s;const P=[pe.DEFAULT,pe.LSTM_ONLY].includes(t)&&!c.legacyCore;let o,E;const $=new Promise((d,y)=>{E=d,o=y}),j=d=>{o(d.message)};let b=Fs(c);b.onerror=j,At+=1;const U=(d,y)=>{p[d]=y},K=(d,y)=>{w[d]=y},M=({id:d,action:y,payload:L})=>new Promise((D,S)=>{kt(`[${i}]: Start ${d}, action=${y}`),U(y,D),K(y,S),Gs(b,{workerId:i,jobId:d,action:y,payload:L})}),W=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),g=d=>M(ae({id:d,action:"load",payload:{options:{lstmOnly:P,corePath:c.corePath,logging:c.logging}}})),R=(d,y,L)=>M(ae({id:L,action:"FS",payload:{method:"writeFile",args:[d,y]}})),T=(d,y)=>M(ae({id:y,action:"FS",payload:{method:"readFile",args:[d,{encoding:"utf8"}]}})),F=(d,y)=>M(ae({id:y,action:"FS",payload:{method:"unlink",args:[d]}})),O=(d,y,L)=>M(ae({id:L,action:"FS",payload:{method:d,args:y}})),G=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),J=(d,y)=>M(ae({id:y,action:"loadLanguage",payload:{langs:d,options:{langPath:c.langPath,dataPath:c.dataPath,cachePath:c.cachePath,cacheMethod:c.cacheMethod,gzip:c.gzip,lstmOnly:[pe.LSTM_ONLY,pe.TESSERACT_LSTM_COMBINED].includes(v)&&!c.legacyLang}}})),q=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),Q=(d,y,L,D)=>M(ae({id:D,action:"initialize",payload:{langs:d,oem:y,config:L}})),Z=(d="eng",y,L,D)=>{if(P&&[pe.TESSERACT_ONLY,pe.TESSERACT_LSTM_COMBINED].includes(y))throw Error("Legacy model requested but code missing.");const S=y||v;v=S;const I=L||A;A=I;const X=(typeof d=="string"?d.split("+"):d).filter(se=>!k.includes(se));return k.push(...X),X.length>0?J(X,D).then(()=>Q(d,S,I,D)):Q(d,S,I,D)},V=(d={},y)=>M(ae({id:y,action:"setParameters",payload:{params:d}})),H=async(d,y={},L={blocks:!0,text:!0,hocr:!0,tsv:!0},D)=>M(ae({id:D,action:"recognize",payload:{image:await Lt(d),options:y,output:L}})),h=(d="Tesseract OCR Result",y=!1,L)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),M(ae({id:L,action:"getPDF",payload:{title:d,textonly:y}}))),l=async(d,y)=>{if(P)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return M(ae({id:y,action:"detect",payload:{image:await Lt(d)}}))},f=async()=>(b!==null&&(Bs(b),b=null),Promise.resolve());Us(b,({workerId:d,jobId:y,status:L,action:D,data:S})=>{if(L==="resolve"){kt(`[${d}]: Complete ${y}`);let I=S;D==="recognize"?I=Ns(S):D==="getPDF"&&(I=Array.from({...S,length:Object.keys(S).length})),p[D]({jobId:y,data:I})}else if(L==="reject")if(w[D](S),D==="load"&&o(S),a)a(S);else throw Error(S);else L==="progress"&&u({...S,userJobId:y})});const x={id:i,worker:b,setResolve:U,setReject:K,load:W,writeText:R,readText:T,removeFile:F,FS:O,loadLanguage:G,initialize:q,reinitialize:Z,setParameters:V,recognize:H,getPDF:h,detect:l,terminate:f};return g().then(()=>J(e)).then(()=>Q(e,t,s)).then(()=>E(x)).catch(()=>{}),$};const Ut=Bt,zs=async(e,t,r)=>{const s=await Ut(t,1,r);return s.recognize(e).finally(async()=>{await s.terminate()})},Ws=async(e,t)=>{const r=await Ut("osd",0,t);return r.detect(e).finally(async()=>{await r.terminate()})};var Hs={recognize:zs,detect:Ws},qs={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},Vs={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const Ys=Wn,Js=Bt,Qs=Hs,Zs=qs,Xs=Ft,eo=Vs,{setLogging:to}=ke;var Rt={languages:Zs,OEM:Xs,PSM:eo,createScheduler:Ys,createWorker:Js,setLogging:to,...Qs};const ro=2,no=new Wr(async e=>{const t=Rt.createScheduler(),r=Array(ro).fill(0).map(async s=>{const i=await Rt.createWorker(e,void 0,{errorHandler:console.error,langPath:"./assets"});t.addWorker(i)});return await Promise.any(r),t},(e,t)=>{t.then(r=>r.terminate())});async function so(e,t=void 0){const r=Y(e);return(await no.borrow("genshin_fast_09_04_21",async i=>await(await i).addJob("recognize",r,t))).data.lines.map(i=>i.text)}const oo=new Set(Ze);function ao(e,t){const s=(()=>{switch(t.type){case"reset":return;case"substat":{const{index:i,substat:u}=t,a=u.key?e.substats.findIndex(c=>c.key===u.key):-1;return a===-1||a===i?e.substats[i]=u:[e.substats[i],e.substats[a]]=[e.substats[a],e.substats[i]],{...e}}case"overwrite":return t.artifact;case"update":return{...e,...t.artifact}}})();return s&&Rr(s,!0)}const io=_e("input")({display:"none"});function Po({artifactIdToEdit:e="",cancelEdit:t,allowUpload:r=!1,allowEmpty:s=!1,disableSet:i=!1,fixedSlotKey:u}){var at;const c=_.useRef(new Dn(so,ct)).current,{t:p}=Xe("artifact"),w=br(),[k,v]=_.useState(!1),[A,P]=vr();_.useEffect(()=>w.arts.followAny(P),[w,P]);const[o,E]=_.useReducer(ao,void 0),[$,j]=_.useState(!1),[{processedNum:b,outstandingNum:U,scanningNum:K},M]=_.useState({processedNum:0,outstandingNum:0,scanningNum:0}),[W,g]=_.useState(void 0),{fileName:R,imageURL:T,debugImgs:F,texts:O}=W??{},G=b+U+K,J=!["new",""].includes(e)&&!!(o!=null&&o.location)||!!u,q=_.useCallback(m=>{m&&(v(!0),c.addFiles(Array.from(m).map(z=>({f:z,fName:z.name}))))},[v,c]),Q=_.useCallback(()=>{c.clearQueue()},[c]),Z=_.useCallback(m=>{m.target&&(q(m.target.files),m.target.value="")},[q]),{old:V,oldType:H}=_.useMemo(()=>{const m=A&&e&&w.arts.get(e);if(m)return{old:m,oldType:"edit"};if(o===void 0)return{old:void 0,oldType:""};const{duplicated:z,upgraded:oe}=A&&w.arts.findDups(o);return{old:z[0]??oe[0],oldType:z.length!==0?"duplicate":"upgrade"}},[o,e,w,A]),{artifact:h,errors:l}=_.useMemo(()=>o?wr(o,e):{artifact:void 0,errors:[]},[o,e]),f=o?ft(o.setKey):void 0,x=_.useCallback(()=>{t==null||t(),E({type:"reset"}),g(void 0)},[t,E]),d=_.useCallback(m=>{const z=m.setKey?ft(m.setKey):f;function oe(ve,it,Yt){return ve&&it.includes(ve)?ve:Yt??it[0]}m.setKey&&(m.rarity=oe(o==null?void 0:o.rarity,z.rarity,Math.max(...z.rarity)),m.slotKey=(o==null?void 0:o.slotKey)??u??"flower"),m.rarity&&(m.level=(o==null?void 0:o.level)??0),m.level&&(m.level=ne(m.level,0,4*(m.rarity??o.rarity))),m.slotKey&&(m.mainStatKey=oe(o==null?void 0:o.mainStatKey,Ge[m.slotKey])),m.mainStatKey&&(m.substats=[0,1,2,3].map(ve=>o&&o.substats[ve].key!==m.mainStatKey?o.substats[ve]:{key:"",value:0})),E({type:"update",artifact:m})},[o,f,E,u]),y=_.useCallback((m,z)=>{E({type:"substat",index:m,substat:z})},[E]),L=!l.length,D=()=>window.confirm(p`editor.clearPrompt`),{rarity:S=5,level:I=0}=o??{},te=_.useMemo(()=>(o==null?void 0:o.slotKey)??u??"flower",[u,o]),{currentEfficiency:X=0,maxEfficiency:se=0}=h?Fr.getArtifactEfficiency(h,oo):{},ot=_.useCallback(m=>{if(!e&&(G||o)&&!window.confirm(p`editor.clearPrompt`)){m==null||m.preventDefault();return}v(!1),c.clearQueue(),x()},[p,e,c,o,G,v,x]),Gt=Sr(),zt=Cr(Gt.breakpoints.up("md")),Wt=o?xr.find(m=>o.mainStatKey.includes(m)):void 0,Ht=o?Wt??"success":"primary",qt=_.useCallback(m=>d({setKey:m}),[d]),Vt=_.useCallback(m=>!!(m===""||J&&te!=="circlet"&&(m==="PrayersForDestiny"||m==="PrayersForIllumination"||m==="PrayersForWisdom"||m==="PrayersToSpringtime")),[J,te]);return _.useEffect(()=>{e==="new"&&(v(!0),E({type:"reset"}));const m=e&&A&&w.arts.get(e);m&&(v(!0),E({type:"overwrite",artifact:kr(m)}))},[e,w,A]),_.useEffect(()=>{if(!b||W)return;const m=c.shiftProcessed();if(!m)return;const{artifact:z,...oe}=m;g(oe),E({type:"overwrite",artifact:z})},[c,b,W]),_.useEffect(()=>{const m=z=>{var oe;return q((oe=z.clipboardData)==null?void 0:oe.files)};return r&&window.addEventListener("paste",m),()=>{r&&window.removeEventListener("paste",m)}},[q,r]),_.useEffect(()=>(c.callback=M,()=>{c.callback=()=>{}}),[c]),n(tt,{open:k,onClose:ot,children:C(ce,{children:[n(Fn,{modalShow:$,hide:()=>j(!1)}),n(zr,{title:n(et,{t:p,i18nKey:"editor.title",children:"Artifact Editor"}),action:n(Ye,{disabled:!!G,onClick:ot})}),C(be,{sx:{display:"flex",flexDirection:"column",gap:1},children:[C(N,{container:!0,spacing:1,columns:{xs:1,md:2},children:[C(N,{item:!0,xs:1,display:"flex",flexDirection:"column",gap:1,children:[C(ee,{sx:{display:"flex",gap:1},children:[n(Mr,{disabled:i,size:"small",artSetKey:(o==null?void 0:o.setKey)??"",setArtSetKey:qt,sx:{flexGrow:1},label:o!=null&&o.setKey?"":p("editor.unknownSetName"),getOptionDisabled:({key:m})=>Vt(m)}),n(_r,{rarity:o?S:void 0,onChange:m=>d({rarity:m}),filter:m=>{var z,oe;return!!((oe=(z=f==null?void 0:f.rarity)==null?void 0:z.includes)!=null&&oe.call(z,m))},disabled:!f})]}),C(ee,{component:"div",display:"flex",children:[n(_n,{id:"filled-basic",label:"Level",variant:"filled",sx:{flexShrink:1,flexGrow:1,mr:1,my:0},margin:"dense",size:"small",value:I,disabled:!f,placeholder:`0~${S*4}`,onChange:m=>d({level:m})}),C(It,{children:[n(re,{onClick:()=>d({level:I-1}),disabled:!f||I===0,children:"-"}),S?[...Array(S+1).keys()].map(m=>4*m).map(m=>n(re,{onClick:()=>d({level:m}),disabled:!f||I===m,children:m},m)):null,n(re,{onClick:()=>d({level:I+1}),disabled:!f||I===S*4,children:"+"})]})]}),C(ee,{component:"div",display:"flex",children:[n(Mn,{disabled:J||!f||((at=o==null?void 0:o.setKey)==null?void 0:at.startsWith("Prayer")),slotKey:te,onChange:m=>d({slotKey:m})}),n(ce,{bgt:"light",sx:{p:1,ml:1,flexGrow:1},children:n(_.Suspense,{fallback:n(lt,{width:"60%"}),children:n(B,{color:"text.secondary",children:o&&(f!=null&&f.getSlotName(o.slotKey))?C("span",{children:[n(jr,{size:2,src:Er(o.setKey,o.slotKey)}),f==null?void 0:f.getSlotName(o.slotKey)]}):p`editor.unknownPieceName`})})})]}),C(ee,{component:"div",display:"flex",gap:1,children:[n(rt,{startIcon:o!=null&&o.mainStatKey?n(qe,{statKey:o.mainStatKey}):void 0,title:n("b",{children:o?n(Ve,{statKey:o.mainStatKey}):p`mainStat`}),disabled:!f,color:Ht,children:Ge[te].map(m=>n(Re,{selected:(o==null?void 0:o.mainStatKey)===m,disabled:(o==null?void 0:o.mainStatKey)===m,onClick:()=>d({mainStatKey:m}),children:n(Or,{statKey:m})},m))}),n(ce,{bgt:"light",sx:{p:1,flexGrow:1},children:n(B,{color:"text.secondary",children:o?Lr(o.mainStatKey,S,I):p`mainStat`})}),n(re,{disabled:!o,onClick:()=>d({lock:!(o!=null&&o.lock)}),color:o!=null&&o.lock?"success":"primary",children:o!=null&&o.lock?n($r,{}):n(Dr,{})})]}),n(Nr,{location:(o==null?void 0:o.location)??"",setLocation:m=>d({location:m}),autoCompleteProps:{disabled:!o}}),n(St,{valid:L,efficiency:X,t:p}),X!==se&&n(St,{max:!0,valid:L,efficiency:se,t:p}),r&&n(ce,{bgt:"light",children:n(be,{sx:{display:"flex",flexDirection:"column",gap:1},children:C(_.Suspense,{fallback:n(lt,{width:"100%",height:"100"}),children:[C(N,{container:!0,spacing:1,alignItems:"center",children:[n(N,{item:!0,flexGrow:1,children:C("label",{htmlFor:"contained-button-file",children:[n(io,{accept:"image/*",id:"contained-button-file",multiple:!0,type:"file",onChange:Z}),n(re,{component:"span",startIcon:n(sn,{}),children:"Upload Screenshot (or Ctrl-V)"})]})}),ct&&F&&n(N,{item:!0,children:n(co,{imgs:F})}),n(N,{item:!0,children:n(re,{color:"info",sx:{px:2,minWidth:0},onClick:()=>j(!0),children:n(Pr,{})})})]}),T&&n(ee,{display:"flex",justifyContent:"center",children:n(ee,{component:"img",src:T,width:"100%",maxWidth:350,height:"auto",alt:R||"Screenshot to parse for artifact values"})}),!!G&&n(Ar,{variant:"buffer",value:100*b/G,valueBuffer:100*(b+K)/G}),!!G&&n(ce,{sx:{pl:2},children:C(ee,{display:"flex",alignItems:"center",children:[!!K&&n(tn,{size:"1em"}),n(B,{sx:{flexGrow:1,ml:1},children:C("span",{children:["Screenshots in file-queue:",n("b",{children:G})]})}),n(re,{size:"small",color:"error",onClick:Q,children:"Clear file-queue"})]})})]})})})]}),C(N,{item:!0,xs:1,display:"flex",flexDirection:"column",gap:1,children:[[0,1,2,3].map(m=>n(In,{index:m,artifact:h,setSubstat:y},m)),O&&n(ce,{bgt:"light",children:C(be,{children:[n("div",{children:O.slotKey}),n("div",{children:O.mainStatKey}),n("div",{children:O.mainStatVal}),n("div",{children:O.rarity}),n("div",{children:O.level}),n("div",{children:O.lock}),n("div",{children:O.substats}),n("div",{children:O.setKey}),n("div",{children:O.location})]})})]})]}),V&&C(N,{container:!0,sx:{justifyContent:"space-around"},spacing:1,children:[n(N,{item:!0,xs:12,md:5.5,lg:4,children:C(ce,{bgt:"light",children:[n(B,{sx:{textAlign:"center"},py:1,variant:"h6",color:"text.secondary",children:H!=="edit"?H==="duplicate"?p`editor.dupArt`:p`editor.upArt`:p`editor.beforeEdit`}),n(dt,{artifactObj:V})]})}),zt&&n(N,{item:!0,md:1,display:"flex",alignItems:"center",justifyContent:"center",children:n(ce,{bgt:"light",sx:{display:"flex"},children:n(Ir,{sx:{fontSize:40}})})}),n(N,{item:!0,xs:12,md:5.5,lg:4,children:C(ce,{bgt:"light",children:[n(B,{sx:{textAlign:"center"},py:1,variant:"h6",color:"text.secondary",children:p`editor.preview`}),n(dt,{artifactObj:h})]})})]}),!L&&n(Dt,{variant:"filled",severity:"error",children:l.map((m,z)=>n("div",{children:m},z))}),C(N,{container:!0,spacing:2,children:[n(N,{item:!0,children:H==="edit"?n(re,{startIcon:n(ht,{}),onClick:()=>{o&&w.arts.set(V.id,o),s||(v(!1),t()),x()},disabled:!o||!L,color:"primary",children:p`editor.btnSave`}):n(re,{startIcon:n(ht,{}),onClick:()=>{w.arts.new(o),s||(v(!1),t()),x()},disabled:!o||!L,color:H==="duplicate"?"warning":"primary",children:p`editor.btnAdd`})}),n(N,{item:!0,flexGrow:1,children:s&&n(re,{startIcon:n(_t,{}),disabled:!o,onClick:()=>{D()&&x()},color:"error",children:p`editor.btnClear`})}),n(N,{item:!0,children:!1}),V&&H!=="edit"&&n(N,{item:!0,children:n(re,{startIcon:n(on,{}),onClick:()=>{o&&w.arts.set(V.id,o),s?x():v(!1)},disabled:!o||!L,color:"success",children:p`editor.btnUpdate`})})]})]})]})})}function co({imgs:e}){const[t,r]=_.useState(!1);return C(ie,{children:[n(re,{color:"warning",onClick:()=>r(!0),children:"DEBUG"}),n(tt,{open:t,onClose:()=>r(!1),children:n(ce,{children:n(be,{children:n(Tr,{spacing:1,children:Object.entries(e).map(([u,a])=>C(ee,{children:[n(B,{children:u}),n(ee,{component:"img",src:a,maxWidth:"100%"})]},u))})})})})]})}export{Po as default};
