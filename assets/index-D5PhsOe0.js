import{x as E,d as e,e as n,ab as se,at as $e,a as A,y as N,r as o,bQ as le,f as u,G as h,h as T,cn as Ge,co as Ve,c3 as He,cp as Ue,W as be,cq as Je,bH as Qe,an as ue,Z as Ze,cr as pe,cs as Ye,ct as re,L as F,ah as ce,ai as Q,M as B,N as k,T as L,cu as Xe,c0 as _,cm as z,I as $,o as Z,cv as ve,a8 as et,cw as tt,ae as D,ao as ie,aj as oe,ac as Te,cx as at,cy as nt,P as rt,cz as st,cA as lt,au as ct,aK as Y,cB as it,cC as ot,bN as we,ch as dt,t as Se,v as Ie,w as De,g as Me,s as V,bI as de,bJ as ht,a_ as ke,cj as ut,cD as pt,cE as me,cF as mt,cG as gt,D as Ee,bZ as ge,z as ft,H as xt,cH as yt,cI as fe,ar as je,bL as Ct,S as G,i as bt,l as vt,cJ as Tt,ca as wt,cK as St,aB as It,aa as Dt,aF as Mt,aG as kt,b4 as ne,aH as Et,cL as jt,b8 as At,cM as Wt,cN as Bt,bk as Lt,aJ as Ot,cO as _t,cP as Ft,cQ as Nt,cR as Ae,F as Rt,E as Kt,b as Pt,A as qt,cS as zt}from"./index-B_vh8Ny0.js";import{u as $t,B as We,a as Be,L as Gt,T as xe,b as Vt,c as Ht,d as Ut,C as Jt,e as Qt,f as Zt,E as Yt}from"./LoadoutInfoAlert-qxnioIvQ.js";import{T as Le}from"./TeamCard-6BuTo0dg.js";import{u as Xt}from"./useTeamChar-BN09Q3HZ.js";import{O as ea,L as ta}from"./TeamDelModal-BddIZp1g.js";function aa(){const{t}=E("page_character");return e($e,{severity:"warning",children:n(se,{t,i18nKey:"noLoadout",children:["Looks like you haven't added any loadout/Teams with this character yet. You need to create a loadout+team with this character to"," ",e("strong",{children:"create builds"}),", ",e("strong",{children:"theorycraft"}),", or"," ",e("strong",{children:"optimize"}),"."]})})}function na(){const t=A(),s=N();return o.useCallback(a=>{t.chars.get(a)||t.chars.getWithInitWeapon(a),s(`/characters/${a}`)},[s,t])}function ra({buildId:t,characterKey:s}){const{name:r,description:a,weaponId:c,artifactIds:m}=$t(t),d=le(s).weaponType;return e(We,{name:r,description:a,hideFooter:!0,children:e(u,{sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch"},children:n(h,{container:!0,spacing:1,columns:{xs:2,sm:2,md:2,lg:3,xl:3},children:[e(h,{item:!0,xs:1,children:e(T,{sx:{height:"100%",maxHeight:"8em"},children:e(Ge,{weaponId:c,weaponTypeKey:d})})}),Object.entries(m).map(([f,x])=>e(h,{item:!0,xs:1,children:e(T,{sx:{height:"100%",maxHeight:"8em"},children:e(Ve,{artifactId:x,slotKey:f})})},x||f))]})})})}function sa({buildTcId:t}){const s=Be(t),{name:r,description:a}=s;return e(We,{name:r,description:a,hideFooter:!0,children:e(la,{buildTcId:t})})}function la({buildTcId:t}){const{weapon:s,artifact:{slots:r,substats:{stats:a},sets:c}}=Be(t),m=He(s.key),d=Object.entries(a),f=d.slice(0,5),x=d.slice(5);return e(u,{children:n(h,{container:!0,spacing:1,columns:{xs:2,sm:2,md:2,lg:2,xl:2},children:[e(h,{item:!0,xs:1,children:n(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e(Ue,{weapon:s,weaponSheet:m}),!!Object.keys(c).length&&e(T,{sx:{flexGrow:1},children:e(u,{sx:{p:1,display:"flex",flexDirection:"column",gap:1},children:Object.entries(c).map(([i,l])=>n(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(be,{size:2,src:Je(i,"flower")}),e("span",{children:e(Qe,{setKey:i})}),n(ue,{children:["x",l]})]},i))})})]})}),e(h,{item:!0,xs:1,children:e(T,{sx:{flexGrow:1,height:"100%",p:1,display:"flex",flexDirection:"column",gap:1,justifyContent:"space-between"},children:Object.entries(r).map(([i,{level:l,statKey:p}])=>n(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(Ze,{slotKey:i}),n(ue,{children:["+",l]}),e(pe,{statKey:p})]},i))})}),[f,x].map((i,l)=>e(h,{item:!0,xs:1,children:e(T,{sx:{flexGrow:1,height:"100%"},children:e(u,{sx:{p:1,height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",gap:1},children:i.map(([p,C])=>n(u,{sx:{display:"flex",alignItems:"center",gap:1,justifyContent:"space-between"},children:[e(pe,{statKey:p}),n("span",{children:[Ye(C,re(p)),re(p)]})]},p))})})},l))]})})}function ca({show:t,onHide:s,teamCharId:r,onDelete:a,teamIds:c,conditionalCount:m}){const{t:d}=E("loadout"),f=A(),{name:x,description:i,buildIds:l,buildTcIds:p,customMultiTargets:C,bonusStats:v}=f.teamChars.get(r),W=o.useCallback(()=>{s(),a()},[a,s]);return e(oe,{open:t,onClose:s,containerProps:{maxWidth:"md"},children:n(T,{children:[e(F,{title:e("span",{children:n(se,{t:d,i18nKey:"loadoutDelModal.title",name:x,children:["Delete Loadout: ",e("strong",{children:{name:x}}),"?"]})}),action:e(ce,{onClick:s,children:e(Q,{})})}),e(B,{}),n(k,{children:[i&&e(T,{bgt:"dark",sx:{mb:2},children:e(k,{children:i})}),e(L,{children:d("loadoutDelModal.desc")}),n(Xe,{sx:{listStyleType:"disc",pl:4},children:[!!l.length&&e(_,{sx:{display:"list-item"},children:n(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[d("loadoutDelModal.builds"),l.length," ",e(z,{title:e(u,{children:l.map(b=>{var w;return n(L,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(Z,{}),e("span",{children:(w=f.builds.get(b))==null?void 0:w.name})]},b)})}),children:e($,{})})]})}),!!p.length&&e(_,{sx:{display:"list-item"},children:n(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[d("loadoutDelModal.tcBuilds"),p.length," ",e(z,{title:e(u,{children:p.map(b=>{var w;return n(L,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(Z,{}),e("span",{children:(w=f.buildTcs.get(b))==null?void 0:w.name})]},b)})}),children:e($,{})})]})}),!!C.length&&e(_,{sx:{display:"list-item"},children:n(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[d("loadoutDelModal.mTargets"),C.length," ",e(z,{title:e(u,{children:C.map((b,w)=>n(L,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(ve,{}),e("span",{children:b.name})]},w))}),children:e($,{})})]})}),!!Object.keys(v).length&&n(_,{sx:{display:"list-item"},children:[d("loadoutDelModal.bonus"),Object.keys(v).length]}),!!m&&n(_,{sx:{display:"list-item"},children:[d("loadoutDelModal.condi"),m]}),e(_,{sx:{display:"list-item"},children:d("loadoutDelModal.optConfig")}),!!c.length&&e(_,{sx:{display:"list-item"},children:n(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[n("span",{children:[d("loadoutDelModal.affected"),c.length]}),e(z,{title:e(u,{children:c.map(b=>{var w;return n(L,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(et,{}),e("span",{children:(w=f.teams.get(b))==null?void 0:w.name})]},b)})}),children:e($,{})})]})})]})]}),n(tt,{sx:{float:"right"},children:[e(D,{startIcon:e(Q,{}),color:"secondary",onClick:s,children:d("loadoutDelModal.cancel")}),e(D,{startIcon:e(ie,{}),color:"error",onClick:W,children:d("loadoutDelModal.delete")})]})]})})}function ia({show:t,onHide:s,teamCharId:r,teamIds:a}){const{t:c}=E("loadout"),[m,d,f]=Te(),x=N(),i=A(),{key:l,name:p,description:C,buildIds:v,buildTcIds:W,customMultiTargets:b,bonusStats:w,optConfigId:H,conditional:R}=Xt(r),{optimizationTarget:S}=at(H),K=()=>{s(),i.teamChars.remove(r)},X=()=>{i.teamChars.duplicate(r)&&s()},ee=y=>{const j=i.teams.new();i.teams.set(j,te=>{te.loadoutData[0]={teamCharId:y}}),x(`/teams/${j}`)},U=o.useMemo(()=>{let y=0;return nt(R,[],j=>typeof j!="object",()=>y++),y},[R]);return e(oe,{open:t,onClose:s,containerProps:{maxWidth:"lg"},children:n(T,{children:[e(F,{title:n(u,{display:"flex",gap:1,alignItems:"center",children:[e(rt,{}),e("strong",{children:p})]}),action:e(ce,{onClick:s,children:e(Q,{})})}),e(B,{}),n(k,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(Gt,{}),e(xe,{fullWidth:!0,label:c("loadoutEditor.label"),placeholder:c("loadoutEditor.placeholder"),value:p,onChange:y=>i.teamChars.set(r,{name:y})}),e(xe,{fullWidth:!0,label:c("loadoutEditor.desc"),value:C,onChange:y=>i.teamChars.set(r,{description:y}),multiline:!0,minRows:2}),e(u,{children:n(h,{container:!0,columns:{xs:1,md:2},spacing:2,children:[e(h,{item:!0,xs:1,children:e(D,{color:"info",onClick:()=>X(),fullWidth:!0,startIcon:e(st,{}),children:c("loadoutEditor.dupBtn")})}),n(h,{item:!0,xs:1,children:[e(ca,{show:m,onHide:f,onDelete:K,teamCharId:r,teamIds:a,conditionalCount:U}),e(D,{fullWidth:!0,startIcon:e(ie,{}),color:"error",onClick:d,children:c("loadoutEditor.delBtn")})]})]})}),e(u,{children:n(h,{container:!0,columns:{xs:1,md:2},spacing:2,children:[!!Object.keys(w).length&&e(h,{item:!0,xs:1,children:e(oa,{bonusStats:w})}),!!S&&e(h,{item:!0,xs:1,children:n(T,{bgt:"light",children:[e(F,{title:n(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(lt,{}),e("span",{children:c("loadoutEditor.optTarget")})]})}),e(B,{}),e(k,{children:e(ct,{divider:e(B,{orientation:"vertical",flexItem:!0}),spacing:1,children:e(ea,{optimizationTarget:S,customMultiTargets:b})})})]})}),!!b.length&&e(h,{item:!0,xs:1,children:e(da,{customMultiTargets:b})}),e(h,{item:!0,xs:1,children:e(T,{bgt:"light",children:e(k,{children:n(L,{variant:"h6",children:[c("loadoutEditor.conditionals"),e("strong",{children:U})]})})})})]})})]}),e(B,{}),e(F,{title:n(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(Z,{}),e("span",{children:c("loadoutEditor.builds")})]})}),e(B,{}),n(k,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(Vt,{}),e(u,{children:e(h,{container:!0,columns:{xs:1,md:2},spacing:2,children:v.map(y=>e(h,{item:!0,xs:1,children:e(ra,{buildId:y,characterKey:l})},y))})}),e(Ht,{}),e(u,{children:e(h,{container:!0,columns:{xs:1,md:2},spacing:2,children:W.map(y=>e(h,{item:!0,xs:1,children:e(sa,{buildTcId:y})},y))})})]}),e(B,{}),e(F,{title:n(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(Z,{}),e("span",{children:c("loadoutEditor.teams")})]})}),e(B,{}),n(k,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(Ut,{}),n(h,{container:!0,columns:{xs:1,md:2},spacing:2,children:[a.map(y=>e(h,{item:!0,xs:1,children:e(Le,{bgt:"light",teamId:y,onClick:j=>x(`/teams/${y}${j?`/${j}`:""}`)})},y)),e(h,{item:!0,xs:1,children:e(D,{fullWidth:!0,sx:{height:"100%",backgroundColor:"contentLight.main"},variant:"outlined",onClick:()=>ee(r),color:"info",startIcon:e(Y,{}),children:c("loadoutEditor.addNewTeam")})})]})]})]})})}function oa({bonusStats:t}){const{t:s}=E("loadout");return n(T,{bgt:"light",children:[e(F,{title:n(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(it,{}),e("span",{children:s("loadoutEditor.bonusStats")})]}),titleTypographyProps:{variant:"h6"}}),e(we,{bgt:"light",sections:[{fields:Object.entries(t).map(([r,a])=>({text:ot.getStr(r)??r,value:a,unit:re(r)}))}]})]})}function da({customMultiTargets:t}){const{t:s}=E("loadout");return n(T,{bgt:"light",children:[e(F,{title:n(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(ve,{}),e("span",{children:s("loadoutEditor.mltTargets")})]}),titleTypographyProps:{variant:"h6"}}),e(we,{bgt:"light",sections:[{fields:t.map(({name:r,description:a})=>({text:r,value:a?e(z,{title:a,children:e($,{})}):void 0}))}]})]})}const ha={xs:1,md:2};function ua({teamCharId:t,teamIds:s}){const{t:r}=E("page_character"),a=N(),c=A(),m=i=>{const l=c.teams.new();c.teams.set(l,p=>{p.loadoutData[0]={teamCharId:i}}),a(`/teams/${l}`)},[d,f,x]=Te();return n(dt,{children:[e(ia,{show:d,onHide:x,teamCharId:t,teamIds:s}),n(T,{bgt:"light",children:[e(D,{fullWidth:!0,onClick:f,sx:{p:0,display:"flex",borderBottomLeftRadius:0,borderBottomRightRadius:0},color:"neutral100",variant:"outlined",children:e(ta,{teamCharId:t,showSetting:!0})}),e(k,{sx:{p:1},children:n(h,{container:!0,columns:ha,spacing:1,children:[s.map(i=>e(h,{item:!0,xs:1,children:e(Le,{teamId:i,onClick:l=>a(`/teams/${i}${l?`/${l}`:""}`)})},i)),e(h,{item:!0,xs:1,children:e(D,{fullWidth:!0,sx:{height:"100%",backgroundColor:"contentNormal.main"},variant:"outlined",onClick:()=>m(t),color:"info",startIcon:e(Y,{}),children:r("charContentModal.addTeam")})})]})})]},t)]})}var P={},ye;function pa(){if(ye)return P;ye=1;var t=Se();Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var s=t(Ie()),r=De(),a=(0,s.default)((0,r.jsx)("path",{d:"M17.5 9.5C17.5 6.46 15.04 4 12 4S6.5 6.46 6.5 9.5c0 2.7 1.94 4.93 4.5 5.4V17H9v2h2v2h2v-2h2v-2h-2v-2.1c2.56-.47 4.5-2.7 4.5-5.4zm-9 0C8.5 7.57 10.07 6 12 6s3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5z"}),"Female");return P.default=a,P}var ma=pa();const ga=Me(ma);var q={},Ce;function fa(){if(Ce)return q;Ce=1;var t=Se();Object.defineProperty(q,"__esModule",{value:!0}),q.default=void 0;var s=t(Ie()),r=De(),a=(0,s.default)((0,r.jsx)("path",{d:"M9.5 11c1.93 0 3.5 1.57 3.5 3.5S11.43 18 9.5 18 6 16.43 6 14.5 7.57 11 9.5 11zm0-2C6.46 9 4 11.46 4 14.5S6.46 20 9.5 20s5.5-2.46 5.5-5.5c0-1.16-.36-2.23-.97-3.12L18 7.42V10h2V4h-6v2h2.58l-3.97 3.97C11.73 9.36 10.66 9 9.5 9z"}),"Male");return q.default=a,q}var xa=fa();const ya=Me(xa);function Ca(){const{t}=E("ui"),s=A(),{character:r}=o.useContext(V),{key:a}=r,{gender:c}=de(),m=o.useCallback(()=>s.dbMeta.set({gender:c==="F"?"M":"F"}),[c,s]);return a.startsWith("Traveler")?n(D,{onClick:m,startIcon:c==="F"?e(ga,{}):e(ya,{}),children:[e("strong",{children:t(`gender.${c}`)})," "]}):null}function ba({onClose:t}){const{t:s}=E(["page_character","sillyWisher_charNames","charNames_gen"]),r=N(),a=A(),{character:c,character:{key:m}}=o.useContext(V),{gender:d}=de(),f=ht(m,d),{silly:x}=o.useContext(ke),i=o.useCallback(async()=>{const l=s(`${x?"sillyWisher_charNames":"charNames_gen"}:${ut(m,d)}`);window.confirm(s("removeCharacter",{value:l}))&&(a.chars.remove(m),r("/characters"))},[a,r,m,d,x,s]);return n(u,{display:"flex",flexDirection:"column",gap:1,children:[n(u,{display:"flex",gap:1,children:[e(Ca,{}),e(D,{color:"error",onClick:()=>i(),startIcon:e(ie,{}),sx:{marginLeft:"auto"},children:s("delete")}),!!t&&e(ce,{onClick:t,children:e(Q,{})})]}),e(u,{children:n(h,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[e(h,{item:!0,xs:8,sm:5,md:4,lg:3,children:n(T,{bgt:"light",sx:{height:"100%",display:"flex",flexDirection:"column",gap:1},children:[e(Jt,{}),e(u,{sx:{px:1},children:e(pt,{level:c.level,ascension:c.ascension,setBoth:l=>{me.includes(m)?me.forEach(p=>{a.chars.set(p,l)}):a.chars.set(m,l)}})}),e(mt,{bgt:"light"}),e(L,{sx:{textAlign:"center",pb:-1},variant:"h6",children:e(gt,{characterKey:m,gender:d})}),e(u,{sx:{px:1},children:e(Qt,{setConstellation:l=>a.chars.set(m,{constellation:l})})})]})}),n(h,{item:!0,xs:12,sm:7,md:8,lg:9,sx:{display:"flex",flexDirection:"column",gap:1},children:[e(u,{children:e(h,{container:!0,columns:3,spacing:1,children:["auto","skill","burst"].map(l=>{var p;return e(h,{item:!0,xs:1,children:e(Zt,{talentKey:l,dropDownButtonProps:{startIcon:e(be,{src:(p=f.getTalentOfKey(l))==null?void 0:p.img,size:1.75,sideMargin:!0})},setTalent:C=>a.chars.set(m,v=>{v.talent[l]=C})},l)},l)})})}),e(va,{}),e(Ta,{})]})]})})]})}function va(){const{character:{key:t,equippedArtifacts:s}}=o.useContext(V),{data:r}=o.useContext(Ee),a=A(),c=le(t).weaponType,m=r.get(ge.weapon.id).value,d=o.useMemo(()=>ft(xt,f=>r.get(ge.art[f].id).value),[r]);return e(u,{children:e(yt.Provider,{value:"equipped",children:e(Yt,{weaponTypeKey:c,weaponId:m,artifactIds:d,setWeapon:f=>{a.weapons.set(f,{location:fe(t)})},setArtifact:(f,x)=>{x?a.arts.set(x,{location:fe(t)}):a.arts.set(s[f],{location:""})}})})})}function Ta(){const{t}=E("page_character"),s=N(),{character:{key:r}}=o.useContext(V),a=A(),{gender:c}=de(),[m,d]=je(),f=o.useMemo(()=>{const i={};return a.teamChars.entries.sort((l,p)=>{const[,C]=l,[,v]=p;return C.name.localeCompare(v.name)}).map(([l,p])=>{p.key===r&&(i[l]||(i[l]=[]))}),a.teams.entries.sort((l,p)=>{const[,C]=l,[,v]=p;return C.name.localeCompare(v.name)}).forEach(([l,p])=>{const C=p.loadoutData.find(v=>{var W;return v&&((W=a.teamChars.get(v==null?void 0:v.teamCharId))==null?void 0:W.key)===r});C&&i[C==null?void 0:C.teamCharId].push(l)}),m&&i},[m,r,a]);o.useEffect(()=>a.teams.followAny(()=>d()),[a,d]),o.useEffect(()=>a.teamChars.followAny(()=>d()),[a,d]);const x=()=>{const i=a.teams.new(),l=a.teamChars.new(r);a.teams.set(i,p=>{p.loadoutData[0]={teamCharId:l}}),s(`/teams/${i}`)};return n(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e(L,{variant:"h6",children:n(se,{t,i18nKey:"charContentModal.loadoutsWith",children:["Team Loadouts with"," ",e(Ct,{characterKey:r,gender:c})]})}),!Object.values(f).length&&e(aa,{}),Object.entries(f).map(([i,l])=>e(ua,{teamCharId:i,teamIds:l},i)),e(D,{fullWidth:!0,onClick:()=>x(),color:"info",startIcon:e(Y,{}),variant:"outlined",sx:{backgroundColor:"contentLight.main"},children:t("charContentModal.addLoAndTeam")}),e(T,{bgt:"light"})]})}function wa({characterKey:t,onClose:s}){return e(oe,{open:!!t,onClose:s,children:e(o.Suspense,{fallback:e(G,{variant:"rectangular",width:"100%",height:1e3}),children:t&&e(Sa,{characterKey:t,onClose:s},t)})})}function Sa({characterKey:t,onClose:s}){const r=bt(t),a=vt(t),{target:c}=(a==null?void 0:a[t])??{},m=o.useMemo(()=>{if(!(!a||!c))return{data:c,teamData:a,compareData:void 0}},[c,a]),d=o.useMemo(()=>r&&{character:r},[r]),[f,x]=o.useState(),[i,l]=o.useState(),p=o.useMemo(()=>({chartData:f,setChartData:x,graphBuilds:i,setGraphBuilds:l}),[f,i]);return o.useEffect(()=>{x(void 0),l(void 0)},[t]),e(T,{children:e(k,{sx:{display:"flex",flexDirection:"column",gap:1},children:e(o.Suspense,{fallback:e(G,{variant:"rectangular",width:"100%",height:1e3}),children:m&&d&&p?e(V.Provider,{value:d,children:e(Ee.Provider,{value:m,children:e(Tt.Provider,{value:p,children:e(ba,{onClose:s})})})}):e(G,{variant:"rectangular",width:"100%",height:1e3})})})})}const Ia={xs:1,sm:2,md:3,lg:4,xl:4},Da={xs:5,sm:8,md:9,lg:12,xl:12},Ma=Object.keys(Ae);function Ba(){const t=A(),s=N(),{params:{characterKey:r}}=wt({path:"/characters/:characterKey",end:!1})??{params:{}},a=o.useMemo(()=>r?St(r)?(t.chars.get(r)||t.chars.getWithInitWeapon(r),r):(s("/characters"),null):null,[r,s,t]),{t:c}=E(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:m}=o.useContext(ke),[d,f]=o.useState(()=>t.displayCharacter.get());o.useEffect(()=>t.displayCharacter.follow((g,I)=>f(I)),[t,f]);const[x,i]=o.useState(""),l=o.useDeferredValue(x),p=It(),[C,v]=o.useState(!1),[W,b]=je();o.useEffect(()=>(Dt.send({hitType:"pageview",page:"/characters"}),t.chars.followAny((g,I)=>(I==="new"||I==="remove")&&b())),[b,t]),o.useEffect(()=>t.charMeta.followAny(g=>b()),[b,t]);const w=na(),H=o.useDeferredValue(d),R=o.useDeferredValue(W),{charKeys:S,totalCharNum:K}=o.useMemo(()=>{const I=t.chars.keys.length,{element:O,weaponType:M,rarity:J,sortType:Pe,ascending:qe}=H,ze=t.chars.keys.filter(Mt({element:O,weaponType:M,rarity:J,name:l},Ft(t,m))).sort(kt(Ae[Pe]??[],qe,Nt(t,m),["new","favorite"]));return R&&{charKeys:ze,totalCharNum:I}},[t,H,l,m,R]),{weaponType:X,element:ee,rarity:U,sortType:y,ascending:j}=d,te=o.useMemo(()=>ne(Kt,g=>Object.entries(t.chars.data).forEach(([I,O])=>{const M=t.weapons.get(O.equippedWeapon);if(!M)return;const J=Rt(M.key).weaponType;g[J].total++,S.includes(I)&&g[J].current++})),[t,S]),Oe=o.useMemo(()=>ne(qt,g=>Object.entries(t.chars.data).forEach(([I,O])=>{const M=Pt(O.key);g[M].total++,S.includes(I)&&g[M].current++})),[t,S]),_e=o.useMemo(()=>ne(zt,g=>Object.entries(t.chars.data).forEach(([I,O])=>{const M=le(O.key).rarity;g[M].total++,S.includes(I)&&g[M].current++})),[t,S]),{numShow:he,setTriggerElement:Fe}=Et(Da[p],S.length),ae=o.useMemo(()=>S.slice(0,he),[S,he]),Ne=S.length!==K?`${S.length}/${K}`:`${K}`,Re={numShowing:ae.length,total:Ne,t:c,namespace:"page_character"},Ke={sortKeys:[...Ma],value:y,onChange:g=>t.displayCharacter.set({sortType:g}),ascending:j,onChangeAsc:g=>t.displayCharacter.set({ascending:g})};return n(u,{display:"flex",flexDirection:"column",gap:1,children:[a&&e(wa,{characterKey:a,onClose:()=>s("/characters")}),e(o.Suspense,{fallback:!1,children:e(jt,{newFirst:!0,show:C,onHide:()=>v(!1),onSelect:w})}),e(T,{children:n(k,{sx:{display:"flex",flexDirection:"column",gap:1},children:[n(h,{container:!0,spacing:1,children:[e(h,{item:!0,children:e(At,{sx:{height:"100%"},onChange:g=>t.displayCharacter.set({weaponType:g}),value:X,totals:te,size:"small"})}),e(h,{item:!0,children:e(Wt,{sx:{height:"100%"},onChange:g=>t.displayCharacter.set({element:g}),value:ee,totals:Oe,size:"small"})}),e(h,{item:!0,children:e(Bt,{sx:{height:"100%"},onChange:g=>t.displayCharacter.set({rarity:g}),value:U,totals:_e,size:"small"})}),e(h,{item:!0,flexGrow:1}),e(h,{item:!0,children:e(Lt,{autoFocus:!0,value:x,onChange:g=>i(g.target.value),label:c("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),e(u,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(Ot,{showingTextProps:Re,sortByButtonProps:Ke})})]})}),e(D,{fullWidth:!0,onClick:()=>v(!0),color:"info",startIcon:e(Y,{}),children:c("addNew")}),e(o.Suspense,{fallback:e(G,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(h,{container:!0,spacing:1,columns:Ia,children:ae.map(g=>e(h,{item:!0,xs:1,children:e(_t,{characterKey:g,onClick:()=>s(`${g}`),hideStats:!0})},g))})}),S.length!==ae.length&&e(G,{ref:g=>{g&&Fe(g)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Ba as default};
